define(["require","lib/Three","./Tasks"],function(a){var b=a("lib/Three"),c=a("./Tasks"),d=Class.extend({init:function(a){this.set(a)},set:function(a){a=a||{},this.speed=a.speed||5,this.angle=a.angle||0,this.xSpeed=a.xSpeed||0,this.ySpeed=a.ySpeed||0,this.x=a.x||0,this.y=a.y||0,this.image=a.image;var e=d.imageMapCache.load("img/"+this.image);this.model=a.model||new b.Sprite({color:a.color||16777215,map:e}),this.alive=!0,this.parent=a.parent||null,this.state=a.state||null,this.tasks=a.tasks?new c({tasks:a.tasks}):null,this.speedType=a.speedType||d.speedTypes.CARTESIAN,this.angleToRotation=a.angleToRotation||!1,this.disableTasks=!1},add:function(a){this.state&&(a.parent=a.parent||this,this.state.add(a))},remove:function(a){this.state&&this.state.remove(a)},update:function(a){var b=this.parent?this.parent.x:0,c=this.parent?this.parent.y:0,e=(this.angle+270)*(Math.PI/180);this.speedType===d.speedTypes.POLAR&&(this.xSpeed=this.speed*Math.cos(e),this.ySpeed=this.speed*Math.sin(e)),this.angleToRotation&&(this.model.rotation=Math.PI*2-e),this.x+=this.xSpeed*a*50,this.y+=this.ySpeed*a*50,this.model.position.x=this.x+b,this.model.position.y=this.y+c,!this.disableTasks&&this.tasks&&this.tasks.update(a,this)}});return d.imageMapCache={images:{},load:function(a){return this.images[a]=this.images[a]||b.ImageUtils.loadTexture(a),this.images[a]}},d.speedTypes={POLAR:0,CARTESIAN:1},d})