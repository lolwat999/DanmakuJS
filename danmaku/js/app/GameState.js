define(["require"],function(a){var b=Class.extend({init:function(a,b,c,d){this.core=a,this.background=b||null,this.foreground=c||null,this.entities=[],this.paused=!1,this.frame=0,this.gridSpace=200,this.entityCount={}},update:function(a){++this.frame;var b,c=this.entities;this.entitiesByGrid=[];for(var d=0,e=c.length;d<e;++d){b=c[d],b.update(a);if(!b.alive)this.remove(b),e=c.length,--d;else if(b.x&&b.y){var f=this.getGridLocation(b);this.entitiesByGrid[f]=this.entitiesByGrid[f]||[],this.entitiesByGrid[f].push(b)}}},getGridLocation:function(a){var b=this.gridSpace,c=Math.round(a.x/b),d=Math.round(a.y/b);return(c+1)*(d+1)},updateAll:function(a){this.background&&this.background.updateAll(a),this.update&&!this.paused&&this.update(a),this.foreground&&this.foreground.updateAll(a)},renderAll:function(a){this.background&&this.background.renderAll(a),this.render&&this.render(a),this.foreground&&this.foreground.renderAll(a)},add:function(a){a.state=this,this.entityCount[a.type]=this.entityCount[a.type]||0,++this.entityCount[a.type],this.entities.push(a)},remove:function(a){var b=this.entities.indexOf(a);a.state=null,b!==-1&&(--this.entityCount[a.type],this.entities.splice(b,1))},clear:function(){this.entities=[]},getSize:function(){var a=this.core.container,b=a.width(),c=a.height();return{width:b,height:c}},onActivate:function(){},onDeactivate:function(){}});return b})