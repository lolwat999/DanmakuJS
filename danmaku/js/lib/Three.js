(function(a){var b;define([],function(){return function(){var a=a||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),a.Clock=function(a){this.autoStart=a!==void 0?a:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},a.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},a.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},a.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},a.Clock.prototype.getDelta=function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=Date.now(),a=.001*(b-this.oldTime);this.oldTime=b,this.elapsedTime=this.elapsedTime+a}return a},a.Color=function(a){return a!==void 0&&this.setHex(a),this},a.Color.prototype={constructor:a.Color,r:1,g:1,b:1,copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a){return this.r=a.r*a.r,this.g=a.g*a.g,this.b=a.b*a.b,this},copyLinearToGamma:function(a){return this.r=Math.sqrt(a.r),this.g=Math.sqrt(a.g),this.b=Math.sqrt(a.b),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSV:function(a,b,c){var d,e,f;if(c===0)this.r=this.g=this.b=0;else{d=Math.floor(a*6),e=a*6-d,a=c*(1-b),f=c*(1-b*e),b=c*(1-b*(1-e));switch(d){case 1:this.r=f,this.g=c,this.b=a;break;case 2:this.r=a,this.g=c,this.b=b;break;case 3:this.r=a,this.g=f,this.b=c;break;case 4:this.r=b,this.g=a,this.b=c;break;case 5:this.r=c,this.g=a,this.b=f;break;case 6:case 0:this.r=c,this.g=b,this.b=a}}return this},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,this},lerpSelf:function(a,b){return this.r=this.r+(a.r-this.r)*b,this.g=this.g+(a.g-this.g)*b,this.b=this.b+(a.b-this.b)*b,this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new a.Color).setRGB(this.r,this.g,this.b)}},a.Vector2=function(a,b){this.x=a||0,this.y=b||0},a.Vector2.prototype={constructor:a.Vector2,set:function(a,b){return this.x=a,this.y=b,this},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addSelf:function(a){return this.x=this.x+a.x,this.y=this.y+a.y,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},subSelf:function(a){return this.x=this.x-a.x,this.y=this.y-a.y,this},multiplyScalar:function(a){return this.x=this.x*a,this.y=this.y*a,this},divideScalar:function(a){return a?(this.x=this.x/a,this.y=this.y/a):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x=this.x+(a.x-this.x)*b,this.y=this.y+(a.y-this.y)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new a.Vector2(this.x,this.y)}},a.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},a.Vector3.prototype={constructor:a.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addSelf:function(a){return this.x=this.x+a.x,this.y=this.y+a.y,this.z=this.z+a.z,this},addScalar:function(a){return this.x=this.x+a,this.y=this.y+a,this.z=this.z+a,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},subSelf:function(a){return this.x=this.x-a.x,this.y=this.y-a.y,this.z=this.z-a.z,this},multiply:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},multiplySelf:function(a){return this.x=this.x*a.x,this.y=this.y*a.y,this.z=this.z*a.z,this},multiplyScalar:function(a){return this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this},divideSelf:function(a){return this.x=this.x/a.x,this.y=this.y/a.y,this.z=this.z/a.z,this},divideScalar:function(a){return a?(this.x=this.x/a,this.y=this.y/a,this.z=this.z/a):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x=this.x+(a.x-this.x)*b,this.y=this.y+(a.y-this.y)*b,this.z=this.z+(a.z-this.z)*b,this},cross:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){return(new a.Vector3).sub(this,b).lengthSq()},getPositionFromMatrix:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},getRotationFromMatrix:function(a,b){var c=b?b.x:1,d=b?b.y:1,e=b?b.z:1,f=a.elements[0]/c,g=a.elements[4]/d,c=a.elements[1]/c,d=a.elements[5]/d,h=a.elements[9]/e,i=a.elements[10]/e;return this.y=Math.asin(a.elements[8]/e),e=Math.cos(this.y),Math.abs(e)>1e-5?(this.x=Math.atan2(-h/e,i/e),this.z=Math.atan2(-g/e,f/e)):(this.x=0,this.z=Math.atan2(c,d)),this},getScaleFromMatrix:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b,this.y=c,this.z=a},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==void 0?d:1},a.Vector4.prototype={constructor:a.Vector4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addSelf:function(a){return this.x=this.x+a.x,this.y=this.y+a.y,this.z=this.z+a.z,this.w=this.w+a.w,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},subSelf:function(a){return this.x=this.x-a.x,this.y=this.y-a.y,this.z=this.z-a.z,this.w=this.w-a.w,this},multiplyScalar:function(a){return this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this.w=this.w*a,this},divideScalar:function(a){return a?(this.x=this.x/a,this.y=this.y/a,this.z=this.z/a,this.w=this.w/a):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x=this.x+(a.x-this.x)*b,this.y=this.y+(a.y-this.y)*b,this.z=this.z+(a.z-this.z)*b,this.w=this.w+(a.w-this.w)*b,this},clone:function(){return new a.Vector4(this.x,this.y,this.z,this.w)}},a.Frustum=function(){this.planes=[new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4]},a.Frustum.prototype.setFromMatrix=function(a){var b,c=this.planes,d=a.elements,a=d[0];b=d[1];var e=d[2],f=d[3],g=d[4],h=d[5],i=d[6],j=d[7],k=d[8],l=d[9],m=d[10],n=d[11],o=d[12],p=d[13],q=d[14],d=d[15];c[0].set(f-a,j-g,n-k,d-o),c[1].set(f+a,j+g,n+k,d+o),c[2].set(f+b,j+h,n+l,d+p),c[3].set(f-b,j-h,n-l,d-p),c[4].set(f-e,j-i,n-m,d-q),c[5].set(f+e,j+i,n+m,d+q);for(a=0;a<6;a++)b=c[a],b.divideScalar(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z))},a.Frustum.prototype.contains=function(a){for(var b=this.planes,c=a.matrixWorld,d=c.elements,c=-a.geometry.boundingSphere.radius*c.getMaxScaleOnAxis(),e=0;e<6;e++){a=b[e].x*d[12]+b[e].y*d[13]+b[e].z*d[14]+b[e].w;if(a<=c)return!1}return!0},a.Frustum.__v1=new a.Vector3,a.Ray=function(b,c){function d(a,b,c){return p.sub(c,a),s=p.dot(b),t=q.add(a,r.copy(b).multiplyScalar(s)),u=c.distanceTo(t)}function e(a,b,c,d){return p.sub(d,b),q.sub(c,b),r.sub(a,b),v=p.dot(p),w=p.dot(q),x=p.dot(r),y=q.dot(q),z=q.dot(r),A=1/(v*y-w*w),B=(y*x-w*z)*A,C=(v*z-w*x)*A,B>=0&&C>=0&&B+C<1}this.origin=b||new a.Vector3,this.direction=c||new a.Vector3;var f=1e-4;this.setPrecision=function(a){f=a};var g=new a.Vector3,h=new a.Vector3,i=new a.Vector3,j=new a.Vector3,k=new a.Vector3,l=new a.Vector3,m=new a.Vector3,n=new a.Vector3,o=new a.Vector3;this.intersectObject=function(b){var c,p=[];if(b instanceof a.Particle){var q=d(this.origin,this.direction,b.matrixWorld.getPosition());if(q>b.scale.x)return[];c={distance:q,point:b.position,face:null,object:b},p.push(c)}else if(b instanceof a.Mesh){var q=d(this.origin,this.direction,b.matrixWorld.getPosition()),r=a.Frustum.__v1.set(b.matrixWorld.getColumnX().length(),b.matrixWorld.getColumnY().length(),b.matrixWorld.getColumnZ().length());if(q>b.geometry.boundingSphere.radius*Math.max(r.x,Math.max(r.y,r.z)))return p;var s,t,u=b.geometry,v=u.vertices,w;b.matrixRotationWorld.extractRotation(b.matrixWorld),q=0;for(r=u.faces.length;q<r;q++){c=u.faces[q],k.copy(this.origin),l.copy(this.direction),w=b.matrixWorld,m=w.multiplyVector3(m.copy(c.centroid)).subSelf(k),n=b.matrixRotationWorld.multiplyVector3(n.copy(c.normal)),s=l.dot(n);if(!(Math.abs(s)<f)){t=n.dot(m)/s;if(!(t<0)&&(b.doubleSided||(b.flipSided?s>0:s<0))){o.add(k,l.multiplyScalar(t));if(c instanceof a.Face3)g=w.multiplyVector3(g.copy(v[c.a])),h=w.multiplyVector3(h.copy(v[c.b])),i=w.multiplyVector3(i.copy(v[c.c])),e(o,g,h,i)&&(c={distance:k.distanceTo(o),point:o.clone(),face:c,object:b},p.push(c));else if(c instanceof a.Face4){g=w.multiplyVector3(g.copy(v[c.a])),h=w.multiplyVector3(h.copy(v[c.b])),i=w.multiplyVector3(i.copy(v[c.c])),j=w.multiplyVector3(j.copy(v[c.d]));if(e(o,g,h,j)||e(o,h,i,j))c={distance:k.distanceTo(o),point:o.clone(),face:c,object:b},p.push(c)}}}}}return p},this.intersectObjects=function(a){for(var b=[],c=0,d=a.length;c<d;c++)Array.prototype.push.apply(b,this.intersectObject(a[c]));return b.sort(function(a,b){return a.distance-b.distance}),b};var p=new a.Vector3,q=new a.Vector3,r=new a.Vector3,s,t,u,v,w,x,y,z,A,B,C},a.Rectangle=function(){function a(){f=d-b,g=e-c}var b,c,d,e,f,g,h=!0;this.getX=function(){return b},this.getY=function(){return c},this.getWidth=function(){return f},this.getHeight=function(){return g},this.getLeft=function(){return b},this.getTop=function(){return c},this.getRight=function(){return d},this.getBottom=function(){return e},this.set=function(f,g,i,j){h=!1,b=f,c=g,d=i,e=j,a()},this.addPoint=function(f,g){h?(h=!1,b=f,c=g,d=f,e=g):(b=b<f?b:f,c=c<g?c:g,d=d>f?d:f,e=e>g?e:g),a()},this.add3Points=function(f,g,i,j,k,l){h?(h=!1,b=f<i?f<k?f:k:i<k?i:k,c=g<j?g<l?g:l:j<l?j:l,d=f>i?f>k?f:k:i>k?i:k,e=g>j?g>l?g:l:j>l?j:l):(b=f<i?f<k?f<b?f:b:k<b?k:b:i<k?i<b?i:b:k<b?k:b,c=g<j?g<l?g<c?g:c:l<c?l:c:j<l?j<c?j:c:l<c?l:c,d=f>i?f>k?f>d?f:d:k>d?k:d:i>k?i>d?i:d:k>d?k:d,e=g>j?g>l?g>e?g:e:l>e?l:e:j>l?j>e?j:e:l>e?l:e),a()},this.addRectangle=function(f){h?(h=!1,b=f.getLeft(),c=f.getTop(),d=f.getRight(),e=f.getBottom()):(b=b<f.getLeft()?b:f.getLeft(),c=c<f.getTop()?c:f.getTop(),d=d>f.getRight()?d:f.getRight(),e=e>f.getBottom()?e:f.getBottom()),a()},this.inflate=function(f){b-=f,c-=f,d+=f,e+=f,a()},this.minSelf=function(f){b=b>f.getLeft()?b:f.getLeft(),c=c>f.getTop()?c:f.getTop(),d=d<f.getRight()?d:f.getRight(),e=e<f.getBottom()?e:f.getBottom(),a()},this.intersects=function(a){return d<a.getLeft()||b>a.getRight()||e<a.getTop()||c>a.getBottom()?!1:!0},this.empty=function(){h=!0,e=d=c=b=0,a()},this.isEmpty=function(){return h}},a.Math={clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return a<0?-1:a>0?1:0}},a.Matrix3=function(){this.elements=new Float32Array(9)},a.Matrix3.prototype={constructor:a.Matrix3,getInverse:function(a){var b=a.elements,a=b[10]*b[5]-b[6]*b[9],c=-b[10]*b[1]+b[2]*b[9],d=b[6]*b[1]-b[2]*b[5],e=-b[10]*b[4]+b[6]*b[8],f=b[10]*b[0]-b[2]*b[8],g=-b[6]*b[0]+b[2]*b[4],h=b[9]*b[4]-b[5]*b[8],i=-b[9]*b[0]+b[1]*b[8],j=b[5]*b[0]-b[1]*b[4],b=b[0]*a+b[1]*e+b[2]*h;b===0&&console.warn("Matrix3.getInverse(): determinant == 0");var b=1/b,k=this.elements;return k[0]=b*a,k[1]=b*c,k[2]=b*d,k[3]=b*e,k[4]=b*f,k[5]=b*g,k[6]=b*h,k[7]=b*i,k[8]=b*j,this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},transposeIntoArray:function(a){var b=this.m;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}},a.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16),this.set(a!==void 0?a:1,b||0,c||0,d||0,e||0,f!==void 0?f:1,g||0,h||0,i||0,j||0,k!==void 0?k:1,l||0,m||0,n||0,o||0,p!==void 0?p:1)},a.Matrix4.prototype={constructor:a.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return a=a.elements,this.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]),this},lookAt:function(b,c,d){var e=this.elements,f=a.Matrix4.__v1,g=a.Matrix4.__v2,h=a.Matrix4.__v3;return h.sub(b,c).normalize(),h.length()===0&&(h.z=1),f.cross(d,h).normalize(),f.length()===0&&(h.x=h.x+1e-4,f.cross(d,h).normalize()),g.cross(h,f),e[0]=f.x,e[4]=g.x,e[8]=h.x,e[1]=f.y,e[5]=g.y,e[9]=h.y,e[2]=f.z,e[6]=g.z,e[10]=h.z,this},multiply:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],c=c[15],u=d[0],v=d[4],w=d[8],x=d[12],y=d[1],z=d[5],A=d[9],B=d[13],C=d[2],D=d[6],E=d[10],F=d[14],G=d[3],H=d[7],I=d[11],d=d[15];return e[0]=f*u+g*y+h*C+i*G,e[4]=f*v+g*z+h*D+i*H,e[8]=f*w+g*A+h*E+i*I,e[12]=f*x+g*B+h*F+i*d,e[1]=j*u+k*y+l*C+m*G,e[5]=j*v+k*z+l*D+m*H,e[9]=j*w+k*A+l*E+m*I,e[13]=j*x+k*B+l*F+m*d,e[2]=n*u+o*y+p*C+q*G,e[6]=n*v+o*z+p*D+q*H,e[10]=n*w+o*A+p*E+q*I,e[14]=n*x+o*B+p*F+q*d,e[3]=r*u+s*y+t*C+c*G,e[7]=r*v+s*z+t*D+c*H,e[11]=r*w+s*A+t*E+c*I,e[15]=r*x+s*B+t*F+c*d,this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiply(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]=b[0]*a,b[4]=b[4]*a,b[8]=b[8]*a,b[12]=b[12]*a,b[1]=b[1]*a,b[5]=b[5]*a,b[9]=b[9]*a,b[13]=b[13]*a,b[2]=b[2]*a,b[6]=b[6]*a,b[10]=b[10]*a,b[14]=b[14]*a,b[3]=b[3]*a,b[7]=b[7]*a,b[11]=b[11]*a,b[15]=b[15]*a,this},multiplyVector3:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]);return a.x=(b[0]*c+b[4]*d+b[8]*e+b[12])*f,a.y=(b[1]*c+b[5]*d+b[9]*e+b[13])*f,a.z=(b[2]*c+b[6]*d+b[10]*e+b[14])*f,a},multiplyVector4:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w;return a.x=b[0]*c+b[4]*d+b[8]*e+b[12]*f,a.y=b[1]*c+b[5]*d+b[9]*e+b[13]*f,a.z=b[2]*c+b[6]*d+b[10]*e+b[14]*f,a.w=b[3]*c+b[7]*d+b[11]*e+b[15]*f,a},rotateAxis:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return a.x=c*b[0]+d*b[4]+e*b[8],a.y=c*b[1]+d*b[5]+e*b[9],a.z=c*b[2]+d*b[6]+e*b[10],a.normalize(),a},crossVector:function(b){var c=this.elements,d=new a.Vector4;return d.x=c[0]*b.x+c[4]*b.y+c[8]*b.z+c[12]*b.w,d.y=c[1]*b.x+c[5]*b.y+c[9]*b.z+c[13]*b.w,d.z=c[2]*b.x+c[6]*b.y+c[10]*b.z+c[14]*b.w,d.w=b.w?c[3]*b.x+c[7]*b.y+c[11]*b.z+c[15]*b.w:1,d},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],a=a[15];return e*h*k*n-d*i*k*n-e*g*l*n+c*i*l*n+d*g*m*n-c*h*m*n-e*h*j*o+d*i*j*o+e*f*l*o-b*i*l*o-d*f*m*o+b*h*m*o+e*g*j*p-c*i*j*p-e*f*k*p+b*i*k*p+c*f*m*p-b*g*m*p-d*g*j*a+c*h*j*a+d*f*k*a-b*h*k*a-c*f*l*a+b*g*l*a},transpose:function(){var a=this.elements,b;return b=a[1],a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,this},flattenToArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var b=this.elements;return a.Matrix4.__v1.set(b[12],b[13],b[14])},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getColumnX:function(){var b=this.elements;return a.Matrix4.__v1.set(b[0],b[1],b[2])},getColumnY:function(){var b=this.elements;return a.Matrix4.__v1.set(b[4],b[5],b[6])},getColumnZ:function(){var b=this.elements;return a.Matrix4.__v1.set(b[8],b[9],b[10])},getInverse:function(a){var b=this.elements,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[12],h=c[1],i=c[5],j=c[9],k=c[13],l=c[2],m=c[6],n=c[10],o=c[14],p=c[3],q=c[7],r=c[11],c=c[15];return b[0]=j*o*q-k*n*q+k*m*r-i*o*r-j*m*c+i*n*c,b[4]=g*n*q-f*o*q-g*m*r+e*o*r+f*m*c-e*n*c,b[8]=f*k*q-g*j*q+g*i*r-e*k*r-f*i*c+e*j*c,b[12]=g*j*m-f*k*m-g*i*n+e*k*n+f*i*o-e*j*o,b[1]=k*n*p-j*o*p-k*l*r+h*o*r+j*l*c-h*n*c,b[5]=f*o*p-g*n*p+g*l*r-d*o*r-f*l*c+d*n*c,b[9]=g*j*p-f*k*p-g*h*r+d*k*r+f*h*c-d*j*c,b[13]=f*k*l-g*j*l+g*h*n-d*k*n-f*h*o+d*j*o,b[2]=i*o*p-k*m*p+k*l*q-h*o*q-i*l*c+h*m*c,b[6]=g*m*p-e*o*p-g*l*q+d*o*q+e*l*c-d*m*c,b[10]=e*k*p-g*i*p+g*h*q-d*k*q-e*h*c+d*i*c,b[14]=g*i*l-e*k*l-g*h*m+d*k*m+e*h*o-d*i*o,b[3]=j*m*p-i*n*p-j*l*q+h*n*q+i*l*r-h*m*r,b[7]=e*n*p-f*m*p+f*l*q-d*n*q-e*l*r+d*m*r,b[11]=f*i*p-e*j*p-f*h*q+d*j*q+e*h*r-d*i*r,b[15]=e*j*l-f*i*l+f*h*m-d*j*m-e*h*n+d*i*n,this.multiplyScalar(1/a.determinant()),this},setRotationFromEuler:function(a,b){var c=this.elements,d=a.x,e=a.y,f=a.z,g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e),i=Math.cos(f),f=Math.sin(f);switch(b){case"YXZ":var j=h*i,k=h*f,l=e*i,m=e*f;c[0]=j+m*d,c[4]=l*d-k,c[8]=g*e,c[1]=g*f,c[5]=g*i,c[9]=-d,c[2]=k*d-l,c[6]=m+j*d,c[10]=g*h;break;case"ZXY":j=h*i,k=h*f,l=e*i,m=e*f,c[0]=j-m*d,c[4]=-g*f,c[8]=l+k*d,c[1]=k+l*d,c[5]=g*i,c[9]=m-j*d,c[2]=-g*e,c[6]=d,c[10]=g*h;break;case"ZYX":j=g*i,k=g*f,l=d*i,m=d*f,c[0]=h*i,c[4]=l*e-k,c[8]=j*e+m,c[1]=h*f,c[5]=m*e+j,c[9]=k*e-l,c[2]=-e,c[6]=d*h,c[10]=g*h;break;case"YZX":j=g*h,k=g*e,l=d*h,m=d*e,c[0]=h*i,c[4]=m-j*f,c[8]=l*f+k,c[1]=f,c[5]=g*i,c[9]=-d*i,c[2]=-e*i,c[6]=k*f+l,c[10]=j-m*f;break;case"XZY":j=g*h,k=g*e,l=d*h,m=d*e,c[0]=h*i,c[4]=-f,c[8]=e*i,c[1]=j*f+m,c[5]=g*i,c[9]=k*f-l,c[2]=l*f-k,c[6]=d*i,c[10]=m*f+j;break;default:j=g*i,k=g*f,l=d*i,m=d*f,c[0]=h*i,c[4]=-h*f,c[8]=e,c[1]=k+l*e,c[5]=j-m*e,c[9]=-d*h,c[2]=m-j*e,c[6]=l+k*e,c[10]=g*h}return this},setRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,a=c*g,j=c*h,c=c*i,k=d*h,d=d*i,e=e*i,g=f*g,h=f*h,f=f*i;return b[0]=1-(k+e),b[4]=j-f,b[8]=c+h,b[1]=j+f,b[5]=1-(a+e),b[9]=d-g,b[2]=c-h,b[6]=d+g,b[10]=1-(a+k),this},compose:function(b,c,d){var e=this.elements,f=a.Matrix4.__m1,g=a.Matrix4.__m2;return f.identity(),f.setRotationFromQuaternion(c),g.makeScale(d.x,d.y,d.z),this.multiply(f,g),e[12]=b.x,e[13]=b.y,e[14]=b.z,this},decompose:function(b,c,d){var e=this.elements,f=a.Matrix4.__v1,g=a.Matrix4.__v2,h=a.Matrix4.__v3;return f.set(e[0],e[1],e[2]),g.set(e[4],e[5],e[6]),h.set(e[8],e[9],e[10]),b=b instanceof a.Vector3?b:new a.Vector3,c=c instanceof a.Quaternion?c:new a.Quaternion,d=d instanceof a.Vector3?d:new a.Vector3,d.x=f.length(),d.y=g.length(),d.z=h.length(),b.x=e[12],b.y=e[13],b.z=e[14],e=a.Matrix4.__m1,e.copy(this),e.elements[0]=e.elements[0]/d.x,e.elements[1]=e.elements[1]/d.x,e.elements[2]=e.elements[2]/d.x,e.elements[4]=e.elements[4]/d.y,e.elements[5]=e.elements[5]/d.y,e.elements[6]=e.elements[6]/d.y,e.elements[8]=e.elements[8]/d.z,e.elements[9]=e.elements[9]/d.z,e.elements[10]=e.elements[10]/d.z,c.setFromRotationMatrix(e),[b,c,d]},extractPosition:function(a){var b=this.elements,a=a.elements;return b[12]=a[12],b[13]=a[13],b[14]=a[14],this},extractRotation:function(b){var c=this.elements,b=b.elements,d=a.Matrix4.__v1,e=1/d.set(b[0],b[1],b[2]).length(),f=1/d.set(b[4],b[5],b[6]).length(),d=1/d.set(b[8],b[9],b[10]).length();return c[0]=b[0]*e,c[1]=b[1]*e,c[2]=b[2]*e,c[4]=b[4]*f,c[5]=b[5]*f,c[6]=b[6]*f,c[8]=b[8]*d,c[9]=b[9]*d,c[10]=b[10]*d,this},translate:function(a){var b=this.elements,c=a.x,d=a.y,a=a.z;return b[12]=b[0]*c+b[4]*d+b[8]*a+b[12],b[13]=b[1]*c+b[5]*d+b[9]*a+b[13],b[14]=b[2]*c+b[6]*d+b[10]*a+b[14],b[15]=b[3]*c+b[7]*d+b[11]*a+b[15],this},rotateX:function(a){var b=this.elements,c=b[4],d=b[5],e=b[6],f=b[7],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),a=Math.sin(a);return b[4]=k*c+a*g,b[5]=k*d+a*h,b[6]=k*e+a*i,b[7]=k*f+a*j,b[8]=k*g-a*c,b[9]=k*h-a*d,b[10]=k*i-a*e,b[11]=k*j-a*f,this},rotateY:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),a=Math.sin(a);return b[0]=k*c-a*g,b[1]=k*d-a*h,b[2]=k*e-a*i,b[3]=k*f-a*j,b[8]=k*g+a*c,b[9]=k*h+a*d,b[10]=k*i+a*e,b[11]=k*j+a*f,this},rotateZ:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=Math.cos(a),a=Math.sin(a);return b[0]=k*c+a*g,b[1]=k*d+a*h,b[2]=k*e+a*i,b[3]=k*f+a*j,b[4]=k*g-a*c,b[5]=k*h-a*d,b[6]=k*i-a*e,b[7]=k*j-a*f,this},rotateByAxis:function(a,b){var c=this.elements;if(a.x===1&&a.y===0&&a.z===0)return this.rotateX(b);if(a.x===0&&a.y===1&&a.z===0)return this.rotateY(b);if(a.x===0&&a.y===0&&a.z===1)return this.rotateZ(b);var d=a.x,e=a.y,f=a.z,g=Math.sqrt(d*d+e*e+f*f),d=d/g,e=e/g,f=f/g,g=d*d,h=e*e,i=f*f,j=Math.cos(b),k=Math.sin(b),l=1-j,m=d*e*l,n=d*f*l,l=e*f*l,d=d*k,o=e*k,k=f*k,f=g+(1-g)*j,g=m+k,e=n-o,m=m-k,h=h+(1-h)*j,k=l+d,n=n+o,l=l-d,i=i+(1-i)*j,j=c[0],d=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8],v=c[9],w=c[10],x=c[11];return c[0]=f*j+g*q+e*u,c[1]=f*d+g*r+e*v,c[2]=f*o+g*s+e*w,c[3]=f*p+g*t+e*x,c[4]=m*j+h*q+k*u,c[5]=m*d+h*r+k*v,c[6]=m*o+h*s+k*w,c[7]=m*p+h*t+k*x,c[8]=n*j+l*q+i*u,c[9]=n*d+l*r+i*v,c[10]=n*o+l*s+i*w,c[11]=n*p+l*t+i*x,this},scale:function(a){var b=this.elements,c=a.x,d=a.y,a=a.z;return b[0]=b[0]*c,b[4]=b[4]*d,b[8]=b[8]*a,b[1]=b[1]*c,b[5]=b[5]*d,b[9]=b[9]*a,b[2]=b[2]*c,b[6]=b[6]*d,b[10]=b[10]*a,b[3]=b[3]*c,b[7]=b[7]*d,b[11]=b[11]*a,this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),a=Math.sin(a);return this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),a=Math.sin(a);return this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),a=Math.sin(a);return this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},makeFrustum:function(a,b,c,d,e,f){var g=this.elements;return g[0]=2*e/(b-a),g[4]=0,g[8]=(b+a)/(b-a),g[12]=0,g[1]=0,g[5]=2*e/(d-c),g[9]=(d+c)/(d-c),g[13]=0,g[2]=0,g[6]=0,g[10]=-(f+e)/(f-e),g[14]=-2*f*e/(f-e),g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){var a=c*Math.tan(a*Math.PI/360),e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-((b+a)/h),g[1]=0,g[5]=2/i,g[9]=0,g[13]=-((c+d)/i),g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-((f+e)/j),g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},clone:function(){var b=this.elements;return new a.Matrix4(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15])}},a.Matrix4.__v1=new a.Vector3,a.Matrix4.__v2=new a.Vector3,a.Matrix4.__v3=new a.Vector3,a.Matrix4.__m1=new a.Matrix4,a.Matrix4.__m2=new a.Matrix4,a.Object3D=function(){this.id=a.Object3DCount++,this.name="",this.parent=void 0,this.children=[],this.up=new a.Vector3(0,1,0),this.position=new a.Vector3,this.rotation=new a.Vector3,this.eulerOrder="XYZ",this.scale=new a.Vector3(1,1,1),this.flipSided=this.doubleSided=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new a.Matrix4,this.matrixWorld=new a.Matrix4,this.matrixRotationWorld=new a.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new a.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new a.Vector3},a.Object3D.prototype={constructor:a.Object3D,applyMatrix:function(a){this.matrix.multiply(a,this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.rotation.getRotationFromMatrix(this.matrix,this.scale),this.position.getPositionFromMatrix(this.matrix)},translate:function(a,b){this.matrix.rotateAxis(b),this.position.addSelf(b.multiplyScalar(a))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(b){if(b===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(b instanceof a.Object3D){b.parent!==void 0&&b.parent.remove(b),b.parent=this,this.children.push(b);for(var c=this;c.parent!==void 0;)c=c.parent;c!==void 0&&c instanceof a.Scene&&c.__addObject(b)}},remove:function(b){var c=this.children.indexOf(b);if(c!==-1){b.parent=void 0,this.children.splice(c,1);for(c=this;c.parent!==void 0;)c=c.parent;c!==void 0&&c instanceof a.Scene&&c.__removeObject(b)}},getChildByName:function(a,b){var c,d,e;c=0;for(d=this.children.length;c<d;c++){e=this.children[c];if(e.name===a)return e;if(b){e=e.getChildByName(a,b);if(e!==void 0)return e}}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)}},a.Object3DCount=0,a.Projector=function(){function b(){var b=h[g]=h[g]||new a.RenderableObject;return g++,b}function c(){var b=k[j]=k[j]||new a.RenderableVertex;return j++,b}function d(a,b){return b.z-a.z}function e(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:e<0&&f<0||g<0&&h<0?!1:(e<0?c=Math.max(c,e/(e-f)):f<0&&(d=Math.min(d,e/(e-f))),g<0?c=Math.max(c,g/(g-h)):h<0&&(d=Math.min(d,g/(g-h))),d<c?!1:(a.lerpSelf(b,c),b.lerpSelf(a,1-d),!0))}var f,g,h=[],i,j,k=[],l,m,n=[],o,p=[],q,r,s=[],t,u,v=[],w={objects:[],sprites:[],lights:[],elements:[]},x=new a.Vector3,y=new a.Vector4,z=new a.Matrix4,A=new a.Matrix4,B=new a.Frustum,C=new a.Vector4,D=new a.Vector4;this.projectVector=function(a,b){return b.matrixWorldInverse.getInverse(b.matrixWorld),z.multiply(b.projectionMatrix,b.matrixWorldInverse),z.multiplyVector3(a),a},this.unprojectVector=function(a,b){return b.projectionMatrixInverse.getInverse(b.projectionMatrix),z.multiply(b.matrixWorld,b.projectionMatrixInverse),z.multiplyVector3(a),a},this.pickingRay=function(b,c){var d;return b.z=-1,d=new a.Vector3(b.x,b.y,1),this.unprojectVector(b,c),this.unprojectVector(d,c),d.subSelf(b).normalize(),new a.Ray(b,d)},this.projectGraph=function(c,e){g=0,w.objects.length=0,w.sprites.length=0,w.lights.length=0;var h=function(c){if(c.visible!==!1){(c instanceof a.Mesh||c instanceof a.Line)&&(c.frustumCulled===!1||B.contains(c))?(x.copy(c.matrixWorld.getPosition()),z.multiplyVector3(x),f=b(),f.object=c,f.z=x.z,w.objects.push(f)):c instanceof a.Sprite||c instanceof a.Particle?(x.copy(c.matrixWorld.getPosition()),z.multiplyVector3(x),f=b(),f.object=c,f.z=x.z,w.sprites.push(f)):c instanceof a.Light&&w.lights.push(c);for(var d=0,e=c.children.length;d<e;d++)h(c.children[d])}};return h(c),e&&w.objects.sort(d),w},this.projectScene=function(b,f,g){var h=f.near,x=f.far,F=!1,G,H,I,L,M,N,O,P,Q,R,S,T,U,V,W;u=r=o=m=0,w.elements.length=0,f.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),b.add(f)),b.updateMatrixWorld(),f.matrixWorldInverse.getInverse(f.matrixWorld),z.multiply(f.projectionMatrix,f.matrixWorldInverse),B.setFromMatrix(z),w=this.projectGraph(b,!1),b=0;for(G=w.objects.length;b<G;b++){Q=w.objects[b].object,R=Q.matrixWorld,j=0;if(Q instanceof a.Mesh){S=Q.geometry,T=Q.geometry.materials,L=S.vertices,U=S.faces,V=S.faceVertexUvs,S=Q.matrixRotationWorld.extractRotation(R),H=0;for(I=L.length;H<I;H++)i=c(),i.positionWorld.copy(L[H]),R.multiplyVector3(i.positionWorld),i.positionScreen.copy(i.positionWorld),z.multiplyVector4(i.positionScreen),i.positionScreen.x=i.positionScreen.x/i.positionScreen.w,i.positionScreen.y=i.positionScreen.y/i.positionScreen.w,i.visible=i.positionScreen.z>h&&i.positionScreen.z<x;L=0;for(H=U.length;L<H;L++){I=U[L];if(I instanceof a.Face3){M=k[I.a],N=k[I.b],O=k[I.c];if(!(M.visible&&N.visible&&O.visible))continue;F=(O.positionScreen.x-M.positionScreen.x)*(N.positionScreen.y-M.positionScreen.y)-(O.positionScreen.y-M.positionScreen.y)*(N.positionScreen.x-M.positionScreen.x)<0;if(!Q.doubleSided&&F==Q.flipSided)continue;P=n[m]=n[m]||new a.RenderableFace3,m++,l=P,l.v1.copy(M),l.v2.copy(N),l.v3.copy(O)}else if(I instanceof a.Face4){M=k[I.a],N=k[I.b],O=k[I.c],P=k[I.d];if(!(M.visible&&N.visible&&O.visible&&P.visible))continue;F=(P.positionScreen.x-M.positionScreen.x)*(N.positionScreen.y-M.positionScreen.y)-(P.positionScreen.y-M.positionScreen.y)*(N.positionScreen.x-M.positionScreen.x)<0||(N.positionScreen.x-O.positionScreen.x)*(P.positionScreen.y-O.positionScreen.y)-(N.positionScreen.y-O.positionScreen.y)*(P.positionScreen.x-O.positionScreen.x)<0;if(!Q.doubleSided&&F==Q.flipSided)continue;W=p[o]=p[o]||new a.RenderableFace4,o++,l=W,l.v1.copy(M),l.v2.copy(N),l.v3.copy(O),l.v4.copy(P)}l.normalWorld.copy(I.normal),!F&&(Q.flipSided||Q.doubleSided)&&l.normalWorld.negate(),S.multiplyVector3(l.normalWorld),l.centroidWorld.copy(I.centroid),R.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),z.multiplyVector3(l.centroidScreen),O=I.vertexNormals,M=0;for(N=O.length;M<N;M++)P=l.vertexNormalsWorld[M],P.copy(O[M]),!F&&(Q.flipSided||Q.doubleSided)&&P.negate(),S.multiplyVector3(P);M=0;for(N=V.length;M<N;M++)if(W=V[M][L]){O=0;for(P=W.length;O<P;O++)l.uvs[M][O]=W[O]}l.material=Q.material,l.faceMaterial=I.materialIndex!==null?T[I.materialIndex]:null,l.z=l.centroidScreen.z,w.elements.push(l)}}else if(Q instanceof a.Line){A.multiply(z,R),L=Q.geometry.vertices,M=c(),M.positionScreen.copy(L[0]),A.multiplyVector4(M.positionScreen),R=Q.type===a.LinePieces?2:1,H=1;for(I=L.length;H<I;H++)M=c(),M.positionScreen.copy(L[H]),A.multiplyVector4(M.positionScreen),(H+1)%R>0||(N=k[j-2],C.copy(M.positionScreen),D.copy(N.positionScreen),e(C,D)&&(C.multiplyScalar(1/C.w),D.multiplyScalar(1/D.w),T=s[r]=s[r]||new a.RenderableLine,r++,q=T,q.v1.positionScreen.copy(C),q.v2.positionScreen.copy(D),q.z=Math.max(C.z,D.z),q.material=Q.material,w.elements.push(q)))}}b=0;for(G=w.sprites.length;b<G;b++)Q=w.sprites[b].object,R=Q.matrixWorld,Q instanceof a.Particle&&(y.set(R.elements[12],R.elements[13],R.elements[14],1),z.multiplyVector4(y),y.z=y.z/y.w,y.z>0&&y.z<1&&(h=v[u]=v[u]||new a.RenderableParticle,u++,t=h,t.x=y.x/y.w,t.y=y.y/y.w,t.z=y.z,t.rotation=Q.rotation.z,t.scale.x=Q.scale.x*Math.abs(t.x-(y.x+f.projectionMatrix.elements[0])/(y.w+f.projectionMatrix.elements[12])),t.scale.y=Q.scale.y*Math.abs(t.y-(y.y+f.projectionMatrix.elements[5])/(y.w+f.projectionMatrix.elements[13])),t.material=Q.material,w.elements.push(t)));return g&&w.elements.sort(d),w}},a.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==void 0?d:1},a.Quaternion.prototype={constructor:a.Quaternion,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},setFromEuler:function(a){var b=Math.PI/360,c=a.x*b,d=a.y*b,e=a.z*b,a=Math.cos(d),d=Math.sin(d),b=Math.cos(-e),e=Math.sin(-e),f=Math.cos(c),c=Math.sin(c),g=a*b,h=d*e;return this.w=g*f-h*c,this.x=g*c+h*f,this.y=d*b*f+a*e*c,this.z=a*e*f-d*b*c,this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},setFromRotationMatrix:function(a){var b=Math.pow(a.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,b+a.elements[0]+a.elements[5]+a.elements[10]))/2,this.x=Math.sqrt(Math.max(0,b+a.elements[0]-a.elements[5]-a.elements[10]))/2,this.y=Math.sqrt(Math.max(0,b-a.elements[0]+a.elements[5]-a.elements[10]))/2,this.z=Math.sqrt(Math.max(0,b-a.elements[0]-a.elements[5]+a.elements[10]))/2,this.x=a.elements[6]-a.elements[9]<0?-Math.abs(this.x):Math.abs(this.x),this.y=a.elements[8]-a.elements[2]<0?-Math.abs(this.y):Math.abs(this.y),this.z=a.elements[1]-a.elements[4]<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=this.x*-1,this.y=this.y*-1,this.z=this.z*-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a===0?this.w=this.z=this.y=this.x=0:(a=1/a,this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this.w=this.w*a),this},multiply:function(a,b){return this.x=a.x*b.w+a.y*b.z-a.z*b.y+a.w*b.x,this.y=-a.x*b.z+a.y*b.w+a.z*b.x+a.w*b.y,this.z=a.x*b.y-a.y*b.x+a.z*b.w+a.w*b.z,this.w=-a.x*b.x-a.y*b.y-a.z*b.z+a.w*b.w,this},multiplySelf:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.x,g=a.y,h=a.z,a=a.w;return this.x=b*a+e*f+c*h-d*g,this.y=c*a+e*g+d*f-b*h,this.z=d*a+e*h+b*g-c*f,this.w=e*a-b*f-c*g-d*h,this},multiplyVector3:function(a,b){b||(b=a);var c=a.x,d=a.y,e=a.z,f=this.x,g=this.y,h=this.z,i=this.w,j=i*c+g*e-h*d,k=i*d+h*c-f*e,l=i*e+f*d-g*c,c=-f*c-g*d-h*e;return b.x=j*i+c*-f+k*-h-l*-g,b.y=k*i+c*-g+l*-f-j*-h,b.z=l*i+c*-h+j*-g-k*-f,b},clone:function(){return new a.Quaternion(this.x,this.y,this.z,this.w)}},a.Quaternion.slerp=function(a,b,c,d){var e=a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z;e<0?(c.w=-b.w,c.x=-b.x,c.y=-b.y,c.z=-b.z,e=-e):c.copy(b);if(Math.abs(e)>=1)return c.w=a.w,c.x=a.x,c.y=a.y,c.z=a.z,c;var f=Math.acos(e),e=Math.sqrt(1-e*e);return Math.abs(e)<.001?(c.w=.5*(a.w+b.w),c.x=.5*(a.x+b.x),c.y=.5*(a.y+b.y),c.z=.5*(a.z+b.z),c):(b=Math.sin((1-d)*f)/e,d=Math.sin(d*f)/e,c.w=a.w*b+c.w*d,c.x=a.x*b+c.x*d,c.y=a.y*b+c.y*d,c.z=a.z*b+c.z*d,c)},a.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},a.Face3=function(b,c,d,e,f,g){this.a=b,this.b=c,this.c=d,this.normal=e instanceof a.Vector3?e:new a.Vector3,this.vertexNormals=e instanceof Array?e:[],this.color=f instanceof a.Color?f:new a.Color,this.vertexColors=f instanceof Array?f:[],this.vertexTangents=[],this.materialIndex=g,this.centroid=new a.Vector3},a.Face3.prototype={constructor:a.Face3,clone:function(){var b=new a.Face3(this.a,this.b,this.c);b.normal.copy(this.normal),b.color.copy(this.color),b.centroid.copy(this.centroid),b.materialIndex=this.materialIndex;var c,d;c=0;for(d=this.vertexNormals.length;c<d;c++)b.vertexNormals[c]=this.vertexNormals[c].clone();c=0;for(d=this.vertexColors.length;c<d;c++)b.vertexColors[c]=this.vertexColors[c].clone();c=0;for(d=this.vertexTangents.length;c<d;c++)b.vertexTangents[c]=this.vertexTangents[c].clone();return b}},a.Face4=function(b,c,d,e,f,g,h){this.a=b,this.b=c,this.c=d,this.d=e,this.normal=f instanceof a.Vector3?f:new a.Vector3,this.vertexNormals=f instanceof Array?f:[],this.color=g instanceof a.Color?g:new a.Color,this.vertexColors=g instanceof Array?g:[],this.vertexTangents=[],this.materialIndex=h,this.centroid=new a.Vector3},a.Face4.prototype={constructor:a.Face4,clone:function(){var b=new a.Face4(this.a,this.b,this.c,this.d);b.normal.copy(this.normal),b.color.copy(this.color),b.centroid.copy(this.centroid),b.materialIndex=this.materialIndex;var c,d;c=0;for(d=this.vertexNormals.length;c<d;c++)b.vertexNormals[c]=this.vertexNormals[c].clone();c=0;for(d=this.vertexColors.length;c<d;c++)b.vertexColors[c]=this.vertexColors[c].clone();c=0;for(d=this.vertexTangents.length;c<d;c++)b.vertexTangents[c]=this.vertexTangents[c].clone();return b}},a.UV=function(a,b){this.u=a||0,this.v=b||0},a.UV.prototype={constructor:a.UV,set:function(a,b){return this.u=a,this.v=b,this},copy:function(a){return this.u=a.u,this.v=a.v,this},lerpSelf:function(a,b){return this.u=this.u+(a.u-this.u)*b,this.v=this.v+(a.v-this.v)*b,this},clone:function(){return new a.UV(this.u,this.v)}},a.Geometry=function(){this.id=a.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},a.Geometry.prototype={constructor:a.Geometry,applyMatrix:function(b){var c=new a.Matrix4;c.extractRotation(b);for(var d=0,e=this.vertices.length;d<e;d++)b.multiplyVector3(this.vertices[d]);d=0;for(e=this.faces.length;d<e;d++){var f=this.faces[d];c.multiplyVector3(f.normal);for(var g=0,h=f.vertexNormals.length;g<h;g++)c.multiplyVector3(f.vertexNormals[g]);b.multiplyVector3(f.centroid)}},computeCentroids:function(){var b,c,d;b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d.centroid.set(0,0,0),d instanceof a.Face3?(d.centroid.addSelf(this.vertices[d.a]),d.centroid.addSelf(this.vertices[d.b]),d.centroid.addSelf(this.vertices[d.c]),d.centroid.divideScalar(3)):d instanceof a.Face4&&(d.centroid.addSelf(this.vertices[d.a]),d.centroid.addSelf(this.vertices[d.b]),d.centroid.addSelf(this.vertices[d.c]),d.centroid.addSelf(this.vertices[d.d]),d.centroid.divideScalar(4))},computeFaceNormals:function(){var b,c,d,e,f,g,h=new a.Vector3,i=new a.Vector3;b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],e=this.vertices[d.a],f=this.vertices[d.b],g=this.vertices[d.c],h.sub(g,f),i.sub(e,f),h.crossSelf(i),h.isZero()||h.normalize(),d.normal.copy(h)},computeVertexNormals:function(){var b,c,d,e;if(this.__tmpVertices===void 0){e=this.__tmpVertices=Array(this.vertices.length),b=0;for(c=this.vertices.length;b<c;b++)e[b]=new a.Vector3;b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d instanceof a.Face3?d.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3]:d instanceof a.Face4&&(d.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3])}else{e=this.__tmpVertices,b=0;for(c=this.vertices.length;b<c;b++)e[b].set(0,0,0)}b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d instanceof a.Face3?(e[d.a].addSelf(d.normal),e[d.b].addSelf(d.normal),e[d.c].addSelf(d.normal)):d instanceof a.Face4&&(e[d.a].addSelf(d.normal),e[d.b].addSelf(d.normal),e[d.c].addSelf(d.normal),e[d.d].addSelf(d.normal));b=0;for(c=this.vertices.length;b<c;b++)e[b].normalize();b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d instanceof a.Face3?(d.vertexNormals[0].copy(e[d.a]),d.vertexNormals[1].copy(e[d.b]),d.vertexNormals[2].copy(e[d.c])):d instanceof a.Face4&&(d.vertexNormals[0].copy(e[d.a]),d.vertexNormals[1].copy(e[d.b]),d.vertexNormals[2].copy(e[d.c]),d.vertexNormals[3].copy(e[d.d]))},computeMorphNormals:function(){var b,c,d,e,f;d=0;for(e=this.faces.length;d<e;d++){f=this.faces[d],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]),b=0;for(c=f.vertexNormals.length;b<c;b++)f.__originalVertexNormals[b]?f.__originalVertexNormals[b].copy(f.vertexNormals[b]):f.__originalVertexNormals[b]=f.vertexNormals[b].clone()}var g=new a.Geometry;g.faces=this.faces,b=0;for(c=this.morphTargets.length;b<c;b++){if(!this.morphNormals[b]){this.morphNormals[b]={},this.morphNormals[b].faceNormals=[],this.morphNormals[b].vertexNormals=[];var h=this.morphNormals[b].faceNormals,i=this.morphNormals[b].vertexNormals,j,k;d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],j=new a.Vector3,k=f instanceof a.Face3?{a:new a.Vector3,b:new a.Vector3,c:new a.Vector3}:{a:new a.Vector3,b:new a.Vector3,c:new a.Vector3,d:new a.Vector3},h.push(j),i.push(k)}h=this.morphNormals[b],g.vertices=this.morphTargets[b].vertices,g.computeFaceNormals(),g.computeVertexNormals(),d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],j=h.faceNormals[d],k=h.vertexNormals[d],j.copy(f.normal),f instanceof a.Face3?(k.a.copy(f.vertexNormals[0]),k.b.copy(f.vertexNormals[1]),k.c.copy(f.vertexNormals[2])):(k.a.copy(f.vertexNormals[0]),k.b.copy(f.vertexNormals[1]),k.c.copy(f.vertexNormals[2]),k.d.copy(f.vertexNormals[3]))}d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){function b(a,b,c,d,e,f,g){i=a.vertices[b],j=a.vertices[c],k=a.vertices[d],l=h[e],m=h[f],n=h[g],o=j.x-i.x,p=k.x-i.x,q=j.y-i.y,r=k.y-i.y,s=j.z-i.z,t=k.z-i.z,u=m.u-l.u,v=n.u-l.u,w=m.v-l.v,x=n.v-l.v,y=1/(u*x-v*w),C.set((x*o-w*p)*y,(x*q-w*r)*y,(x*s-w*t)*y),D.set((u*p-v*o)*y,(u*r-v*q)*y,(u*t-v*s)*y),A[b].addSelf(C),A[c].addSelf(C),A[d].addSelf(C),B[b].addSelf(D),B[c].addSelf(D),B[d].addSelf(D)}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=[],B=[],C=new a.Vector3,D=new a.Vector3,E=new a.Vector3,F=new a.Vector3,G=new a.Vector3;c=0;for(d=this.vertices.length;c<d;c++)A[c]=new a.Vector3,B[c]=new a.Vector3;c=0;for(d=this.faces.length;c<d;c++)g=this.faces[c],h=this.faceVertexUvs[0][c],g instanceof a.Face3?b(this,g.a,g.b,g.c,0,1,2):g instanceof a.Face4&&(b(this,g.a,g.b,g.d,0,1,3),b(this,g.b,g.c,g.d,1,2,3));var H=["a","b","c","d"];c=0;for(d=this.faces.length;c<d;c++){g=this.faces[c];for(e=0;e<g.vertexNormals.length;e++)G.copy(g.vertexNormals[e]),f=g[H[e]],z=A[f],E.copy(z),E.subSelf(G.multiplyScalar(G.dot(z))).normalize(),F.cross(g.vertexNormals[e],z),f=F.dot(B[f]),f=f<0?-1:1,g.vertexTangents[e]=new a.Vector4(E.x,E.y,E.z,f)}this.hasTangents=!0},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new a.Vector3,max:new a.Vector3});if(this.vertices.length>0){var b;b=this.vertices[0],this.boundingBox.min.copy(b),this.boundingBox.max.copy(b);for(var c=this.boundingBox.min,d=this.boundingBox.max,e=1,f=this.vertices.length;e<f;e++)b=this.vertices[e],b.x<c.x?c.x=b.x:b.x>d.x&&(d.x=b.x),b.y<c.y?c.y=b.y:b.y>d.y&&(d.y=b.y),b.z<c.z?c.z=b.z:b.z>d.z&&(d.z=b.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});for(var a,b=0,c=0,d=this.vertices.length;c<d;c++)a=this.vertices[c].length(),a>b&&(b=a);this.boundingSphere.radius=b},mergeVertices:function(){var b={},c=[],d=[],e,f=Math.pow(10,4),g,h,i;g=0;for(h=this.vertices.length;g<h;g++)e=this.vertices[g],e=[Math.round(e.x*f),Math.round(e.y*f),Math.round(e.z*f)].join("_"),b[e]===void 0?(b[e]=g,c.push(this.vertices[g]),d[g]=c.length-1):d[g]=d[b[e]];g=0;for(h=this.faces.length;g<h;g++){f=this.faces[g];if(f instanceof a.Face3)f.a=d[f.a],f.b=d[f.b],f.c=d[f.c];else if(f instanceof a.Face4){f.a=d[f.a],f.b=d[f.b],f.c=d[f.c],f.d=d[f.d],e=[f.a,f.b,f.c,f.d];for(b=3;b>0;b--)if(e.indexOf(f["abcd"[b]])!=b){e.splice(b,1),this.faces[g]=new a.Face3(e[0],e[1],e[2]),f=0;for(e=this.faceVertexUvs.length;f<e;f++)(i=this.faceVertexUvs[f][g])&&i.splice(b,1);break}}}return d=this.vertices.length-c.length,this.vertices=c,d}},a.GeometryCount=0,a.Spline=function(b){function c(a,b,c,d,e,f,g){return a=(c-a)*.5,d=(d-b)*.5,(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=b;var d=[],e={x:0,y:0,z:0},f,g,h,i,j,k,l,m,n;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return f=(this.points.length-1)*a,g=Math.floor(f),h=f-g,d[0]=g===0?g:g-1,d[1]=g,d[2]=g>this.points.length-2?this.points.length-1:g+1,d[3]=g>this.points.length-3?this.points.length-1:g+2,k=this.points[d[0]],l=this.points[d[1]],m=this.points[d[2]],n=this.points[d[3]],i=h*h,j=h*i,e.x=c(k.x,l.x,m.x,n.x,h,i,j),e.y=c(k.y,l.y,m.y,n.y,h,i,j),e.z=c(k.z,l.z,m.z,n.z,h,i,j),e},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(b){var c,d,e,f=c=c=0,g=new a.Vector3,h=new a.Vector3,i=[],j=0;i[0]=0,b||(b=100),d=this.points.length*b,g.copy(this.points[0]);for(b=1;b<d;b++)c=b/d,e=this.getPoint(c),h.copy(e),j+=h.distanceTo(g),g.copy(e),c=(this.points.length-1)*c,c=Math.floor(c),c!=f&&(i[c]=j,f=c);return i[i.length]=j,{chunks:i,total:j}},this.reparametrizeByArcLength=function(b){var c,d,e,f,g,h,i=[],j=new a.Vector3,k=this.getLength();i.push(j.copy(this.points[0]).clone());for(c=1;c<this.points.length;c++){d=k.chunks[c]-k.chunks[c-1],h=Math.ceil(b*d/k.total),f=(c-1)/(this.points.length-1),g=c/(this.points.length-1);for(d=1;d<h-1;d++)e=f+d*(1/h)*(g-f),e=this.getPoint(e),i.push(j.copy(e).clone());i.push(j.copy(this.points[c]).clone())}this.points=i}},a.Camera=function(){a.Object3D.call(this),this.matrixWorldInverse=new a.Matrix4,this.projectionMatrix=new a.Matrix4,this.projectionMatrixInverse=new a.Matrix4},a.Camera.prototype=new a.Object3D,a.Camera.prototype.constructor=a.Camera,a.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},a.OrthographicCamera=function(b,c,d,e,f,g){a.Camera.call(this),this.left=b,this.right=c,this.top=d,this.bottom=e,this.near=f!==void 0?f:.1,this.far=g!==void 0?g:2e3,this.updateProjectionMatrix()},a.OrthographicCamera.prototype=new a.Camera,a.OrthographicCamera.prototype.constructor=a.OrthographicCamera,a.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},a.PerspectiveCamera=function(b,c,d,e){a.Camera.call(this),this.fov=b!==void 0?b:50,this.aspect=c!==void 0?c:1,this.near=d!==void 0?d:.1,this.far=e!==void 0?e:2e3,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype=new a.Camera,a.PerspectiveCamera.prototype.constructor=a.PerspectiveCamera,a.PerspectiveCamera.prototype.setLens=function(a,b){this.fov=2*Math.atan((b!==void 0?b:24)/(a*2))*(180/Math.PI),this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(this.fov*Math.PI/360)*this.near,c=-b,d=a*c,a=Math.abs(a*b-d),c=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*a/this.fullWidth,d+(this.x+this.width)*a/this.fullWidth,b-(this.y+this.height)*c/this.fullHeight,b-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},a.Light=function(b){a.Object3D.call(this),this.color=new a.Color(b)},a.Light.prototype=new a.Object3D,a.Light.prototype.constructor=a.Light,a.Light.prototype.supr=a.Object3D.prototype,a.AmbientLight=function(b){a.Light.call(this,b)},a.AmbientLight.prototype=new a.Light,a.AmbientLight.prototype.constructor=a.AmbientLight,a.DirectionalLight=function(b,c,d){a.Light.call(this,b),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=c!==void 0?c:1,this.distance=d!==void 0?d:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new a.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},a.DirectionalLight.prototype=new a.Light,a.DirectionalLight.prototype.constructor=a.DirectionalLight,a.PointLight=function(b,c,d){a.Light.call(this,b),this.position=new a.Vector3(0,0,0),this.intensity=c!==void 0?c:1,this.distance=d!==void 0?d:0},a.PointLight.prototype=new a.Light,a.PointLight.prototype.constructor=a.PointLight,a.SpotLight=function(b,c,d,e,f){a.Light.call(this,b),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=c!==void 0?c:1,this.distance=d!==void 0?d:0,this.angle=e!==void 0?e:Math.PI/2,this.exponent=f!==void 0?f:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},a.SpotLight.prototype=new a.Light,a.SpotLight.prototype.constructor=a.SpotLight,a.Loader=function(b){this.statusDomElement=(this.showStatus=b)?a.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},a.Loader.prototype={constructor:a.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");return a.style.position="absolute",a.style.right="0px",a.style.top="0px",a.style.fontSize="0.8em",a.style.textAlign="left",a.style.background="rgba(0,0,0,0.25)",a.style.color="#fff",a.style.width="120px",a.style.padding="0.5em 0.5em 0.5em 0.5em",a.style.zIndex=1e3,a.innerHTML="Loading ...",a},updateProgress:function(a){var b="Loaded ",b=a.total?b+((100*a.loaded/a.total).toFixed(0)+"%"):b+((a.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=b},extractUrlBase:function(a){return a=a.split("/"),a.pop(),(a.length<1?".":a.join("/"))+"/"},initMaterials:function(b,c,d){b.materials=[];for(var e=0;e<c.length;++e)b.materials[e]=a.Loader.prototype.createMaterial(c[e],d)},hasNormals:function(b){var c,d,e=b.materials.length;for(d=0;d<e;d++){c=b.materials[d];if(c instanceof a.ShaderMaterial)return!0}return!1},createMaterial:function(b,c){function d(a){return a=Math.log(a)/Math.LN2,Math.floor(a)==a}function e(a){return a=Math.log(a)/Math.LN2,Math.pow(2,Math.round(a))}function f(a,b){var c=new Image;c.onload=function(){if(!d(this.width)||!d(this.height)){var b=e(this.width),c=e(this.height);a.image.width=b,a.image.height=c,a.image.getContext("2d").drawImage(this,0,0,b,c)}else a.image=this;a.needsUpdate=!0},c.crossOrigin=i.crossOrigin,c.src=b}function g(b,d,e,g,h,i){var j=document.createElement("canvas");b[d]=new a.Texture(j),b[d].sourceFile=e,g&&(b[d].repeat.set(g[0],g[1]),g[0]!=1&&(b[d].wrapS=a.RepeatWrapping),g[1]!=1&&(b[d].wrapT=a.RepeatWrapping)),h&&b[d].offset.set(h[0],h[1]),i&&(g={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping},g[i[0]]!==void 0&&(b[d].wrapS=g[i[0]]),g[i[1]]!==void 0&&(b[d].wrapT=g[i[1]])),f(b[d],c+"/"+e)}function h(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255}var i=this,j="MeshLambertMaterial",k={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:b.wireframe};if(b.shading){var l=b.shading.toLowerCase();l==="phong"?j="MeshPhongMaterial":l==="basic"&&(j="MeshBasicMaterial")}b.blending!==void 0&&a[b.blending]!==void 0&&(k.blending=a[b.blending]);if(b.transparent!==void 0||b.opacity<1)k.transparent=b.transparent;return b.depthTest!==void 0&&(k.depthTest=b.depthTest),b.depthWrite!==void 0&&(k.depthWrite=b.depthWrite),b.vertexColors!==void 0&&(b.vertexColors=="face"?k.vertexColors=a.FaceColors:b.vertexColors&&(k.vertexColors=a.VertexColors)),b.colorDiffuse?k.color=h(b.colorDiffuse):b.DbgColor&&(k.color=b.DbgColor),b.colorSpecular&&(k.specular=h(b.colorSpecular)),b.colorAmbient&&(k.ambient=h(b.colorAmbient)),b.transparency&&(k.opacity=b.transparency),b.specularCoef&&(k.shininess=b.specularCoef),b.mapDiffuse&&c&&g(k,"map",b.mapDiffuse,b.mapDiffuseRepeat,b.mapDiffuseOffset,b.mapDiffuseWrap),b.mapLight&&c&&g(k,"lightMap",b.mapLight,b.mapLightRepeat,b.mapLightOffset,b.mapLightWrap),b.mapNormal&&c&&g(k,"normalMap",b.mapNormal,b.mapNormalRepeat,b.mapNormalOffset,b.mapNormalWrap),b.mapSpecular&&c&&g(k,"specularMap",b.mapSpecular,b.mapSpecularRepeat,b.mapSpecularOffset,b.mapSpecularWrap),b.mapNormal?(j=a.ShaderUtils.lib.normal,l=a.UniformsUtils.clone(j.uniforms),l.tNormal.texture=k.normalMap,b.mapNormalFactor&&(l.uNormalScale.value=b.mapNormalFactor),k.map&&(l.tDiffuse.texture=k.map,l.enableDiffuse.value=!0),k.specularMap&&(l.tSpecular.texture=k.specularMap,l.enableSpecular.value=!0),k.lightMap&&(l.tAO.texture=k.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(k.color),l.uSpecularColor.value.setHex(k.specular),l.uAmbientColor.value.setHex(k.ambient),l.uShininess.value=k.shininess,k.opacity!==void 0&&(l.uOpacity.value=k.opacity),k=new a.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:l,lights:!0,fog:!0})):k=new a[j](k),b.DbgName!==void 0&&(k.name=b.DbgName),k}},a.BinaryLoader=function(b){a.Loader.call(this,b)},a.BinaryLoader.prototype=new a.Loader,a.BinaryLoader.prototype.constructor=a.BinaryLoader,a.BinaryLoader.prototype.load=function(b,c,d,e){var d=d?d:this.extractUrlBase(b),e=e?e:this.extractUrlBase(b),f=this.showProgress?a.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,b,c,d,e,f)},a.BinaryLoader.prototype.loadAjaxJSON=function(a,b,c,d,e,f){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState==4)if(g.status==200||g.status==0){var h=JSON.parse(g.responseText);a.loadAjaxBuffers(h,c,e,d,f)}else console.error("THREE.BinaryLoader: Couldn't load ["+b+"] ["+g.status+"]")},g.open("GET",b,!0),g.overrideMimeType&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.setRequestHeader("Content-Type","text/plain"),g.send(null)},a.BinaryLoader.prototype.loadAjaxBuffers=function(b,c,d,e,f){var g=new XMLHttpRequest,h=d+"/"+b.buffers,i=0;g.onreadystatechange=function(){g.readyState==4?g.status==200||g.status==0?a.BinaryLoader.prototype.createBinModel(g.response,c,e,b.materials):console.error("THREE.BinaryLoader: Couldn't load ["+h+"] ["+g.status+"]"):g.readyState==3?f&&(i==0&&(i=g.getResponseHeader("Content-Length")),f({total:i,loaded:g.responseText.length})):g.readyState==2&&(i=g.getResponseHeader("Content-Length"))},g.open("GET",h,!0),g.responseType="arraybuffer",g.send(null)},a.BinaryLoader.prototype.createBinModel=function(b,c,d,e){var f=function(c){function t(a){return a%4?4-a%4:0}function u(a,b){return(new Uint8Array(a,b,1))[0]}function v(a,b){return(new Uint32Array(a,b,1))[0]}function w(c,d){var e,f,g,h,i,j,k,l,m=new Uint32Array(b,d,3*c);for(e=0;e<c;e++){f=m[e*3],g=m[e*3+1],h=m[e*3+2],i=F[f*2],f=F[f*2+1],j=F[g*2],k=F[g*2+1],g=F[h*2],l=F[h*2+1],h=C.faceVertexUvs[0];var n=[];n.push(new a.UV(i,f)),n.push(new a.UV(j,k)),n.push(new a.UV(g,l)),h.push(n)}}function x(c,d){var e,f,g,h,i,j,k,l,m,n,o=new Uint32Array(b,d,4*c);for(e=0;e<c;e++){f=o[e*4],g=o[e*4+1],h=o[e*4+2],i=o[e*4+3],j=F[f*2],f=F[f*2+1],k=F[g*2],m=F[g*2+1],l=F[h*2],n=F[h*2+1],h=F[i*2],g=F[i*2+1],i=C.faceVertexUvs[0];var p=[];p.push(new a.UV(j,f)),p.push(new a.UV(k,m)),p.push(new a.UV(l,n)),p.push(new a.UV(h,g)),i.push(p)}}function y(c,d,e){for(var f,g,h,i,d=new Uint32Array(b,d,3*c),j=new Uint16Array(b,e,c),e=0;e<c;e++)f=d[e*3],g=d[e*3+1],h=d[e*3+2],i=j[e],C.faces.push(new a.Face3(f,g,h,null,null,i))}function z(c,d,e){for(var f,g,h,i,j,d=new Uint32Array(b,d,4*c),k=new Uint16Array(b,e,c),e=0;e<c;e++)f=d[e*4],g=d[e*4+1],h=d[e*4+2],i=d[e*4+3],j=k[e],C.faces.push(new a.Face4(f,g,h,i,null,null,j))}function A(c,d,e,f){for(var g,h,i,j,k,l,m,d=new Uint32Array(b,d,3*c),e=new Uint32Array(b,e,3*c),n=new Uint16Array(b,f,c),f=0;f<c;f++){g=d[f*3],h=d[f*3+1],i=d[f*3+2],k=e[f*3],l=e[f*3+1],m=e[f*3+2],j=n[f];var o=E[l*3],p=E[l*3+1];l=E[l*3+2];var q=E[m*3],r=E[m*3+1];m=E[m*3+2],C.faces.push(new a.Face3(g,h,i,[new a.Vector3(E[k*3],E[k*3+1],E[k*3+2]),new a.Vector3(o,p,l),new a.Vector3(q,r,m)],null,j))}}function B(c,d,e,f){for(var g,h,i,j,k,l,m,n,o,d=new Uint32Array(b,d,4*c),e=new Uint32Array(b,e,4*c),p=new Uint16Array(b,f,c),f=0;f<c;f++){g=d[f*4],h=d[f*4+1],i=d[f*4+2],j=d[f*4+3],l=e[f*4],m=e[f*4+1],n=e[f*4+2],o=e[f*4+3],k=p[f];var q=E[m*3],r=E[m*3+1];m=E[m*3+2];var s=E[n*3],t=E[n*3+1];n=E[n*3+2];var u=E[o*3],v=E[o*3+1];o=E[o*3+2],C.faces.push(new a.Face4(g,h,i,j,[new a.Vector3(E[l*3],E[l*3+1],E[l*3+2]),new a.Vector3(q,r,m),new a.Vector3(s,t,n),new a.Vector3(u,v,o)],null,k))}}var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,C=this,D=0,E=[],F=[],G,H,I;a.Geometry.call(this),a.Loader.prototype.initMaterials(C,e,c),function(a,b,c){for(var a=new Uint8Array(a,b,c),d="",e=0;e<c;e++)d+=String.fromCharCode(a[b+e]);return d}(b,D,12),d=u(b,D+12),u(b,D+13),u(b,D+14),u(b,D+15),f=u(b,D+16),g=u(b,D+17),h=u(b,D+18),i=u(b,D+19),j=v(b,D+20),k=v(b,D+20+4),l=v(b,D+20+8),c=v(b,D+20+12),m=v(b,D+20+16),n=v(b,D+20+20),o=v(b,D+20+24),p=v(b,D+20+28),q=v(b,D+20+32),r=v(b,D+20+36),s=v(b,D+20+40),D+=d,d=f*3+i,I=f*4+i,G=c*d,H=m*(d+g*3),f=n*(d+h*3),i=o*(d+g*3+h*3),d=p*I,g=q*(I+g*4),h=r*(I+h*4),D+=function(c){var c=new Float32Array(b,c,j*3),d,e,f,g;for(d=0;d<j;d++)e=c[d*3],f=c[d*3+1],g=c[d*3+2],C.vertices.push(new a.Vector3(e,f,g));return j*3*Float32Array.BYTES_PER_ELEMENT}(D),D+=function(a){if(k){var a=new Int8Array(b,a,k*3),c,d,e,f;for(c=0;c<k;c++)d=a[c*3],e=a[c*3+1],f=a[c*3+2],E.push(d/127,e/127,f/127)}return k*3*Int8Array.BYTES_PER_ELEMENT}(D),D+=t(k*3),D+=function(a){if(l){var a=new Float32Array(b,a,l*2),c,d,e;for(c=0;c<l;c++)d=a[c*2],e=a[c*2+1],F.push(d,e)}return l*2*Float32Array.BYTES_PER_ELEMENT}(D),G=D+G+t(c*2),H=G+H+t(m*2),f=H+f+t(n*2),i=f+i+t(o*2),d=i+d+t(p*2),g=d+g+t(q*2),h=g+h+t(r*2),function(a){if(n){var b=a+n*Uint32Array.BYTES_PER_ELEMENT*3;y(n,a,b+n*Uint32Array.BYTES_PER_ELEMENT*3),w(n,b)}}(H),function(a){if(o){var b=a+o*Uint32Array.BYTES_PER_ELEMENT*3,c=b+o*Uint32Array.BYTES_PER_ELEMENT*3;A(o,a,b,c+o*Uint32Array.BYTES_PER_ELEMENT*3),w(o,c)}}(f),function(a){if(r){var b=a+r*Uint32Array.BYTES_PER_ELEMENT*4;z(r,a,b+r*Uint32Array.BYTES_PER_ELEMENT*4),x(r,b)}}(g),function(a){if(s){var b=a+s*Uint32Array.BYTES_PER_ELEMENT*4,c=b+s*Uint32Array.BYTES_PER_ELEMENT*4;B(s,a,b,c+s*Uint32Array.BYTES_PER_ELEMENT*4),x(s,c)}}(h),c&&y(c,D,D+c*Uint32Array.BYTES_PER_ELEMENT*3),function(a){if(m){var b=a+m*Uint32Array.BYTES_PER_ELEMENT*3;A(m,a,b,b+m*Uint32Array.BYTES_PER_ELEMENT*3)}}(G),p&&z(p,i,i+p*Uint32Array.BYTES_PER_ELEMENT*4),function(a){if(q){var b=a+q*Uint32Array.BYTES_PER_ELEMENT*4;B(q,a,b,b+q*Uint32Array.BYTES_PER_ELEMENT*4)}}(d),this.computeCentroids(),this.computeFaceNormals(),a.Loader.prototype.hasNormals(this)&&this.computeTangents()};f.prototype=new a.Geometry,f.prototype.constructor=f,c(new f(d))},a.JSONLoader=function(b){a.Loader.call(this,b)},a.JSONLoader.prototype=new a.Loader,a.JSONLoader.prototype.constructor=a.JSONLoader,a.JSONLoader.prototype.load=function(a,b,c){c=c?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},a.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);a.createModel(h,c,d)}else console.warn("THREE.JSONLoader: ["+b+"] seems to be unreachable or file there is empty");a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+b+"] ["+f.status+"]");else f.readyState===f.LOADING?e&&(g===0&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&(g=f.getResponseHeader("Content-Length"))},f.open("GET",b,!0),f.overrideMimeType&&f.overrideMimeType("text/plain; charset=x-user-defined"),f.setRequestHeader("Content-Type","text/plain"),f.send(null)},a.JSONLoader.prototype.createModel=function(b,c,d){var e=new a.Geometry,f=b.scale!==void 0?1/b.scale:1;this.initMaterials(e,b.materials,d),function(c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s=b.faces;j=b.vertices;var t=b.normals,u=b.colors,v=0;for(d=0;d<b.uvs.length;d++)b.uvs[d].length&&v++;for(d=0;d<v;d++)e.faceUvs[d]=[],e.faceVertexUvs[d]=[];h=0;for(i=j.length;h<i;)k=new a.Vector3,k.x=j[h++]*c,k.y=j[h++]*c,k.z=j[h++]*c,e.vertices.push(k);h=0;for(i=s.length;h<i;){c=s[h++],j=c&1,g=c&2,d=c&4,f=c&8,l=c&16,k=c&32,n=c&64,c&=128,j?(o=new a.Face4,o.a=s[h++],o.b=s[h++],o.c=s[h++],o.d=s[h++],j=4):(o=new a.Face3,o.a=s[h++],o.b=s[h++],o.c=s[h++],j=3),g&&(g=s[h++],o.materialIndex=g),g=e.faces.length;if(d)for(d=0;d<v;d++)p=b.uvs[d],m=s[h++],r=p[m*2],m=p[m*2+1],e.faceUvs[d][g]=new a.UV(r,m);if(f)for(d=0;d<v;d++){p=b.uvs[d],q=[];for(f=0;f<j;f++)m=s[h++],r=p[m*2],m=p[m*2+1],q[f]=new a.UV(r,m);e.faceVertexUvs[d][g]=q}l&&(l=s[h++]*3,f=new a.Vector3,f.x=t[l++],f.y=t[l++],f.z=t[l],o.normal=f);if(k)for(d=0;d<j;d++)l=s[h++]*3,f=new a.Vector3,f.x=t[l++],f.y=t[l++],f.z=t[l],o.vertexNormals.push(f);n&&(k=s[h++],k=new a.Color(u[k]),o.color=k);if(c)for(d=0;d<j;d++)k=s[h++],k=new a.Color(u[k]),o.vertexColors.push(k);e.faces.push(o)}}(f),function(){var c,d,f,g;if(b.skinWeights){c=0;for(d=b.skinWeights.length;c<d;c+=2)f=b.skinWeights[c],g=b.skinWeights[c+1],e.skinWeights.push(new a.Vector4(f,g,0,0))}if(b.skinIndices){c=0;for(d=b.skinIndices.length;c<d;c+=2)f=b.skinIndices[c],g=b.skinIndices[c+1],e.skinIndices.push(new a.Vector4(f,g,0,0))}e.bones=b.bones,e.animation=b.animation}(),function(c){if(b.morphTargets!==void 0){var d,f,g,h,i,j;d=0;for(f=b.morphTargets.length;d<f;d++){e.morphTargets[d]={},e.morphTargets[d].name=b.morphTargets[d].name,e.morphTargets[d].vertices=[],i=e.morphTargets[d].vertices,j=b.morphTargets[d].vertices,g=0;for(h=j.length;g<h;g+=3){var k=new a.Vector3;k.x=j[g]*c,k.y=j[g+1]*c,k.z=j[g+2]*c,i.push(k)}}}if(b.morphColors!==void 0){d=0;for(f=b.morphColors.length;d<f;d++){e.morphColors[d]={},e.morphColors[d].name=b.morphColors[d].name,e.morphColors[d].colors=[],h=e.morphColors[d].colors,i=b.morphColors[d].colors,c=0;for(g=i.length;c<g;c+=3)j=new a.Color(16755200),j.setRGB(i[c],i[c+1],i[c+2]),h.push(j)}}}(f),e.computeCentroids(),e.computeFaceNormals(),this.hasNormals(e)&&e.computeTangents(),c(e)},a.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},a.SceneLoader.prototype.constructor=a.SceneLoader,a.SceneLoader.prototype.load=function(a,b){var c=this,d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200||d.status==0){var e=JSON.parse(d.responseText);c.createScene(e,b,a)}else console.error("THREE.SceneLoader: Couldn't load ["+a+"] ["+d.status+"]")},d.open("GET",a,!0),d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.setRequestHeader("Content-Type","text/plain"),d.send(null)},a.SceneLoader.prototype.createScene=function(b,c,d){function e(a,b){return b=="relativeToHTML"?a:k+"/"+a}function f(){var b;for(n in G.objects)if(!M.objects[n]){s=G.objects[n];if(s.geometry!==void 0){if(C=M.geometries[s.geometry])b=!1,D=M.materials[s.materials[0]],(b=D instanceof a.ShaderMaterial)&&C.computeTangents(),w=s.position,x=s.rotation,y=s.quaternion,z=s.scale,t=s.matrix,y=0,s.materials.length==0&&(D=new a.MeshFaceMaterial),s.materials.length>1&&(D=new a.MeshFaceMaterial),b=new a.Mesh(C,D),b.name=n,t?(b.matrixAutoUpdate=!1,b.matrix.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])):(b.position.set(w[0],w[1],w[2]),y?(b.quaternion.set(y[0],y[1],y[2],y[3]),b.useQuaternion=!0):b.rotation.set(x[0],x[1],x[2]),b.scale.set(z[0],z[1],z[2])),b.visible=s.visible,b.doubleSided=s.doubleSided,b.castShadow=s.castShadow,b.receiveShadow=s.receiveShadow,M.scene.add(b),M.objects[n]=b}else w=s.position,x=s.rotation,y=s.quaternion,z=s.scale,y=0,b=new a.Object3D,b.name=n,b.position.set(w[0],w[1],w[2]),y?(b.quaternion.set(y[0],y[1],y[2],y[3]),b.useQuaternion=!0):b.rotation.set(x[0],x[1],x[2]),b.scale.set(z[0],z[1],z[2]),b.visible=s.visible!==void 0?s.visible:!1,M.scene.add(b),M.objects[n]=b,M.empties[n]=b}}function g(a){return function(b){M.geometries[a]=b,f(),I-=1,j.onLoadComplete(),i()}}function h(a){return function(b){M.geometries[a]=b}}function i(){j.callbackProgress({totalModels:K,totalTextures:L,loadedModels:K-I,loadedTextures:L-J},M),j.onLoadProgress(),I==0&&J==0&&c(M)}var j=this,k=a.Loader.prototype.extractUrlBase(d),l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;G=b,d=new a.BinaryLoader,H=new a.JSONLoader,J=I=0,M={scene:new a.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(G.transform){b=G.transform.position,u=G.transform.rotation,A=G.transform.scale,b&&M.scene.position.set(b[0],b[1],b[2]),u&&M.scene.rotation.set(u[0],u[1],u[2]),A&&M.scene.scale.set(A[0],A[1],A[2]);if(b||u||A)M.scene.updateMatrix(),M.scene.updateMatrixWorld()}b=function(){J-=1,i(),j.onLoadComplete()};for(p in G.cameras)A=G.cameras[p],A.type=="perspective"?E=new a.PerspectiveCamera(A.fov,A.aspect,A.near,A.far):A.type=="ortho"&&(E=new a.OrthographicCamera(A.left,A.right,A.top,A.bottom,A.near,A.far)),w=A.position,u=A.target,A=A.up,E.position.set(w[0],w[1],w[2]),E.target=new a.Vector3(u[0],u[1],u[2]),A&&E.up.set(A[0],A[1],A[2]),M.cameras[p]=E;for(o in G.lights)u=G.lights[o],p=u.color!==void 0?u.color:16777215,E=u.intensity!==void 0?u.intensity:1,u.type=="directional"?(w=u.direction,v=new a.DirectionalLight(p,E),v.position.set(w[0],w[1],w[2]),v.position.normalize()):u.type=="point"?(w=u.position,v=u.distance,v=new a.PointLight(p,E,v),v.position.set(w[0],w[1],w[2])):u.type=="ambient"&&(v=new a.AmbientLight(p)),M.scene.add(v),M.lights[o]=v;for(q in G.fogs)o=G.fogs[q],o.type=="linear"?F=new a.Fog(0,o.near,o.far):o.type=="exp2"&&(F=new a.FogExp2(0,o.density)),A=o.color,F.color.setRGB(A[0],A[1],A[2]),M.fogs[q]=F;M.cameras&&G.defaults.camera&&(M.currentCamera=M.cameras[G.defaults.camera]),M.fogs&&G.defaults.fog&&(M.scene.fog=M.fogs[G.defaults.fog]),A=G.defaults.bgcolor,M.bgColor=new a.Color,M.bgColor.setRGB(A[0],A[1],A[2]),M.bgColorAlpha=G.defaults.bgalpha;for(l in G.geometries){q=G.geometries[l];if(q.type=="bin_mesh"||q.type=="ascii_mesh")I+=1,j.onLoadStart()}K=I;for(l in G.geometries)q=G.geometries[l],q.type=="cube"?(C=new a.CubeGeometry(q.width,q.height,q.depth,q.segmentsWidth,q.segmentsHeight,q.segmentsDepth,null,q.flipped,q.sides),M.geometries[l]=C):q.type=="plane"?(C=new a.PlaneGeometry(q.width,q.height,q.segmentsWidth,q.segmentsHeight),M.geometries[l]=C):q.type=="sphere"?(C=new a.SphereGeometry(q.radius,q.segmentsWidth,q.segmentsHeight),M.geometries[l]=C):q.type=="cylinder"?(C=new a.CylinderGeometry(q.topRad,q.botRad,q.height,q.radSegs,q.heightSegs),M.geometries[l]=C):q.type=="torus"?(C=new a.TorusGeometry(q.radius,q.tube,q.segmentsR,q.segmentsT),M.geometries[l]=C):q.type=="icosahedron"?(C=new a.IcosahedronGeometry(q.radius,q.subdivisions),M.geometries[l]=C):q.type=="bin_mesh"?d.load(e(q.url,G.urlBaseType),g(l)):q.type=="ascii_mesh"?H.load(e(q.url,G.urlBaseType),g(l)):q.type=="embedded_mesh"&&(q=G.embeds[q.id],q.metadata=G.metadata,q&&H.createModel(q,h(l),""));for(r in G.textures){l=G.textures[r];if(l.url instanceof Array){J+=l.url.length;for(q=0;q<l.url.length;q++)j.onLoadStart()}else J+=1,j.onLoadStart()}L=J;for(r in G.textures){l=G.textures[r],l.mapping!=void 0&&a[l.mapping]!=void 0&&(l.mapping=new a[l.mapping]);if(l.url instanceof Array){q=[];for(F=0;F<l.url.length;F++)q[F]=e(l.url[F],G.urlBaseType);q=a.ImageUtils.loadTextureCube(q,l.mapping,b)}else q=a.ImageUtils.loadTexture(e(l.url,G.urlBaseType),l.mapping,b),a[l.minFilter]!=void 0&&(q.minFilter=a[l.minFilter]),a[l.magFilter]!=void 0&&(q.magFilter=a[l.magFilter]),l.repeat&&(q.repeat.set(l.repeat[0],l.repeat[1]),l.repeat[0]!=1&&(q.wrapS=a.RepeatWrapping),l.repeat[1]!=1&&(q.wrapT=a.RepeatWrapping)),l.offset&&q.offset.set(l.offset[0],l.offset[1]),l.wrap&&(F={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping},F[l.wrap[0]]!==void 0&&(q.wrapS=F[l.wrap[0]]),F[l.wrap[1]]!==void 0&&(q.wrapT=F[l.wrap[1]]));M.textures[r]=q}for(m in G.materials){t=G.materials[m];for(B in t.parameters)B=="envMap"||B=="map"||B=="lightMap"?t.parameters[B]=M.textures[t.parameters[B]]:B=="shading"?t.parameters[B]=t.parameters[B]=="flat"?a.FlatShading:a.SmoothShading:B=="blending"?t.parameters[B]=a[t.parameters[B]]?a[t.parameters[B]]:a.NormalBlending:B=="combine"?t.parameters[B]=t.parameters[B]=="MixOperation"?a.MixOperation:a.MultiplyOperation:B=="vertexColors"&&(t.parameters[B]=="face"?t.parameters[B]=a.FaceColors:t.parameters[B]&&(t.parameters[B]=a.VertexColors));t.parameters.opacity!==void 0&&t.parameters.opacity<1&&(t.parameters.transparent=!0),t.parameters.normalMap?(r=a.ShaderUtils.lib.normal,b=a.UniformsUtils.clone(r.uniforms),l=t.parameters.color,q=t.parameters.specular,F=t.parameters.ambient,d=t.parameters.shininess,b.tNormal.texture=M.textures[t.parameters.normalMap],t.parameters.normalMapFactor&&(b.uNormalScale.value=t.parameters.normalMapFactor),t.parameters.map&&(b.tDiffuse.texture=t.parameters.map,b.enableDiffuse.value=!0),t.parameters.lightMap&&(b.tAO.texture=t.parameters.lightMap,b.enableAO.value=!0),t.parameters.specularMap&&(b.tSpecular.texture=M.textures[t.parameters.specularMap],b.enableSpecular.value=!0),b.uDiffuseColor.value.setHex(l),b.uSpecularColor.value.setHex(q),b.uAmbientColor.value.setHex(F),b.uShininess.value=d,t.parameters.opacity&&(b.uOpacity.value=t.parameters.opacity),D=new a.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:b,lights:!0,fog:!0})):D=new a[t.type](t.parameters),M.materials[m]=D}f(),j.callbackSync(M),i()},a.Material=function(b){b=b||{},this.id=a.MaterialCount++,this.name="",this.opacity=b.opacity!==void 0?b.opacity:1,this.transparent=b.transparent!==void 0?b.transparent:!1,this.blending=b.blending!==void 0?b.blending:a.NormalBlending,this.blendSrc=b.blendSrc!==void 0?b.blendSrc:a.SrcAlphaFactor,this.blendDst=b.blendDst!==void 0?b.blendDst:a.OneMinusSrcAlphaFactor,this.blendEquation=b.blendEquation!==void 0?b.blendEquation:a.AddEquation,this.depthTest=b.depthTest!==void 0?b.depthTest:!0,this.depthWrite=b.depthWrite!==void 0?b.depthWrite:!0,this.polygonOffset=b.polygonOffset!==void 0?b.polygonOffset:!1,this.polygonOffsetFactor=b.polygonOffsetFactor!==void 0?b.polygonOffsetFactor:0,this.polygonOffsetUnits=b.polygonOffsetUnits!==void 0?b.polygonOffsetUnits:0,this.alphaTest=b.alphaTest!==void 0?b.alphaTest:0,this.overdraw=b.overdraw!==void 0?b.overdraw:!1,this.needsUpdate=this.visible=!0},a.MaterialCount=0,a.NoShading=0,a.FlatShading=1,a.SmoothShading=2,a.NoColors=0,a.FaceColors=1,a.VertexColors=2,a.NoBlending=0,a.NormalBlending=1,a.AdditiveBlending=2,a.SubtractiveBlending=3,a.MultiplyBlending=4,a.AdditiveAlphaBlending=5,a.CustomBlending=6,a.AddEquation=100,a.SubtractEquation=101,a.ReverseSubtractEquation=102,a.ZeroFactor=200,a.OneFactor=201,a.SrcColorFactor=202,a.OneMinusSrcColorFactor=203,a.SrcAlphaFactor=204,a.OneMinusSrcAlphaFactor=205,a.DstAlphaFactor=206,a.OneMinusDstAlphaFactor=207,a.DstColorFactor=208,a.OneMinusDstColorFactor=209,a.SrcAlphaSaturateFactor=210,a.LineBasicMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.linewidth=b.linewidth!==void 0?b.linewidth:1,this.linecap=b.linecap!==void 0?b.linecap:"round",this.linejoin=b.linejoin!==void 0?b.linejoin:"round",this.vertexColors=b.vertexColors?b.vertexColors:!1,this.fog=b.fog!==void 0?b.fog:!0},a.LineBasicMaterial.prototype=new a.Material,a.LineBasicMaterial.prototype.constructor=a.LineBasicMaterial,a.MeshBasicMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.map=b.map!==void 0?b.map:null,this.lightMap=b.lightMap!==void 0?b.lightMap:null,this.envMap=b.envMap!==void 0?b.envMap:null,this.combine=b.combine!==void 0?b.combine:a.MultiplyOperation,this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1,this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:.98,this.fog=b.fog!==void 0?b.fog:!0,this.shading=b.shading!==void 0?b.shading:a.SmoothShading,this.wireframe=b.wireframe!==void 0?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1,this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round",this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round",this.vertexColors=b.vertexColors!==void 0?b.vertexColors:a.NoColors,this.skinning=b.skinning!==void 0?b.skinning:!1,this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1},a.MeshBasicMaterial.prototype=new a.Material,a.MeshBasicMaterial.prototype.constructor=a.MeshBasicMaterial,a.MeshLambertMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.ambient=b.ambient!==void 0?new a.Color(b.ambient):new a.Color(16777215),this.emissive=b.emissive!==void 0?new a.Color(b.emissive):new a.Color(0),this.wrapAround=b.wrapAround!==void 0?b.wrapAround:!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=b.map!==void 0?b.map:null,this.lightMap=b.lightMap!==void 0?b.lightMap:null,this.envMap=b.envMap!==void 0?b.envMap:null,this.combine=b.combine!==void 0?b.combine:a.MultiplyOperation,this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1,this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:.98,this.fog=b.fog!==void 0?b.fog:!0,this.shading=b.shading!==void 0?b.shading:a.SmoothShading,this.wireframe=b.wireframe!==void 0?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1,this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round",this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round",this.vertexColors=b.vertexColors!==void 0?b.vertexColors:a.NoColors,this.skinning=b.skinning!==void 0?b.skinning:!1,this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1,this.morphNormals=b.morphNormals!==void 0?b.morphNormals:!1},a.MeshLambertMaterial.prototype=new a.Material,a.MeshLambertMaterial.prototype.constructor=a.MeshLambertMaterial,a.MeshPhongMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.ambient=b.ambient!==void 0?new a.Color(b.ambient):new a.Color(16777215),this.emissive=b.emissive!==void 0?new a.Color(b.emissive):new a.Color(0),this.specular=b.specular!==void 0?new a.Color(b.specular):new a.Color(1118481),this.shininess=b.shininess!==void 0?b.shininess:30,this.metal=b.metal!==void 0?b.metal:!1,this.perPixel=b.perPixel!==void 0?b.perPixel:!1,this.wrapAround=b.wrapAround!==void 0?b.wrapAround:!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=b.map!==void 0?b.map:null,this.lightMap=b.lightMap!==void 0?b.lightMap:null,this.envMap=b.envMap!==void 0?b.envMap:null,this.combine=b.combine!==void 0?b.combine:a.MultiplyOperation,this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1,this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:.98,this.fog=b.fog!==void 0?b.fog:!0,this.shading=b.shading!==void 0?b.shading:a.SmoothShading,this.wireframe=b.wireframe!==void 0?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1,this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round",this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round",this.vertexColors=b.vertexColors!==void 0?b.vertexColors:a.NoColors,this.skinning=b.skinning!==void 0?b.skinning:!1,this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1,this.morphNormals=b.morphNormals!==void 0?b.morphNormals:!1},a.MeshPhongMaterial.prototype=new a.Material,a.MeshPhongMaterial.prototype.constructor=a.MeshPhongMaterial,a.MeshDepthMaterial=function(b){a.Material.call(this,b),b=b||{},this.shading=b.shading!==void 0?b.shading:a.SmoothShading,this.wireframe=b.wireframe!==void 0?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1},a.MeshDepthMaterial.prototype=new a.Material,a.MeshDepthMaterial.prototype.constructor=a.MeshDepthMaterial,a.MeshNormalMaterial=function(b){a.Material.call(this,b),b=b||{},this.shading=b.shading?b.shading:a.FlatShading,this.wireframe=b.wireframe?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1},a.MeshNormalMaterial.prototype=new a.Material,a.MeshNormalMaterial.prototype.constructor=a.MeshNormalMaterial,a.MeshFaceMaterial=function(){},a.ParticleBasicMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.map=b.map!==void 0?b.map:null,this.size=b.size!==void 0?b.size:1,this.sizeAttenuation=b.sizeAttenuation!==void 0?b.sizeAttenuation:!0,this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1,this.fog=b.fog!==void 0?b.fog:!0},a.ParticleBasicMaterial.prototype=new a.Material,a.ParticleBasicMaterial.prototype.constructor=a.ParticleBasicMaterial,a.ParticleCanvasMaterial=function(b){a.Material.call(this,b),b=b||{},this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.program=b.program!==void 0?b.program:function(){}},a.ParticleCanvasMaterial.prototype=new a.Material,a.ParticleCanvasMaterial.prototype.constructor=a.ParticleCanvasMaterial,a.ParticleDOMMaterial=function(b){a.Material.call(this),this.domElement=b},a.ShaderMaterial=function(b){a.Material.call(this,b),b=b||{},this.fragmentShader=b.fragmentShader!==void 0?b.fragmentShader:"void main() {}",this.vertexShader=b.vertexShader!==void 0?b.vertexShader:"void main() {}",this.uniforms=b.uniforms!==void 0?b.uniforms:{},this.attributes=b.attributes,this.shading=b.shading!==void 0?b.shading:a.SmoothShading,this.wireframe=b.wireframe!==void 0?b.wireframe:!1,this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1,this.fog=b.fog!==void 0?b.fog:!1,this.lights=b.lights!==void 0?b.lights:!1,this.vertexColors=b.vertexColors!==void 0?b.vertexColors:a.NoColors,this.skinning=b.skinning!==void 0?b.skinning:!1,this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1,this.morphNormals=b.morphNormals!==void 0?b.morphNormals:!1},a.ShaderMaterial.prototype=new a.Material,a.ShaderMaterial.prototype.constructor=a.ShaderMaterial,a.Texture=function(b,c,d,e,f,g,h,i){this.id=a.TextureCount++,this.image=b,this.mapping=c!==void 0?c:new a.UVMapping,this.wrapS=d!==void 0?d:a.ClampToEdgeWrapping,this.wrapT=e!==void 0?e:a.ClampToEdgeWrapping,this.magFilter=f!==void 0?f:a.LinearFilter,this.minFilter=g!==void 0?g:a.LinearMipMapLinearFilter,this.format=h!==void 0?h:a.RGBAFormat,this.type=i!==void 0?i:a.UnsignedByteType,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.generateMipmaps=!0,this.needsUpdate=this.premultiplyAlpha=!1,this.onUpdate=null},a.Texture.prototype={constructor:a.Texture,clone:function(){var b=new a.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);return b.offset.copy(this.offset),b.repeat.copy(this.repeat),b}},a.TextureCount=0,a.MultiplyOperation=0,a.MixOperation=1,a.UVMapping=function(){},a.CubeReflectionMapping=function(){},a.CubeRefractionMapping=function(){},a.SphericalReflectionMapping=function(){},a.SphericalRefractionMapping=function(){},a.RepeatWrapping=0,a.ClampToEdgeWrapping=1,a.MirroredRepeatWrapping=2,a.NearestFilter=3,a.NearestMipMapNearestFilter=4,a.NearestMipMapLinearFilter=5,a.LinearFilter=6,a.LinearMipMapNearestFilter=7,a.LinearMipMapLinearFilter=8,a.ByteType=9,a.UnsignedByteType=10,a.ShortType=11,a.UnsignedShortType=12,a.IntType=13,a.UnsignedIntType=14,a.FloatType=15,a.AlphaFormat=16,a.RGBFormat=17,a.RGBAFormat=18,a.LuminanceFormat=19,a.LuminanceAlphaFormat=20,a.DataTexture=function(b,c,d,e,f,g,h,i,j,k){a.Texture.call(this,null,g,h,i,j,k,e,f),this.image={data:b,width:c,height:d}},a.DataTexture.prototype=new a.Texture,a.DataTexture.prototype.constructor=a.DataTexture,a.DataTexture.prototype.clone=function(){var b=new a.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return b.offset.copy(this.offset),b.repeat.copy(this.repeat),b},a.Particle=function(b){a.Object3D.call(this),this.material=b},a.Particle.prototype=new a.Object3D,a.Particle.prototype.constructor=a.Particle,a.ParticleSystem=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c!==void 0?c:new a.ParticleBasicMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius),this.frustumCulled=!1},a.ParticleSystem.prototype=new a.Object3D,a.ParticleSystem.prototype.constructor=a.ParticleSystem,a.Line=function(b,c,d){a.Object3D.call(this),this.geometry=b,this.material=c!==void 0?c:new a.LineBasicMaterial({color:Math.random()*16777215}),this.type=d!==void 0?d:a.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},a.LineStrip=0,a.LinePieces=1,a.Line.prototype=new a.Object3D,a.Line.prototype.constructor=a.Line,a.Mesh=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c!==void 0?c:new a.MeshBasicMaterial({color:Math.random()*16777215,wireframe:!0});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var d=0;d<this.geometry.morphTargets.length;d++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[d].name]=d}}},a.Mesh.prototype=new a.Object3D,a.Mesh.prototype.constructor=a.Mesh,a.Mesh.prototype.supr=a.Object3D.prototype,a.Mesh.prototype.getMorphTargetIndexByName=function(a){return this.morphTargetDictionary[a]!==void 0?this.morphTargetDictionary[a]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},a.Bone=function(b){a.Object3D.call(this),this.skin=b,this.skinMatrix=new a.Matrix4},a.Bone.prototype=new a.Object3D,a.Bone.prototype.constructor=a.Bone,a.Bone.prototype.supr=a.Object3D.prototype,a.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&(b|=this.updateMatrix());if(b||this.matrixWorldNeedsUpdate)a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0;var c,d=this.children.length;for(c=0;c<d;c++)this.children[c].update(this.skinMatrix,b)},a.SkinnedMesh=function(b,c){a.Mesh.call(this,b,c),this.identityMatrix=new a.Matrix4,this.bones=[],this.boneMatrices=[];var d,e,f,g,h,i;if(this.geometry.bones!==void 0){for(d=0;d<this.geometry.bones.length;d++)f=this.geometry.bones[d],g=f.pos,h=f.rotq,i=f.scl,e=this.addBone(),e.name=f.name,e.position.set(g[0],g[1],g[2]),e.quaternion.set(h[0],h[1],h[2],h[3]),e.useQuaternion=!0,i!==void 0?e.scale.set(i[0],i[1],i[2]):e.scale.set(1,1,1);for(d=0;d<this.bones.length;d++)f=this.geometry.bones[d],e=this.bones[d],f.parent===-1?this.add(e):this.bones[f.parent].add(e);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},a.SkinnedMesh.prototype=new a.Mesh,a.SkinnedMesh.prototype.constructor=a.SkinnedMesh,a.SkinnedMesh.prototype.addBone=function(b){return b===void 0&&(b=new a.Bone(this)),this.bones.push(b),b},a.SkinnedMesh.prototype.updateMatrixWorld=function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var b=0,c=this.children.length;b<c;b++){var d=this.children[b];d instanceof a.Bone?d.update(this.identityMatrix,!1):d.updateMatrixWorld(!0)}for(var c=this.bones.length,d=this.bones,e=this.boneMatrices,b=0;b<c;b++)d[b].skinMatrix.flattenToArrayOffset(e,b*16)},a.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var b,c=[],d=0;d<this.bones.length;d++){b=this.bones[d];var e=new a.Matrix4;e.getInverse(b.skinMatrix),c.push(e),b.skinMatrix.flattenToArrayOffset(this.boneMatrices,d*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[];for(b=0;b<this.geometry.skinIndices.length;b++){var d=this.geometry.vertices[b],f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y,e=new a.Vector3(d.x,d.y,d.z);this.geometry.skinVerticesA.push(c[f].multiplyVector3(e)),e=new a.Vector3(d.x,d.y,d.z),this.geometry.skinVerticesB.push(c[g].multiplyVector3(e)),this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1&&(d=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*.5,this.geometry.skinWeights[b].x=this.geometry.skinWeights[b].x+d,this.geometry.skinWeights[b].y=this.geometry.skinWeights[b].y+d)}}},a.MorphAnimMesh=function(b,c){a.Mesh.call(this,b,c),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},a.MorphAnimMesh.prototype=new a.Mesh,a.MorphAnimMesh.prototype.constructor=a.MorphAnimMesh,a.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a,this.endKeyframe=b,this.length=this.endKeyframe-this.startKeyframe+1},a.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},a.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},a.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)(\d+)/,e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e].name.match(d);if(g&&g.length>1){g=g[1],c[g]||(c[g]={start:Infinity,end:-Infinity});var h=c[g];e<h.start&&(h.start=e),e>h.end&&(h.end=e),b||(b=g)}}a.firstAnimation=b},a.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[a]={start:b,end:c}},a.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=1e3*((c.end-c.start)/b),this.time=0):console.warn("animation["+a+"] undefined")},a.MorphAnimMesh.prototype.updateAnimation=function(b){var c=this.duration/this.length;this.time=this.time+this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction=this.direction*-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time=this.time%this.duration,this.time<0&&(this.time=this.time+this.duration);b=this.startKeyframe+a.Math.clamp(Math.floor(this.time/c),0,this.length-1),b!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b),c=this.time%c/c,this.directionBackwards&&(c=1-c),this.morphTargetInfluences[this.currentKeyframe]=c,this.morphTargetInfluences[this.lastKeyframe]=1-c},a.Ribbon=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c},a.Ribbon.prototype=new a.Object3D,a.Ribbon.prototype.constructor=a.Ribbon,a.LOD=function(){a.Object3D.call(this),this.LODs=[]},a.LOD.prototype=new a.Object3D,a.LOD.prototype.constructor=a.LOD,a.LOD.prototype.supr=a.Object3D.prototype,a.LOD.prototype.addLevel=function(a,b){b===void 0&&(b=0);for(var b=Math.abs(b),c=0;c<this.LODs.length;c++)if(b<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:b,object3D:a}),this.add(a)},a.LOD.prototype.update=function(a){if(this.LODs.length>1){a.matrixWorldInverse.getInverse(a.matrixWorld),a=a.matrixWorldInverse,a=-(a.elements[2]*this.matrixWorld.elements[12]+a.elements[6]*this.matrixWorld.elements[13]+a.elements[10]*this.matrixWorld.elements[14]+a.elements[14]),this.LODs[0].object3D.visible=!0;for(var b=1;b<this.LODs.length;b++){if(!(a>=this.LODs[b].visibleAtDistance))break;this.LODs[b-1].object3D.visible=!1,this.LODs[b].object3D.visible=!0}for(;b<this.LODs.length;b++)this.LODs[b].object3D.visible=!1}},a.Sprite=function(b){a.Object3D.call(this),this.color=b.color!==void 0?new a.Color(b.color):new a.Color(16777215),this.map=b.map!==void 0?b.map:new a.Texture,this.blending=b.blending!==void 0?b.blending:a.NormalBlending,this.blendSrc=b.blendSrc!==void 0?b.blendSrc:a.SrcAlphaFactor,this.blendDst=b.blendDst!==void 0?b.blendDst:a.OneMinusSrcAlphaFactor,this.blendEquation=b.blendEquation!==void 0?b.blendEquation:a.AddEquation,this.useScreenCoordinates=b.useScreenCoordinates!==void 0?b.useScreenCoordinates:!0,this.mergeWith3D=b.mergeWith3D!==void 0?b.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=b.affectedByDistance!==void 0?b.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=b.scaleByViewport!==void 0?b.scaleByViewport:!this.affectedByDistance,this.alignment=b.alignment instanceof a.Vector2?b.alignment:a.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new a.Vector2(0,0),this.uvScale=new a.Vector2(1,1)},a.Sprite.prototype=new a.Object3D,a.Sprite.prototype.constructor=a.Sprite,a.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0},a.SpriteAlignment={},a.SpriteAlignment.topLeft=new a.Vector2(1,-1),a.SpriteAlignment.topCenter=new a.Vector2(0,-1),a.SpriteAlignment.topRight=new a.Vector2(-1,-1),a.SpriteAlignment.centerLeft=new a.Vector2(1,0),a.SpriteAlignment.center=new a.Vector2(0,0),a.SpriteAlignment.centerRight=new a.Vector2(-1,0),a.SpriteAlignment.bottomLeft=new a.Vector2(1,1),a.SpriteAlignment.bottomCenter=new a.Vector2(0,1),a.SpriteAlignment.bottomRight=new a.Vector2(-1,1),a.Scene=function(){a.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},a.Scene.prototype=new a.Object3D,a.Scene.prototype.constructor=a.Scene,a.Scene.prototype.__addObject=function(b){if(b instanceof a.Light)this.__lights.indexOf(b)===-1&&this.__lights.push(b);else if(!(b instanceof a.Camera||b instanceof a.Bone)&&this.__objects.indexOf(b)===-1){this.__objects.push(b),this.__objectsAdded.push(b);var c=this.__objectsRemoved.indexOf(b);c!==-1&&this.__objectsRemoved.splice(c,1)}for(c=0;c<b.children.length;c++)this.__addObject(b.children[c])},a.Scene.prototype.__removeObject=function(b){if(b instanceof a.Light){var c=this.__lights.indexOf(b);c!==-1&&this.__lights.splice(c,1)}else b instanceof a.Camera||(c=this.__objects.indexOf(b),c!==-1&&(this.__objects.splice(c,1),this.__objectsRemoved.push(b),c=this.__objectsAdded.indexOf(b),c!==-1&&this.__objectsAdded.splice(c,1)));for(c=0;c<b.children.length;c++)this.__removeObject(b.children[c])},a.Fog=function(b,c,d){this.color=new a.Color(b),this.near=c!==void 0?c:1,this.far=d!==void 0?d:1e3},a.FogExp2=function(b,c){this.color=new a.Color(b),this.density=c!==void 0?c:25e-5},a.DOMRenderer=function(){console.log("THREE.DOMRenderer",a.REVISION);var b,c,d,e,f,g,h,i=new a.Projector;h=function(a){for(var b=document.documentElement,c=0;c<a.length;c++)if(typeof b.style[a[c]]=="string")return a[c];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]),this.domElement=document.createElement("div"),this.setSize=function(a,b){d=a,e=b,f=d/2,g=e/2},this.render=function(d,e){var j,k,l,m,n,o;b=i.projectScene(d,e),c=b.elements,j=0;for(k=c.length;j<k;j++)l=c[j],l instanceof a.RenderableParticle&&l.material instanceof a.ParticleDOMMaterial&&(m=l.material.domElement,n=l.x*f+f-(m.offsetWidth>>1),o=l.y*g+g-(m.offsetHeight>>1),m.style.left=n+"px",m.style.top=o+"px",m.style.zIndex=Math.abs(Math.floor((1-l.z)*e.far/e.near)),h&&(m.style[h]="scale("+l.scale.x*f+","+l.scale.y*g+")"))}},a.CanvasRenderer=function(b){function c(a){t!=a&&(q.globalAlpha=t=a)}function d(b){if(u!=b){switch(b){case a.NormalBlending:q.globalCompositeOperation="source-over";break;case a.AdditiveBlending:q.globalCompositeOperation="lighter"}u=b}}function e(a){v!=a&&(q.strokeStyle=v=a)}function f(a){w!=a&&(q.fillStyle=w=a)}console.log("THREE.CanvasRenderer",a.REVISION);var b=b||{},g=this,h,i,j,k=new a.Projector,l=b.canvas!==void 0?b.canvas:document.createElement("canvas"),m,n,o,p,q=l.getContext("2d"),r=new a.Color(0),s=0,t=1,u=0,v=null,w=null,x=null,y=null,z=null,A,B,C,D,E=new a.RenderableVertex,F=new a.RenderableVertex,G,H,I,J,K,L,M,N,O,P,Q,R,S=new a.Color,T=new a.Color,U=new a.Color,V=new a.Color,W=new a.Color,X=[],Y=[],Z,$,_,ab,bb,cb,db,eb,fb,gb,hb=new a.Rectangle,ib=new a.Rectangle,jb=new a.Rectangle,kb=!1,lb=new a.Color,mb=new a.Color,nb=new a.Color,ob=new a.Vector3,pb,qb,rb,sb,tb,ub,b=16;pb=document.createElement("canvas"),pb.width=pb.height=2,qb=pb.getContext("2d"),qb.fillStyle="rgba(0,0,0,1)",qb.fillRect(0,0,2,2),rb=qb.getImageData(0,0,2,2),sb=rb.data,tb=document.createElement("canvas"),tb.width=tb.height=b,ub=tb.getContext("2d"),ub.translate(-b/2,-b/2),ub.scale(b,b),b--,this.domElement=l,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(a,b){m=a,n=b,o=Math.floor(m/2),p=Math.floor(n/2),l.width=m,l.height=n,hb.set(-o,-p,o,p),ib.set(-o,-p,o,p),t=1,u=0,z=y=x=w=v=null},this.setClearColor=function(a,b){r.copy(a),s=b!==void 0?b:1,ib.set(-o,-p,o,p)},this.setClearColorHex=function(a,b){r.setHex(a),s=b!==void 0?b:1,ib.set(-o,-p,o,p)},this.clear=function(){q.setTransform(1,0,0,-1,o,p),ib.isEmpty()||(ib.minSelf(hb),ib.inflate(2),s<1&&q.clearRect(Math.floor(ib.getX()),Math.floor(ib.getY()),Math.floor(ib.getWidth()),Math.floor(ib.getHeight())),s>0&&(d(a.NormalBlending),c(1),f("rgba("+Math.floor(r.r*255)+","+Math.floor(r.g*255)+","+Math.floor(r.b*255)+","+s+")"),q.fillRect(Math.floor(ib.getX()),Math.floor(ib.getY()),Math.floor(ib.getWidth()),Math.floor(ib.getHeight()))),ib.empty())},this.render=function(b,l){function m(b){var c,d,e,f;lb.setRGB(0,0,0),mb.setRGB(0,0,0),nb.setRGB(0,0,0),c=0;for(d=b.length;c<d;c++)e=b[c],f=e.color,e instanceof a.AmbientLight?(lb.r=lb.r+f.r,lb.g=lb.g+f.g,lb.b=lb.b+f.b):e instanceof a.DirectionalLight?(mb.r=mb.r+f.r,mb.g=mb.g+f.g,mb.b=mb.b+f.b):e instanceof a.PointLight&&(nb.r=nb.r+f.r,nb.g=nb.g+f.g,nb.b=nb.b+f.b)}function n(b,c,d,e){var f,g,h,i,j,k;f=0;for(g=b.length;f<g;f++)h=b[f],i=h.color,h instanceof a.DirectionalLight?(j=h.matrixWorld.getPosition(),k=d.dot(j),k<=0||(k*=h.intensity,e.r=e.r+i.r*k,e.g=e.g+i.g*k,e.b=e.b+i.b*k)):h instanceof a.PointLight&&(j=h.matrixWorld.getPosition(),k=d.dot(ob.sub(j,c).normalize()),k<=0||(k*=h.distance==0?1:1-Math.min(c.distanceTo(j)/h.distance,1),k!=0&&(k*=h.intensity,e.r=e.r+i.r*k,e.g=e.g+i.g*k,e.b=e.b+i.b*k)))}function r(b,g,h){c(h.opacity),d(h.blending);var i,j,k,l,m,n;h instanceof a.ParticleBasicMaterial?h.map&&(l=h.map.image,m=l.width>>1,n=l.height>>1,h=g.scale.x*o,k=g.scale.y*p,i=h*m,j=k*n,jb.set(b.x-i,b.y-j,b.x+i,b.y+j),hb.intersects(jb)&&(q.save(),q.translate(b.x,b.y),q.rotate(-g.rotation),q.scale(h,-k),q.translate(-m,-n),q.drawImage(l,0,0),q.restore())):h instanceof a.ParticleCanvasMaterial&&(i=g.scale.x*o,j=g.scale.y*p,jb.set(b.x-i,b.y-j,b.x+i,b.y+j),hb.intersects(jb)&&(e(h.color.getContextStyle()),f(h.color.getContextStyle()),q.save(),q.translate(b.x,b.y),q.rotate(-g.rotation),q.scale(i,j),h.program(q),q.restore()))}function s(b,f,g,h){c(h.opacity),d(h.blending),q.beginPath(),q.moveTo(b.positionScreen.x,b.positionScreen.y),q.lineTo(f.positionScreen.x,f.positionScreen.y),q.closePath(),h instanceof a.LineBasicMaterial&&(b=h.linewidth,x!=b&&(q.lineWidth=x=b),b=h.linecap,y!=b&&(q.lineCap=y=b),b=h.linejoin,z!=b&&(q.lineJoin=z=b),e(h.color.getContextStyle()),q.stroke(),jb.inflate(h.linewidth*2))}function t(b,e,f,h,i,k,m,o){g.info.render.vertices=g.info.render.vertices+3,g.info.render.faces++,c(o.opacity),d(o.blending),G=b.positionScreen.x,H=b.positionScreen.y,I=e.positionScreen.x,J=e.positionScreen.y,K=f.positionScreen.x,L=f.positionScreen.y,v(G,H,I,J,K,L),o instanceof a.MeshBasicMaterial?o.map?o.map.mapping instanceof a.UVMapping&&(ab=m.uvs[0],xb(G,H,I,J,K,L,ab[h].u,ab[h].v,ab[i].u,ab[i].v,ab[k].u,ab[k].v,o.map)):o.envMap?o.envMap.mapping instanceof a.SphericalReflectionMapping&&(b=l.matrixWorldInverse,ob.copy(m.vertexNormalsWorld[h]),bb=(ob.x*b.elements[0]+ob.y*b.elements[4]+ob.z*b.elements[8])*.5+.5,cb=-(ob.x*b.elements[1]+ob.y*b.elements[5]+ob.z*b.elements[9])*.5+.5,ob.copy(m.vertexNormalsWorld[i]),db=(ob.x*b.elements[0]+ob.y*b.elements[4]+ob.z*b.elements[8])*.5+.5,eb=-(ob.x*b.elements[1]+ob.y*b.elements[5]+ob.z*b.elements[9])*.5+.5,ob.copy(m.vertexNormalsWorld[k]),fb=(ob.x*b.elements[0]+ob.y*b.elements[4]+ob.z*b.elements[8])*.5+.5,gb=-(ob.x*b.elements[1]+ob.y*b.elements[5]+ob.z*b.elements[9])*.5+.5,xb(G,H,I,J,K,L,bb,cb,db,eb,fb,gb,o.envMap)):o.wireframe?vb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(o.color):o instanceof a.MeshLambertMaterial?kb?!o.wireframe&&o.shading==a.SmoothShading&&m.vertexNormalsWorld.length==3?(T.r=U.r=V.r=lb.r,T.g=U.g=V.g=lb.g,T.b=U.b=V.b=lb.b,n(j,m.v1.positionWorld,m.vertexNormalsWorld[0],T),n(j,m.v2.positionWorld,m.vertexNormalsWorld[1],U),n(j,m.v3.positionWorld,m.vertexNormalsWorld[2],V),T.r=Math.max(0,Math.min(o.color.r*T.r,1)),T.g=Math.max(0,Math.min(o.color.g*T.g,1)),T.b=Math.max(0,Math.min(o.color.b*T.b,1)),U.r=Math.max(0,Math.min(o.color.r*U.r,1)),U.g=Math.max(0,Math.min(o.color.g*U.g,1)),U.b=Math.max(0,Math.min(o.color.b*U.b,1)),V.r=Math.max(0,Math.min(o.color.r*V.r,1)),V.g=Math.max(0,Math.min(o.color.g*V.g,1)),V.b=Math.max(0,Math.min(o.color.b*V.b,1)),W.r=(U.r+V.r)*.5,W.g=(U.g+V.g)*.5,W.b=(U.b+V.b)*.5,_=zb(T,U,V,W),yb(G,H,I,J,K,L,0,0,1,0,0,1,_)):(S.r=lb.r,S.g=lb.g,S.b=lb.b,n(j,m.centroidWorld,m.normalWorld,S),S.r=Math.max(0,Math.min(o.color.r*S.r,1)),S.g=Math.max(0,Math.min(o.color.g*S.g,1)),S.b=Math.max(0,Math.min(o.color.b*S.b,1)),o.wireframe?vb(S,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(S)):o.wireframe?vb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(o.color):o instanceof a.MeshDepthMaterial?(Z=l.near,$=l.far,T.r=T.g=T.b=1-Ab(b.positionScreen.z,Z,$),U.r=U.g=U.b=1-Ab(e.positionScreen.z,Z,$),V.r=V.g=V.b=1-Ab(f.positionScreen.z,Z,$),W.r=(U.r+V.r)*.5,W.g=(U.g+V.g)*.5,W.b=(U.b+V.b)*.5,_=zb(T,U,V,W),yb(G,H,I,J,K,L,0,0,1,0,0,1,_)):o instanceof a.MeshNormalMaterial&&(S.r=Bb(m.normalWorld.x),S.g=Bb(m.normalWorld.y),S.b=Bb(m.normalWorld.z),o.wireframe?vb(S,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(S))}function u(b,e,f,h,i,k,m,o,p){g.info.render.vertices=g.info.render.vertices+4,g.info.render.faces++,c(o.opacity),d(o.blending),o.map||o.envMap?(t(b,e,h,0,1,3,m,o,p),t(i,f,k,1,2,3,m,o,p)):(G=b.positionScreen.x,H=b.positionScreen.y,I=e.positionScreen.x,J=e.positionScreen.y,K=f.positionScreen.x,L=f.positionScreen.y,M=h.positionScreen.x,N=h.positionScreen.y,O=i.positionScreen.x,P=i.positionScreen.y,Q=k.positionScreen.x,R=k.positionScreen.y,o instanceof a.MeshBasicMaterial?(w(G,H,I,J,K,L,M,N),o.wireframe?vb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(o.color)):o instanceof a.MeshLambertMaterial?kb?!o.wireframe&&o.shading==a.SmoothShading&&m.vertexNormalsWorld.length==4?(T.r=U.r=V.r=W.r=lb.r,T.g=U.g=V.g=W.g=lb.g,T.b=U.b=V.b=W.b=lb.b,n(j,m.v1.positionWorld,m.vertexNormalsWorld[0],T),n(j,m.v2.positionWorld,m.vertexNormalsWorld[1],U),n(j,m.v4.positionWorld,m.vertexNormalsWorld[3],V),n(j,m.v3.positionWorld,m.vertexNormalsWorld[2],W),T.r=Math.max(0,Math.min(o.color.r*T.r,1)),T.g=Math.max(0,Math.min(o.color.g*T.g,1)),T.b=Math.max(0,Math.min(o.color.b*T.b,1)),U.r=Math.max(0,Math.min(o.color.r*U.r,1)),U.g=Math.max(0,Math.min(o.color.g*U.g,1)),U.b=Math.max(0,Math.min(o.color.b*U.b,1)),V.r=Math.max(0,Math.min(o.color.r*V.r,1)),V.g=Math.max(0,Math.min(o.color.g*V.g,1)),V.b=Math.max(0,Math.min(o.color.b*V.b,1)),W.r=Math.max(0,Math.min(o.color.r*W.r,1)),W.g=Math.max(0,Math.min(o.color.g*W.g,1)),W.b=Math.max(0,Math.min(o.color.b*W.b,1)),_=zb(T,U,V,W),v(G,H,I,J,M,N),yb(G,H,I,J,M,N,0,0,1,0,0,1,_),v(O,P,K,L,Q,R),yb(O,P,K,L,Q,R,1,0,1,1,0,1,_)):(S.r=lb.r,S.g=lb.g,S.b=lb.b,n(j,m.centroidWorld,m.normalWorld,S),S.r=Math.max(0,Math.min(o.color.r*S.r,1)),S.g=Math.max(0,Math.min(o.color.g*S.g,1)),S.b=Math.max(0,Math.min(o.color.b*S.b,1)),w(G,H,I,J,K,L,M,N),o.wireframe?vb(S,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(S)):(w(G,H,I,J,K,L,M,N),o.wireframe?vb(o.color,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(o.color)):o instanceof a.MeshNormalMaterial?(S.r=Bb(m.normalWorld.x),S.g=Bb(m.normalWorld.y),S.b=Bb(m.normalWorld.z),w(G,H,I,J,K,L,M,N),o.wireframe?vb(S,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):wb(S)):o instanceof a.MeshDepthMaterial&&(Z=l.near,$=l.far,T.r=T.g=T.b=1-Ab(b.positionScreen.z,Z,$),U.r=U.g=U.b=1-Ab(e.positionScreen.z,Z,$),V.r=V.g=V.b=1-Ab(h.positionScreen.z,Z,$),W.r=W.g=W.b=1-Ab(f.positionScreen.z,Z,$),_=zb(T,U,V,W),v(G,H,I,J,M,N),yb(G,H,I,J,M,N,0,0,1,0,0,1,_),v(O,P,K,L,Q,R),yb(O,P,K,L,Q,R,1,0,1,1,0,1,_)))}function v(a,b,c,d,e,f){q.beginPath(),q.moveTo(a,b),q.lineTo(c,d),q.lineTo(e,f),q.lineTo(a,b),q.closePath()}function w(a,b,c,d,e,f,g,h){q.beginPath(),q.moveTo(a,b),q.lineTo(c,d),q.lineTo(e,f),q.lineTo(g,h),q.lineTo(a,b),q.closePath()}function vb(a,b,c,d){x!=b&&(q.lineWidth=x=b),y!=c&&(q.lineCap=y=c),z!=d&&(q.lineJoin=z=d),e(a.getContextStyle()),q.stroke(),jb.inflate(b*2)}function wb(a){f(a.getContextStyle()),q.fill()}function xb(b,c,d,e,g,h,i,j,k,l,m,n,o){if(o.image.width!=0){if(o.needsUpdate==1||X[o.id]==void 0){var p=o.wrapS==a.RepeatWrapping,r=o.wrapT==a.RepeatWrapping;X[o.id]=q.createPattern(o.image,p&&r?"repeat":p&&!r?"repeat-x":!p&&r?"repeat-y":"no-repeat"),o.needsUpdate=!1}f(X[o.id]);var p=o.offset.x/o.repeat.x,r=o.offset.y/o.repeat.y,s=o.image.width*o.repeat.x,t=o.image.height*o.repeat.y,i=(i+p)*s,j=(j+r)*t,d=d-b,e=e-c,g=g-b,h=h-c,k=(k+p)*s-i,l=(l+r)*t-j,m=(m+p)*s-i,n=(n+r)*t-j,p=k*n-m*l;p==0?(Y[o.id]===void 0&&(c=document.createElement("canvas"),c.width=o.image.width,c.height=o.image.height,c=c.getContext("2d"),c.drawImage(o.image,0,0),Y[o.id]=c.getImageData(0,0,o.image.width,o.image.height).data),c=Y[o.id],i=(Math.floor(i)+Math.floor(j)*o.image.width)*4,S.setRGB(c[i]/255,c[i+1]/255,c[i+2]/255),wb(S)):(p=1/p,o=(n*d-l*g)*p,l=(n*e-l*h)*p,d=(k*g-m*d)*p,e=(k*h-m*e)*p,b=b-o*i-d*j,i=c-l*i-e*j,q.save(),q.transform(o,l,d,e,b,i),q.fill(),q.restore())}}function yb(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o;n=m.width-1,o=m.height-1,g*=n,h*=o,c-=a,d-=b,e-=a,f-=b,i=i*n-g,j=j*o-h,k=k*n-g,l=l*o-h,o=1/(i*l-k*j),n=(l*c-j*e)*o,j=(l*d-j*f)*o,c=(i*e-k*c)*o,d=(i*f-k*d)*o,a=a-n*g-c*h,b=b-j*g-d*h,q.save(),q.transform(n,j,c,d,a,b),q.clip(),q.drawImage(m,0,0),q.restore()}function zb(a,b,c,d){var e=~~(a.r*255),f=~~(a.g*255),a=~~(a.b*255),g=~~(b.r*255),h=~~(b.g*255),b=~~(b.b*255),i=~~(c.r*255),j=~~(c.g*255),c=~~(c.b*255),k=~~(d.r*255),l=~~(d.g*255),d=~~(d.b*255);return sb[0]=e<0?0:e>255?255:e,sb[1]=f<0?0:f>255?255:f,sb[2]=a<0?0:a>255?255:a,sb[4]=g<0?0:g>255?255:g,sb[5]=h<0?0:h>255?255:h,sb[6]=b<0?0:b>255?255:b,sb[8]=i<0?0:i>255?255:i,sb[9]=j<0?0:j>255?255:j,sb[10]=c<0?0:c>255?255:c,sb[12]=k<0?0:k>255?255:k,sb[13]=l<0?0:l>255?255:l,sb[14]=d<0?0:d>255?255:d,qb.putImageData(rb,0,0),ub.drawImage(pb,0,0),tb}function Ab(a,b,c){return a=(a-b)/(c-b),a*a*(3-2*a)}function Bb(a){return a=(a+1)*.5,a<0?0:a>1?1:a}function Eb(a,b){var c=b.x-a.x,d=b.y-a.y,e=c*c+d*d;e!=0&&(e=1/Math.sqrt(e),c*=e,d*=e,b.x=b.x+c,b.y=b.y+d,a.x=a.x-c,a.y=a.y-d)}var Fb,Gb,Hb,Ib;this.autoClear?this.clear():q.setTransform(1,0,0,-1,o,p),g.info.render.vertices=0,g.info.render.faces=0,h=k.projectScene(b,l,this.sortElements),i=h.elements,j=h.lights,(kb=j.length>0)&&m(j),Fb=0;for(Gb=i.length;Fb<Gb;Fb++)Hb=i[Fb],Ib=Hb.material,Ib=Ib instanceof a.MeshFaceMaterial?Hb.faceMaterial:Ib,Ib!==void 0&&Ib.visible!==!1&&(jb.empty(),Hb instanceof a.RenderableParticle?(A=Hb,A.x=A.x*o,A.y=A.y*p,r(A,Hb,Ib,b)):Hb instanceof a.RenderableLine?(A=Hb.v1,B=Hb.v2,A.positionScreen.x=A.positionScreen.x*o,A.positionScreen.y=A.positionScreen.y*p,B.positionScreen.x=B.positionScreen.x*o,B.positionScreen.y=B.positionScreen.y*p,jb.addPoint(A.positionScreen.x,A.positionScreen.y),jb.addPoint(B.positionScreen.x,B.positionScreen.y),hb.intersects(jb)&&s(A,B,Hb,Ib,b)):Hb instanceof a.RenderableFace3?(A=Hb.v1,B=Hb.v2,C=Hb.v3,A.positionScreen.x=A.positionScreen.x*o,A.positionScreen.y=A.positionScreen.y*p,B.positionScreen.x=B.positionScreen.x*o,B.positionScreen.y=B.positionScreen.y*p,C.positionScreen.x=C.positionScreen.x*o,C.positionScreen.y=C.positionScreen.y*p,Ib.overdraw&&(Eb(A.positionScreen,B.positionScreen),Eb(B.positionScreen,C.positionScreen),Eb(C.positionScreen,A.positionScreen)),jb.add3Points(A.positionScreen.x,A.positionScreen.y,B.positionScreen.x,B.positionScreen.y,C.positionScreen.x,C.positionScreen.y),hb.intersects(jb)&&t(A,B,C,0,1,2,Hb,Ib,b)):Hb instanceof a.RenderableFace4&&(A=Hb.v1,B=Hb.v2,C=Hb.v3,D=Hb.v4,A.positionScreen.x=A.positionScreen.x*o,A.positionScreen.y=A.positionScreen.y*p,B.positionScreen.x=B.positionScreen.x*o,B.positionScreen.y=B.positionScreen.y*p,C.positionScreen.x=C.positionScreen.x*o,C.positionScreen.y=C.positionScreen.y*p,D.positionScreen.x=D.positionScreen.x*o,D.positionScreen.y=D.positionScreen.y*p,E.positionScreen.copy(B.positionScreen),F.positionScreen.copy(D.positionScreen),Ib.overdraw&&(Eb(A.positionScreen,B.positionScreen),Eb(B.positionScreen,D.positionScreen),Eb(D.positionScreen,A.positionScreen),Eb(C.positionScreen,E.positionScreen),Eb(C.positionScreen,F.positionScreen)),jb.addPoint(A.positionScreen.x,A.positionScreen.y),jb.addPoint(B.positionScreen.x,B.positionScreen.y),jb.addPoint(C.positionScreen.x,C.positionScreen.y),jb.addPoint(D.positionScreen.x,D.positionScreen.y),hb.intersects(jb)&&u(A,B,C,D,E,F,Hb,Ib,b)),ib.addRectangle(jb));q.setTransform(1,0,0,1,0,0)}},a.SVGRenderer=function(){function b(b,c,d,e){var f,g,h,i,j,k;f=0;for(g=b.length;f<g;f++)h=b[f],i=h.color,h instanceof a.DirectionalLight?(j=h.matrixWorld.getPosition(),k=d.dot(j),k<=0||(k*=h.intensity,e.r=e.r+i.r*k,e.g=e.g+i.g*k,e.b=e.b+i.b*k)):h instanceof a.PointLight&&(j=h.matrixWorld.getPosition(),k=d.dot(A.sub(j,c).normalize()),k<=0||(k*=h.distance==0?1:1-Math.min(c.distanceTo(j)/h.distance,1),k!=0&&(k*=h.intensity,e.r=e.r+i.r*k,e.g=e.g+i.g*k,e.b=e.b+i.b*k)))}function c(a){return B[a]==null&&(B[a]=document.createElementNS("http://www.w3.org/2000/svg","path"),G==0&&B[a].setAttribute("shape-rendering","crispEdges")),B[a]}function d(a){return a=(a+1)*.5,a<0?0:a>1?1:a}console.log("THREE.SVGRenderer",a.REVISION);var e=this,f,g,h,i=new a.Projector,j=document.createElementNS("http://www.w3.org/2000/svg","svg"),k,l,m,n,o,p,q,r,s=new a.Rectangle,t=new a.Rectangle,u=!1,v=new a.Color,w=new a.Color,x=new a.Color,y=new a.Color,z,A=new a.Vector3,B=[],C=[],D,E,F,G=1;this.domElement=j,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(a){switch(a){case"high":G=1;break;case"low":G=0}},this.setSize=function(a,b){k=a,l=b,m=k/2,n=l/2,j.setAttribute("viewBox",-m+" "+ -n+" "+k+" "+l),j.setAttribute("width",k),j.setAttribute("height",l),s.set(-m,-n,m,n)},this.clear=function(){for(;j.childNodes.length>0;)j.removeChild(j.childNodes[0])},this.render=function(k,l){var A,B,I,L;this.autoClear&&this.clear(),e.info.render.vertices=0,e.info.render.faces=0,f=i.projectScene(k,l,this.sortElements),g=f.elements,h=f.lights,F=E=0;if(u=h.length>0){w.setRGB(0,0,0),x.setRGB(0,0,0),y.setRGB(0,0,0),A=0;for(B=h.length;A<B;A++)L=h[A],I=L.color,L instanceof a.AmbientLight?(w.r=w.r+I.r,w.g=w.g+I.g,w.b=w.b+I.b):L instanceof a.DirectionalLight?(x.r=x.r+I.r,x.g=x.g+I.g,x.b=x.b+I.b):L instanceof a.PointLight&&(y.r=y.r+I.r,y.g=y.g+I.g,y.b=y.b+I.b)}A=0;for(B=g.length;A<B;A++){I=g[A],L=I.material,L=L instanceof a.MeshFaceMaterial?I.faceMaterial:L;if(L!==void 0&&L.visible!==!1){t.empty();if(I instanceof a.RenderableParticle)o=I,o.x=o.x*m,o.y=o.y*-n;else if(I instanceof a.RenderableLine){o=I.v1,p=I.v2,o.positionScreen.x=o.positionScreen.x*m,o.positionScreen.y=o.positionScreen.y*-n,p.positionScreen.x=p.positionScreen.x*m,p.positionScreen.y=p.positionScreen.y*-n,t.addPoint(o.positionScreen.x,o.positionScreen.y),t.addPoint(p.positionScreen.x,p.positionScreen.y);if(s.intersects(t)){I=o;var M=p,N=F++;C[N]==null&&(C[N]=document.createElementNS("http://www.w3.org/2000/svg","line"),G==0&&C[N].setAttribute("shape-rendering","crispEdges")),D=C[N],D.setAttribute("x1",I.positionScreen.x),D.setAttribute("y1",I.positionScreen.y),D.setAttribute("x2",M.positionScreen.x),D.setAttribute("y2",M.positionScreen.y),L instanceof a.LineBasicMaterial&&(D.setAttribute("style","fill: none; stroke: "+L.color.getContextStyle()+"; stroke-width: "+L.linewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.linecap+"; stroke-linejoin: "+L.linejoin),j.appendChild(D))}}else if(I instanceof a.RenderableFace3){o=I.v1,p=I.v2,q=I.v3,o.positionScreen.x=o.positionScreen.x*m,o.positionScreen.y=o.positionScreen.y*-n,p.positionScreen.x=p.positionScreen.x*m,p.positionScreen.y=p.positionScreen.y*-n,q.positionScreen.x=q.positionScreen.x*m,q.positionScreen.y=q.positionScreen.y*-n,t.addPoint(o.positionScreen.x,o.positionScreen.y),t.addPoint(p.positionScreen.x,p.positionScreen.y),t.addPoint(q.positionScreen.x,q.positionScreen.y);if(s.intersects(t)){var M=o,N=p,O=q;e.info.render.vertices=e.info.render.vertices+3,e.info.render.faces++,D=c(E++),D.setAttribute("d","M "+M.positionScreen.x+" "+M.positionScreen.y+" L "+N.positionScreen.x+" "+N.positionScreen.y+" L "+O.positionScreen.x+","+O.positionScreen.y+"z"),L instanceof a.MeshBasicMaterial?v.copy(L.color):L instanceof a.MeshLambertMaterial?u?(v.r=w.r,v.g=w.g,v.b=w.b,b(h,I.centroidWorld,I.normalWorld,v),v.r=Math.max(0,Math.min(L.color.r*v.r,1)),v.g=Math.max(0,Math.min(L.color.g*v.g,1)),v.b=Math.max(0,Math.min(L.color.b*v.b,1))):v.copy(L.color):L instanceof a.MeshDepthMaterial?(z=1-L.__2near/(L.__farPlusNear-I.z*L.__farMinusNear),v.setRGB(z,z,z)):L instanceof a.MeshNormalMaterial&&v.setRGB(d(I.normalWorld.x),d(I.normalWorld.y),d(I.normalWorld.z)),L.wireframe?D.setAttribute("style","fill: none; stroke: "+v.getContextStyle()+"; stroke-width: "+L.wireframeLinewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.wireframeLinecap+"; stroke-linejoin: "+L.wireframeLinejoin):D.setAttribute("style","fill: "+v.getContextStyle()+"; fill-opacity: "+L.opacity),j.appendChild(D)}}else if(I instanceof a.RenderableFace4){o=I.v1,p=I.v2,q=I.v3,r=I.v4,o.positionScreen.x=o.positionScreen.x*m,o.positionScreen.y=o.positionScreen.y*-n,p.positionScreen.x=p.positionScreen.x*m,p.positionScreen.y=p.positionScreen.y*-n,q.positionScreen.x=q.positionScreen.x*m,q.positionScreen.y=q.positionScreen.y*-n,r.positionScreen.x=r.positionScreen.x*m,r.positionScreen.y=r.positionScreen.y*-n,t.addPoint(o.positionScreen.x,o.positionScreen.y),t.addPoint(p.positionScreen.x,p.positionScreen.y),t.addPoint(q.positionScreen.x,q.positionScreen.y),t.addPoint(r.positionScreen.x,r.positionScreen.y);if(s.intersects(t)){var M=o,N=p,O=q,Q=r;e.info.render.vertices=e.info.render.vertices+4,e.info.render.faces++,D=c(E++),D.setAttribute("d","M "+M.positionScreen.x+" "+M.positionScreen.y+" L "+N.positionScreen.x+" "+N.positionScreen.y+" L "+O.positionScreen.x+","+O.positionScreen.y+" L "+Q.positionScreen.x+","+Q.positionScreen.y+"z"),L instanceof a.MeshBasicMaterial?v.copy(L.color):L instanceof a.MeshLambertMaterial?u?(v.r=w.r,v.g=w.g,v.b=w.b,b(h,I.centroidWorld,I.normalWorld,v),v.r=Math.max(0,Math.min(L.color.r*v.r,1)),v.g=Math.max(0,Math.min(L.color.g*v.g,1)),v.b=Math.max(0,Math.min(L.color.b*v.b,1))):v.copy(L.color):L instanceof a.MeshDepthMaterial?(z=1-L.__2near/(L.__farPlusNear-I.z*L.__farMinusNear),v.setRGB(z,z,z)):L instanceof a.MeshNormalMaterial&&v.setRGB(d(I.normalWorld.x),d(I.normalWorld.y),d(I.normalWorld.z)),L.wireframe?D.setAttribute("style","fill: none; stroke: "+v.getContextStyle()+"; stroke-width: "+L.wireframeLinewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.wireframeLinecap+"; stroke-linejoin: "+L.wireframeLinejoin):D.setAttribute("style","fill: "+v.getContextStyle()+"; fill-opacity: "+L.opacity),j.appendChild(D)}}}}}},a.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},a.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)e[c]=d[c]}return e},clone:function(b){var c,d,e,f={};for(c in b){f[c]={};for(d in b[c])e=b[c][d],f[c][d]=e instanceof a.Color||e instanceof a.Vector2||e instanceof a.Vector3||e instanceof a.Vector4||e instanceof a.Matrix4||e instanceof a.Texture?e.clone():e instanceof Array?e.slice():e}return f}},a.UniformsLib={common:{diffuse:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new a.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},a.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.shadowmap]),vertexShader:[a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_lambert_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",a.ShaderChunk.lights_lambert_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},specular:{type:"c",value:new a.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_phong_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",a.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",a.ShaderChunk.lights_phong_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.lights_phong_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.lights_phong_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.particle,a.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",a.ShaderChunk.color_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_particle_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",a.ShaderChunk.map_particle_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[a.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},a.WebGLRenderer=function(b){function c(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){a.__webglCustomAttributesList===void 0&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;f.type==="v2"?g=2:f.type==="v3"?g=3:f.type==="v4"?g=4:f.type==="c"&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=J.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function d(b,c){if(!(!b.material||b.material instanceof a.MeshFaceMaterial))return b.material;if(c.materialIndex>=0)return b.geometry.materials[c.materialIndex]}function e(b){return b instanceof a.MeshBasicMaterial&&!b.envMap||b instanceof a.MeshDepthMaterial?!1:b&&b.shading!==void 0&&b.shading===a.SmoothShading?a.SmoothShading:a.FlatShading}function f(b){return b.map||b.lightMap||b instanceof a.ShaderMaterial?!0:!1}function g(a,b,c){var d,e,f,g,h=a.vertices;g=h.length;var i=a.colors,j=i.length,k=a.__vertexArray,l=a.__colorArray,m=a.__sortArray,n=a.verticesNeedUpdate,o=a.colorsNeedUpdate,p=a.__webglCustomAttributesList;if(c.sortParticles){jb.copy(ib),jb.multiplySelf(c.matrixWorld);for(d=0;d<g;d++)e=h[d],kb.copy(e),jb.multiplyVector3(kb),m[d]=[kb.z,d];m.sort(function(a,b){return b[0]-a[0]});for(d=0;d<g;d++)e=h[m[d][1]],f=d*3,k[f]=e.x,k[f+1]=e.y,k[f+2]=e.z;for(d=0;d<j;d++)f=d*3,e=i[m[d][1]],l[f]=e.r,l[f+1]=e.g,l[f+2]=e.b;if(p){i=0;for(j=p.length;i<j;i++){h=p[i];if(h.boundTo===void 0||h.boundTo==="vertices"){f=0,e=h.value.length;if(h.size===1)for(d=0;d<e;d++)g=m[d][1],h.array[d]=h.value[g];else if(h.size===2)for(d=0;d<e;d++)g=m[d][1],g=h.value[g],h.array[f]=g.x,h.array[f+1]=g.y,f+=2;else if(h.size===3)if(h.type==="c")for(d=0;d<e;d++)g=m[d][1],g=h.value[g],h.array[f]=g.r,h.array[f+1]=g.g,h.array[f+2]=g.b,f+=3;else for(d=0;d<e;d++)g=m[d][1],g=h.value[g],h.array[f]=g.x,h.array[f+1]=g.y,h.array[f+2]=g.z,f+=3;else if(h.size===4)for(d=0;d<e;d++)g=m[d][1],g=h.value[g],h.array[f]=g.x,h.array[f+1]=g.y,h.array[f+2]=g.z,h.array[f+3]=g.w,f+=4}}}}else{if(n)for(d=0;d<g;d++)e=h[d],f=d*3,k[f]=e.x,k[f+1]=e.y,k[f+2]=e.z;if(o)for(d=0;d<j;d++)e=i[d],f=d*3,l[f]=e.r,l[f+1]=e.g,l[f+2]=e.b;if(p){i=0;for(j=p.length;i<j;i++){h=p[i];if(h.needsUpdate&&(h.boundTo===void 0||h.boundTo==="vertices")){e=h.value.length,f=0;if(h.size===1)for(d=0;d<e;d++)h.array[d]=h.value[d];else if(h.size===2)for(d=0;d<e;d++)g=h.value[d],h.array[f]=g.x,h.array[f+1]=g.y,f+=2;else if(h.size===3)if(h.type==="c")for(d=0;d<e;d++)g=h.value[d],h.array[f]=g.r,h.array[f+1]=g.g,h.array[f+2]=g.b,f+=3;else for(d=0;d<e;d++)g=h.value[d],h.array[f]=g.x,h.array[f+1]=g.y,h.array[f+2]=g.z,f+=3;else if(h.size===4)for(d=0;d<e;d++)g=h.value[d],h.array[f]=g.x,h.array[f+1]=g.y,h.array[f+2]=g.z,h.array[f+3]=g.w,f+=4}}}}if(n||c.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,a.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,k,b);if(o||c.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,a.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,l,b);if(p){i=0;for(j=p.length;i<j;i++){h=p[i];if(h.needsUpdate||c.sortParticles)J.bindBuffer(J.ARRAY_BUFFER,h.buffer),J.bufferData(J.ARRAY_BUFFER,h.array,b)}}}function h(a,b){return b.z-a.z}function i(a,b,c){if(a.length)for(var d=0,e=a.length;d<e;d++)P=L=null,N=O=S=R=Y=X=T=-1,mb=!0,a[d].render(b,c,fb,gb),P=L=null,N=O=S=R=Y=X=T=-1,mb=!0}function j(b,c,d,e,f,g,h,i){var j,k,l,m;c?(k=b.length-1,m=c=-1):(k=0,c=b.length,m=1);for(var n=k;n!==c;n+=m){j=b[n];if(j.render){k=j.object,l=j.buffer;if(i)j=i;else{j=j[d];if(!j)continue;h&&I.setBlending(j.blending,j.blendEquation,j.blendSrc,j.blendDst),I.setDepthTest(j.depthTest),I.setDepthWrite(j.depthWrite),s(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits)}I.setObjectFaces(k),l instanceof a.BufferGeometry?I.renderBufferDirect(e,f,g,j,l,k):I.renderBuffer(e,f,g,j,l,k)}}}function k(a,b,c,d,e,f,g){for(var h,i,j=0,k=a.length;j<k;j++){h=a[j],i=h.object;if(i.visible){if(g)h=g;else{h=h[b];if(!h)continue;f&&I.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),I.setDepthTest(h.depthTest),I.setDepthWrite(h.depthWrite),s(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}I.renderImmediateObject(c,d,e,h,i)}}}function l(a,b,c){a.push({buffer:b,object:c,opaque:null,transparent:null})}function m(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function n(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function o(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function p(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)}function q(b,c,d,e,f){if(!e.program||e.needsUpdate)I.initMaterial(e,c,d,f),e.needsUpdate=!1;if(e.morphTargets&&!f.__webglMorphTargetInfluences){f.__webglMorphTargetInfluences=new Float32Array(I.maxMorphTargets);for(var g=0,h=I.maxMorphTargets;g<h;g++)f.__webglMorphTargetInfluences[g]=0}var i=!1,g=e.program,h=g.uniforms,j=e.uniforms;g!==L&&(J.useProgram(g),L=g,i=!0),e.id!==N&&(N=e.id,i=!0);if(i||b!==P)J.uniformMatrix4fv(h.projectionMatrix,!1,b._projectionMatrixArray),b!==P&&(P=b);if(i){d&&e.fog&&(j.fogColor.value=d.color,d instanceof a.Fog?(j.fogNear.value=d.near,j.fogFar.value=d.far):d instanceof a.FogExp2&&(j.fogDensity.value=d.density));if(e instanceof a.MeshPhongMaterial||e instanceof a.MeshLambertMaterial||e.lights){if(mb){for(var k,l=0,m=0,n=0,o,p,q,r=nb,s=r.directional.colors,t=r.directional.positions,v=r.point.colors,w=r.point.positions,z=r.point.distances,A=r.spot.colors,B=r.spot.positions,C=r.spot.distances,D=r.spot.directions,E=r.spot.angles,F=r.spot.exponents,G=0,H=0,K=0,M=q=0,d=M=0,i=c.length;d<i;d++)k=c[d],k.onlyShadow||(o=k.color,p=k.intensity,q=k.distance,k instanceof a.AmbientLight?I.gammaInput?(l+=o.r*o.r,m+=o.g*o.g,n+=o.b*o.b):(l+=o.r,m+=o.g,n+=o.b):k instanceof a.DirectionalLight?(q=G*3,I.gammaInput?(s[q]=o.r*o.r*p*p,s[q+1]=o.g*o.g*p*p,s[q+2]=o.b*o.b*p*p):(s[q]=o.r*p,s[q+1]=o.g*p,s[q+2]=o.b*p),lb.copy(k.matrixWorld.getPosition()),lb.subSelf(k.target.matrixWorld.getPosition()),lb.normalize(),t[q]=lb.x,t[q+1]=lb.y,t[q+2]=lb.z,G+=1):k instanceof a.PointLight?(M=H*3,I.gammaInput?(v[M]=o.r*o.r*p*p,v[M+1]=o.g*o.g*p*p,v[M+2]=o.b*o.b*p*p):(v[M]=o.r*p,v[M+1]=o.g*p,v[M+2]=o.b*p),o=k.matrixWorld.getPosition(),w[M]=o.x,w[M+1]=o.y,w[M+2]=o.z,z[H]=q,H+=1):k instanceof a.SpotLight&&(M=K*3,I.gammaInput?(A[M]=o.r*o.r*p*p,A[M+1]=o.g*o.g*p*p,A[M+2]=o.b*o.b*p*p):(A[M]=o.r*p,A[M+1]=o.g*p,A[M+2]=o.b*p),o=k.matrixWorld.getPosition(),B[M]=o.x,B[M+1]=o.y,B[M+2]=o.z,C[K]=q,lb.copy(o),lb.subSelf(k.target.matrixWorld.getPosition()),lb.normalize(),D[M]=lb.x,D[M+1]=lb.y,D[M+2]=lb.z,E[K]=Math.cos(k.angle),F[K]=k.exponent,K+=1));d=G*3;for(i=s.length;d<i;d++)s[d]=0;d=H*3;for(i=v.length;d<i;d++)v[d]=0;d=K*3;for(i=A.length;d<i;d++)A[d]=0;r.directional.length=G,r.point.length=H,r.spot.length=K,r.ambient[0]=l,r.ambient[1]=m,r.ambient[2]=n,mb=!1}d=nb,j.ambientLightColor.value=d.ambient,j.directionalLightColor.value=d.directional.colors,j.directionalLightDirection.value=d.directional.positions,j.pointLightColor.value=d.point.colors,j.pointLightPosition.value=d.point.positions,j.pointLightDistance.value=d.point.distances,j.spotLightColor.value=d.spot.colors,j.spotLightPosition.value=d.spot.positions,j.spotLightDistance.value=d.spot.distances,j.spotLightDirection.value=d.spot.directions,j.spotLightAngle.value=d.spot.angles,j.spotLightExponent.value=d.spot.exponents}if(e instanceof a.MeshBasicMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.MeshPhongMaterial)j.opacity.value=e.opacity,I.gammaInput?j.diffuse.value.copyGammaToLinear(e.color):j.diffuse.value=e.color,(j.map.texture=e.map)&&j.offsetRepeat.value.set(e.map.offset.x,e.map.offset.y,e.map.repeat.x,e.map.repeat.y),j.lightMap.texture=e.lightMap,j.envMap.texture=e.envMap,j.flipEnvMap.value=e.envMap instanceof a.WebGLRenderTargetCube?1:-1,j.reflectivity.value=e.reflectivity,j.refractionRatio.value=e.refractionRatio,j.combine.value=e.combine,j.useRefract.value=e.envMap&&e.envMap.mapping instanceof a.CubeRefractionMapping;e instanceof a.LineBasicMaterial?(j.diffuse.value=e.color,j.opacity.value=e.opacity):e instanceof a.ParticleBasicMaterial?(j.psColor.value=e.color,j.opacity.value=e.opacity,j.size.value=e.size,j.scale.value=y.height/2,j.map.texture=e.map):e instanceof a.MeshPhongMaterial?(j.shininess.value=e.shininess,I.gammaInput?(j.ambient.value.copyGammaToLinear(e.ambient),j.emissive.value.copyGammaToLinear(e.emissive),j.specular.value.copyGammaToLinear(e.specular)):(j.ambient.value=e.ambient,j.emissive.value=e.emissive,j.specular.value=e.specular),e.wrapAround&&j.wrapRGB.value.copy(e.wrapRGB)):e instanceof a.MeshLambertMaterial?(I.gammaInput?(j.ambient.value.copyGammaToLinear(e.ambient),j.emissive.value.copyGammaToLinear(e.emissive)):(j.ambient.value=e.ambient,j.emissive.value=e.emissive),e.wrapAround&&j.wrapRGB.value.copy(e.wrapRGB)):e instanceof a.MeshDepthMaterial?(j.mNear.value=b.near,j.mFar.value=b.far,j.opacity.value=e.opacity):e instanceof a.MeshNormalMaterial&&(j.opacity.value=e.opacity);if(f.receiveShadow&&!e._shadowPass&&j.shadowMatrix){i=d=0;for(k=c.length;i<k;i++)l=c[i],l.castShadow&&(l instanceof a.SpotLight||l instanceof a.DirectionalLight&&!l.shadowCascade)&&(j.shadowMap.texture[d]=l.shadowMap,j.shadowMapSize.value[d]=l.shadowMapSize,j.shadowMatrix.value[d]=l.shadowMatrix,j.shadowDarkness.value[d]=l.shadowDarkness,j.shadowBias.value[d]=l.shadowBias,d++)}c=e.uniformsList,j=0;for(d=c.length;j<d;j++)if(l=g.uniforms[c[j][1]]){i=c[j][0],m=i.type,k=i.value;switch(m){case"i":J.uniform1i(l,k);break;case"f":J.uniform1f(l,k);break;case"v2":J.uniform2f(l,k.x,k.y);break;case"v3":J.uniform3f(l,k.x,k.y,k.z);break;case"v4":J.uniform4f(l,k.x,k.y,k.z,k.w);break;case"c":J.uniform3f(l,k.r,k.g,k.b);break;case"fv1":J.uniform1fv(l,k);break;case"fv":J.uniform3fv(l,k);break;case"v2v":i._array||(i._array=new Float32Array(2*k.length)),m=0;for(n=k.length;m<n;m++)r=m*2,i._array[r]=k[m].x,i._array[r+1]=k[m].y;J.uniform2fv(l,i._array);break;case"v3v":i._array||(i._array=new Float32Array(3*k.length)),m=0;for(n=k.length;m<n;m++)r=m*3,i._array[r]=k[m].x,i._array[r+1]=k[m].y,i._array[r+2]=k[m].z;J.uniform3fv(l,i._array);break;case"v4v":i._array||(i._array=new Float32Array(4*k.length)),m=0;for(n=k.length;m<n;m++)r=m*4,i._array[r]=k[m].x,i._array[r+1]=k[m].y,i._array[r+2]=k[m].z,i._array[r+3]=k[m].w;J.uniform4fv(l,i._array);break;case"m4":i._array||(i._array=new Float32Array(16)),k.flattenToArray(i._array),J.uniformMatrix4fv(l,!1,i._array);break;case"m4v":i._array||(i._array=new Float32Array(16*k.length)),m=0;for(n=k.length;m<n;m++)k[m].flattenToArrayOffset(i._array,m*16);J.uniformMatrix4fv(l,!1,i._array);break;case"t":J.uniform1i(l,k),l=i.texture;if(!l)continue;if(l.image instanceof Array&&l.image.length===6){i=l;if(i.image.length===6)if(i.needsUpdate){i.image.__webglTextureCube||(i.image.__webglTextureCube=J.createTexture()),J.activeTexture(J.TEXTURE0+k),J.bindTexture(J.TEXTURE_CUBE_MAP,i.image.__webglTextureCube),k=[];for(l=0;l<6;l++)m=k,n=l,I.autoScaleCubemaps?(r=i.image[l],t=pb,r.width<=t&&r.height<=t||(v=Math.max(r.width,r.height),s=Math.floor(r.width*t/v),t=Math.floor(r.height*t/v),v=document.createElement("canvas"),v.width=s,v.height=t,v.getContext("2d").drawImage(r,0,0,r.width,r.height,0,0,s,t),r=v)):r=i.image[l],m[n]=r;l=k[0],m=(l.width&l.width-1)===0&&(l.height&l.height-1)===0,n=x(i.format),r=x(i.type),u(J.TEXTURE_CUBE_MAP,i,m);for(l=0;l<6;l++)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,n,n,r,k[l]);i.generateMipmaps&&m&&J.generateMipmap(J.TEXTURE_CUBE_MAP),i.needsUpdate=!1,i.onUpdate&&i.onUpdate()}else J.activeTexture(J.TEXTURE0+k),J.bindTexture(J.TEXTURE_CUBE_MAP,i.image.__webglTextureCube)}else l instanceof a.WebGLRenderTargetCube?(i=l,J.activeTexture(J.TEXTURE0+k),J.bindTexture(J.TEXTURE_CUBE_MAP,i.__webglTexture)):I.setTexture(l,k);break;case"tv":if(!i._array){i._array=[],m=0;for(n=i.texture.length;m<n;m++)i._array[m]=k+m}J.uniform1iv(l,i._array),m=0;for(n=i.texture.length;m<n;m++)(l=i.texture[m])&&I.setTexture(l,i._array[m])}}(e instanceof a.ShaderMaterial||e instanceof a.MeshPhongMaterial||e.envMap)&&h.cameraPosition!==null&&(c=b.matrixWorld.getPosition(),J.uniform3f(h.cameraPosition,c.x,c.y,c.z)),(e instanceof a.MeshPhongMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.ShaderMaterial||e.skinning)&&h.viewMatrix!==null&&J.uniformMatrix4fv(h.viewMatrix,!1,b._viewMatrixArray),e.skinning&&J.uniformMatrix4fv(h.boneGlobalMatrices,!1,f.boneMatrices)}return J.uniformMatrix4fv(h.modelViewMatrix,!1,f._modelViewMatrix.elements),h.normalMatrix&&J.uniformMatrix3fv(h.normalMatrix,!1,f._normalMatrix.elements),h.objectMatrix!==null&&J.uniformMatrix4fv(h.objectMatrix,!1,f.matrixWorld.elements),g}function r(a,b){a._modelViewMatrix.multiply(b.matrixWorldInverse,a.matrixWorld),a._normalMatrix.getInverse(a._modelViewMatrix),a._normalMatrix.transpose()}function s(a,b,c){Z!==a&&(a?J.enable(J.POLYGON_OFFSET_FILL):J.disable(J.POLYGON_OFFSET_FILL),Z=a),a&&($!==b||_!==c)&&(J.polygonOffset(b,c),$=b,_=c)}function t(a,b){var c;return a==="fragment"?c=J.createShader(J.FRAGMENT_SHADER):a==="vertex"&&(c=J.createShader(J.VERTEX_SHADER)),J.shaderSource(c,b),J.compileShader(c),J.getShaderParameter(c,J.COMPILE_STATUS)?c:(console.error(J.getShaderInfoLog(c)),console.error(b),null)}function u(a,b,c){c?(J.texParameteri(a,J.TEXTURE_WRAP_S,x(b.wrapS)),J.texParameteri(a,J.TEXTURE_WRAP_T,x(b.wrapT)),J.texParameteri(a,J.TEXTURE_MAG_FILTER,x(b.magFilter)),J.texParameteri(a,J.TEXTURE_MIN_FILTER,x(b.minFilter))):(J.texParameteri(a,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(a,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(a,J.TEXTURE_MAG_FILTER,w(b.magFilter)),J.texParameteri(a,J.TEXTURE_MIN_FILTER,w(b.minFilter)))}function v(a,b){J.bindRenderbuffer(J.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,b.width,b.height),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_STENCIL,b.width,b.height),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,a)):J.renderbufferStorage(J.RENDERBUFFER,J.RGBA4,b.width,b.height)}function w(b){switch(b){case a.NearestFilter:case a.NearestMipMapNearestFilter:case a.NearestMipMapLinearFilter:return J.NEAREST;default:return J.LINEAR}}function x(b){switch(b){case a.RepeatWrapping:return J.REPEAT;case a.ClampToEdgeWrapping:return J.CLAMP_TO_EDGE;case a.MirroredRepeatWrapping:return J.MIRRORED_REPEAT;case a.NearestFilter:return J.NEAREST;case a.NearestMipMapNearestFilter:return J.NEAREST_MIPMAP_NEAREST;case a.NearestMipMapLinearFilter:return J.NEAREST_MIPMAP_LINEAR;case a.LinearFilter:return J.LINEAR;case a.LinearMipMapNearestFilter:return J.LINEAR_MIPMAP_NEAREST;case a.LinearMipMapLinearFilter:return J.LINEAR_MIPMAP_LINEAR;case a.ByteType:return J.BYTE;case a.UnsignedByteType:return J.UNSIGNED_BYTE;case a.ShortType:return J.SHORT;case a.UnsignedShortType:return J.UNSIGNED_SHORT;case a.IntType:return J.INT;case a.UnsignedIntType:return J.UNSIGNED_INT;case a.FloatType:return J.FLOAT;case a.AlphaFormat:return J.ALPHA;case a.RGBFormat:return J.RGB;case a.RGBAFormat:return J.RGBA;case a.LuminanceFormat:return J.LUMINANCE;case a.LuminanceAlphaFormat:return J.LUMINANCE_ALPHA;case a.AddEquation:return J.FUNC_ADD;case a.SubtractEquation:return J.FUNC_SUBTRACT;case a.ReverseSubtractEquation:return J.FUNC_REVERSE_SUBTRACT;case a.ZeroFactor:return J.ZERO;case a.OneFactor:return J.ONE;case a.SrcColorFactor:return J.SRC_COLOR;case a.OneMinusSrcColorFactor:return J.ONE_MINUS_SRC_COLOR;case a.SrcAlphaFactor:return J.SRC_ALPHA;case a.OneMinusSrcAlphaFactor:return J.ONE_MINUS_SRC_ALPHA;case a.DstAlphaFactor:return J.DST_ALPHA;case a.OneMinusDstAlphaFactor:return J.ONE_MINUS_DST_ALPHA;case a.DstColorFactor:return J.DST_COLOR;case a.OneMinusDstColorFactor:return J.ONE_MINUS_DST_COLOR;case a.SrcAlphaSaturateFactor:return J.SRC_ALPHA_SATURATE}return 0}console.log("THREE.WebGLRenderer",a.REVISION);var b=b||{},y=b.canvas!==void 0?b.canvas:document.createElement("canvas"),z=b.precision!==void 0?b.precision:"highp",A=b.alpha!==void 0?b.alpha:!0,B=b.premultipliedAlpha!==void 0?b.premultipliedAlpha:!0,C=b.antialias!==void 0?b.antialias:!1,D=b.stencil!==void 0?b.stencil:!0,E=b.preserveDrawingBuffer!==void 0?b.preserveDrawingBuffer:!1,F=b.clearColor!==void 0?new a.Color(b.clearColor):new a.Color(0),G=b.clearAlpha!==void 0?b.clearAlpha:0,H=b.maxLights!==void 0?b.maxLights:4;this.domElement=y,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var I=this,J,K=[],L=null,M=null,N=-1,O=null,P=null,Q=0,R=-1,S=-1,T=-1,U=-1,V=-1,W=-1,X=-1,Y=-1,Z=null,$=null,_=null,ab=null,bb=0,cb=0,db=0,eb=0,fb=0,gb=0,hb=new a.Frustum,ib=new a.Matrix4,jb=new a.Matrix4,kb=new a.Vector4,lb=new a.Vector3,mb=!0,nb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};J=function(){var a;try{if(!(a=y.getContext("experimental-webgl",{alpha:A,premultipliedAlpha:B,antialias:C,stencil:D,preserveDrawingBuffer:E})))throw"Error creating WebGL context."}catch(b){console.error(b)}return a.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported."),a}(),J.clearColor(0,0,0,1),J.clearDepth(1),J.clearStencil(0),J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL),J.frontFace(J.CCW),J.cullFace(J.BACK),J.enable(J.CULL_FACE),J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),J.clearColor(F.r,F.g,F.b,G),this.context=J;var ob=J.getParameter(J.MAX_VERTEX_TEXTURE_IMAGE_UNITS);J.getParameter(J.MAX_TEXTURE_SIZE);var pb=J.getParameter(J.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return J},this.supportsVertexTextures=function(){return ob>0},this.setSize=function(a,b){y.width=a,y.height=b,this.setViewport(0,0,y.width,y.height)},this.setViewport=function(a,b,c,d){bb=a,cb=b,db=c,eb=d,J.viewport(bb,cb,db,eb)},this.setScissor=function(a,b,c,d){J.scissor(a,b,c,d)},this.enableScissorTest=function(a){a?J.enable(J.SCISSOR_TEST):J.disable(J.SCISSOR_TEST)},this.setClearColorHex=function(a,b){F.setHex(a),G=b,J.clearColor(F.r,F.g,F.b,G)},this.setClearColor=function(a,b){F.copy(a),G=b,J.clearColor(F.r,F.g,F.b,G)},this.getClearColor=function(){return F},this.getClearAlpha=function(){return G},this.clear=function(a,b,c){var d=0;if(a===void 0||a)d|=J.COLOR_BUFFER_BIT;if(b===void 0||b)d|=J.DEPTH_BUFFER_BIT;if(c===void 0||c)d|=J.STENCIL_BUFFER_BIT;J.clear(d)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.addPostPlugin=function(a){a.init(this),this.renderPluginsPost.push(a)},this.addPrePlugin=function(a){a.init(this),this.renderPluginsPre.push(a)},this.deallocateObject=function(b){if(b.__webglInit){b.__webglInit=!1,delete b._modelViewMatrix,delete b._normalMatrix,delete b._normalMatrixArray,delete b._modelViewMatrixArray,delete b._objectMatrixArray;if(b instanceof a.Mesh)for(var c in b.geometry.geometryGroups){var d=b.geometry.geometryGroups[c];J.deleteBuffer(d.__webglVertexBuffer),J.deleteBuffer(d.__webglNormalBuffer),J.deleteBuffer(d.__webglTangentBuffer),J.deleteBuffer(d.__webglColorBuffer),J.deleteBuffer(d.__webglUVBuffer),J.deleteBuffer(d.__webglUV2Buffer),J.deleteBuffer(d.__webglSkinVertexABuffer),J.deleteBuffer(d.__webglSkinVertexBBuffer),J.deleteBuffer(d.__webglSkinIndicesBuffer),J.deleteBuffer(d.__webglSkinWeightsBuffer),J.deleteBuffer(d.__webglFaceBuffer),J.deleteBuffer(d.__webglLineBuffer);var e=void 0,f=void 0;if(d.numMorphTargets){e=0;for(f=d.numMorphTargets;e<f;e++)J.deleteBuffer(d.__webglMorphTargetsBuffers[e])}if(d.numMorphNormals){e=0;for(f=d.numMorphNormals;e<f;e++)J.deleteBuffer(d.__webglMorphNormalsBuffers[e])}if(d.__webglCustomAttributesList){e=void 0;for(e in d.__webglCustomAttributesList)J.deleteBuffer(d.__webglCustomAttributesList[e].buffer)}I.info.memory.geometries--}else b instanceof a.Ribbon?(b=b.geometry,J.deleteBuffer(b.__webglVertexBuffer),J.deleteBuffer(b.__webglColorBuffer),I.info.memory.geometries--):b instanceof a.Line?(b=b.geometry,J.deleteBuffer(b.__webglVertexBuffer),J.deleteBuffer(b.__webglColorBuffer),I.info.memory.geometries--):b instanceof a.ParticleSystem&&(b=b.geometry,J.deleteBuffer(b.__webglVertexBuffer),J.deleteBuffer(b.__webglColorBuffer),I.info.memory.geometries--)}},this.deallocateTexture=function(a){a.__webglInit&&(a.__webglInit=!1,J.deleteTexture(a.__webglTexture),I.info.memory.textures--)},this.deallocateRenderTarget=function(b){if(b&&b.__webglTexture){J.deleteTexture(b.__webglTexture);if(b instanceof a.WebGLRenderTargetCube)for(var c=0;c<6;c++)J.deleteFramebuffer(b.__webglFramebuffer[c]),J.deleteRenderbuffer(b.__webglRenderbuffer[c]);else J.deleteFramebuffer(b.__webglFramebuffer),J.deleteRenderbuffer(b.__webglRenderbuffer)}},this.updateShadowMap=function(a,b){L=null,N=O=Y=X=T=-1,mb=!0,S=R=-1,this.shadowMapPlugin.update(a,b)},this.renderBufferImmediate=function(b,c,d){b.__webglVertexBuffer||(b.__webglVertexBuffer=J.createBuffer()),b.__webglNormalBuffer||(b.__webglNormalBuffer=J.createBuffer()),b.hasPos&&(J.bindBuffer(J.ARRAY_BUFFER,b.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,b.positionArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(c.attributes.position),J.vertexAttribPointer(c.attributes.position,3,J.FLOAT,!1,0,0));if(b.hasNormal){J.bindBuffer(J.ARRAY_BUFFER,b.__webglNormalBuffer);if(d===a.FlatShading){var e,f,g,h,i,j,k,l,m,n,o=b.count*3;for(n=0;n<o;n+=9)d=b.normalArray,e=d[n],f=d[n+1],g=d[n+2],h=d[n+3],j=d[n+4],l=d[n+5],i=d[n+6],k=d[n+7],m=d[n+8],e=(e+h+i)/3,f=(f+j+k)/3,g=(g+l+m)/3,d[n]=e,d[n+1]=f,d[n+2]=g,d[n+3]=e,d[n+4]=f,d[n+5]=g,d[n+6]=e,d[n+7]=f,d[n+8]=g}J.bufferData(J.ARRAY_BUFFER,b.normalArray,J.DYNAMIC_DRAW),J.enableVertexAttribArray(c.attributes.normal),J.vertexAttribPointer(c.attributes.normal,3,J.FLOAT,!1,0,0)}J.drawArrays(J.TRIANGLES,0,b.count),b.count=0},this.renderBufferDirect=function(b,c,d,e,f,g){if(e.visible!==!1){d=q(b,c,d,e,g),b=d.attributes,c=!1,e=f.id*16777215+d.id*2+(e.wireframe?1:0),e!==O&&(O=e,c=!0);if(g instanceof a.Mesh){g=f.offsets,e=0;for(d=g.length;e<d;++e)c&&(J.bindBuffer(J.ARRAY_BUFFER,f.vertexPositionBuffer),J.vertexAttribPointer(b.position,f.vertexPositionBuffer.itemSize,J.FLOAT,!1,0,g[e].index*12),b.normal>=0&&f.vertexNormalBuffer&&(J.bindBuffer(J.ARRAY_BUFFER,f.vertexNormalBuffer),J.vertexAttribPointer(b.normal,f.vertexNormalBuffer.itemSize,J.FLOAT,!1,0,g[e].index*12)),b.uv>=0&&f.vertexUvBuffer&&(f.vertexUvBuffer?(J.bindBuffer(J.ARRAY_BUFFER,f.vertexUvBuffer),J.vertexAttribPointer(b.uv,f.vertexUvBuffer.itemSize,J.FLOAT,!1,0,g[e].index*8),J.enableVertexAttribArray(b.uv)):J.disableVertexAttribArray(b.uv)),b.color>=0&&f.vertexColorBuffer&&(J.bindBuffer(J.ARRAY_BUFFER,f.vertexColorBuffer),J.vertexAttribPointer(b.color,f.vertexColorBuffer.itemSize,J.FLOAT,!1,0,g[e].index*16)),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,f.vertexIndexBuffer)),J.drawElements(J.TRIANGLES,g[e].count,J.UNSIGNED_SHORT,g[e].start*2),I.info.render.calls++,I.info.render.vertices=I.info.render.vertices+g[e].count,I.info.render.faces=I.info.render.faces+g[e].count/3}}},this.renderBuffer=function(b,c,d,e,f,g){if(e.visible!==!1){var h,i,d=q(b,c,d,e,g),c=d.attributes,b=!1,d=f.id*16777215+d.id*2+(e.wireframe?1:0);d!==O&&(O=d,b=!0);if(!e.morphTargets&&c.position>=0)b&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglVertexBuffer),J.vertexAttribPointer(c.position,3,J.FLOAT,!1,0,0));else if(g.morphTargetBase){d=e.program.attributes,g.morphTargetBase!==-1?(J.bindBuffer(J.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[g.morphTargetBase]),J.vertexAttribPointer(d.position,3,J.FLOAT,!1,0,0)):d.position>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglVertexBuffer),J.vertexAttribPointer(d.position,3,J.FLOAT,!1,0,0));if(g.morphTargetForcedOrder.length){h=0;var j=g.morphTargetForcedOrder;for(i=g.morphTargetInfluences;h<e.numSupportedMorphTargets&&h<j.length;)J.bindBuffer(J.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[j[h]]),J.vertexAttribPointer(d["morphTarget"+h],3,J.FLOAT,!1,0,0),e.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglMorphNormalsBuffers[j[h]]),J.vertexAttribPointer(d["morphNormal"+h],3,J.FLOAT,!1,0,0)),g.__webglMorphTargetInfluences[h]=i[j[h]],h++}else{var j=[],k=-1,l=0;i=g.morphTargetInfluences;var m,n=i.length;h=0;for(g.morphTargetBase!==-1&&(j[g.morphTargetBase]=!0);h<e.numSupportedMorphTargets;){for(m=0;m<n;m++)!j[m]&&i[m]>k&&(l=m,k=i[l]);J.bindBuffer(J.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[l]),J.vertexAttribPointer(d["morphTarget"+h],3,J.FLOAT,!1,0,0),e.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglMorphNormalsBuffers[l]),J.vertexAttribPointer(d["morphNormal"+h],3,J.FLOAT,!1,0,0)),g.__webglMorphTargetInfluences[h]=k,j[l]=1,k=-1,h++}}e.program.uniforms.morphTargetInfluences!==null&&J.uniform1fv(e.program.uniforms.morphTargetInfluences,g.__webglMorphTargetInfluences)}if(b){if(f.__webglCustomAttributesList){h=0;for(i=f.__webglCustomAttributesList.length;h<i;h++)d=f.__webglCustomAttributesList[h],c[d.buffer.belongsToAttribute]>=0&&(J.bindBuffer(J.ARRAY_BUFFER,d.buffer),J.vertexAttribPointer(c[d.buffer.belongsToAttribute],d.size,J.FLOAT,!1,0,0))}c.color>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglColorBuffer),J.vertexAttribPointer(c.color,3,J.FLOAT,!1,0,0)),c.normal>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglNormalBuffer),J.vertexAttribPointer(c.normal,3,J.FLOAT,!1,0,0)),c.tangent>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglTangentBuffer),J.vertexAttribPointer(c.tangent,4,J.FLOAT,!1,0,0)),c.uv>=0&&(f.__webglUVBuffer?(J.bindBuffer(J.ARRAY_BUFFER,f.__webglUVBuffer),J.vertexAttribPointer(c.uv,2,J.FLOAT,!1,0,0),J.enableVertexAttribArray(c.uv)):J.disableVertexAttribArray(c.uv)),c.uv2>=0&&(f.__webglUV2Buffer?(J.bindBuffer(J.ARRAY_BUFFER,f.__webglUV2Buffer),J.vertexAttribPointer(c.uv2,2,J.FLOAT,!1,0,0),J.enableVertexAttribArray(c.uv2)):J.disableVertexAttribArray(c.uv2)),e.skinning&&c.skinVertexA>=0&&c.skinVertexB>=0&&c.skinIndex>=0&&c.skinWeight>=0&&(J.bindBuffer(J.ARRAY_BUFFER,f.__webglSkinVertexABuffer),J.vertexAttribPointer(c.skinVertexA,4,J.FLOAT,!1,0,0),J.bindBuffer(J.ARRAY_BUFFER,f.__webglSkinVertexBBuffer),J.vertexAttribPointer(c.skinVertexB,4,J.FLOAT,!1,0,0),J.bindBuffer(J.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),J.vertexAttribPointer(c.skinIndex,4,J.FLOAT,!1,0,0),J.bindBuffer(J.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),J.vertexAttribPointer(c.skinWeight,4,J.FLOAT,!1,0,0))}g instanceof a.Mesh?(e.wireframe?(e=e.wireframeLinewidth,e!==ab&&(J.lineWidth(e),ab=e),b&&J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),J.drawElements(J.LINES,f.__webglLineCount,J.UNSIGNED_SHORT,0)):(b&&J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),J.drawElements(J.TRIANGLES,f.__webglFaceCount,J.UNSIGNED_SHORT,0)),I.info.render.calls++,I.info.render.vertices=I.info.render.vertices+f.__webglFaceCount,I.info.render.faces=I.info.render.faces+f.__webglFaceCount/3):g instanceof a.Line?(g=g.type===a.LineStrip?J.LINE_STRIP:J.LINES,e=e.linewidth,e!==ab&&(J.lineWidth(e),ab=e),J.drawArrays(g,0,f.__webglLineCount),I.info.render.calls++):g instanceof a.ParticleSystem?(J.drawArrays(J.POINTS,0,f.__webglParticleCount),I.info.render.calls++,I.info.render.points=I.info.render.points+f.__webglParticleCount):g instanceof a.Ribbon&&(J.drawArrays(J.TRIANGLE_STRIP,0,f.__webglVertexCount),I.info.render.calls++)}},this.render=function(b,c,d,e){var f,g,l,m,n=b.__lights,o=b.fog;N=-1,mb=!0,c.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),b.add(c)),this.autoUpdateScene&&b.updateMatrixWorld(),c._viewMatrixArray||(c._viewMatrixArray=new Float32Array(16)),c._projectionMatrixArray||(c._projectionMatrixArray=new Float32Array(16)),c.matrixWorldInverse.getInverse(c.matrixWorld),c.matrixWorldInverse.flattenToArray(c._viewMatrixArray),c.projectionMatrix.flattenToArray(c._projectionMatrixArray),ib.multiply(c.projectionMatrix,c.matrixWorldInverse),hb.setFromMatrix(ib),this.autoUpdateObjects&&this.initWebGLObjects(b),i(this.renderPluginsPre,b,c),I.info.render.calls=0,I.info.render.vertices=0,I.info.render.faces=0,I.info.render.points=0,this.setRenderTarget(d),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),m=b.__webglObjects,e=0;for(f=m.length;e<f;e++){g=m[e],l=g.object,g.render=!1;if(l.visible&&(!(l instanceof a.Mesh||l instanceof a.ParticleSystem)||!l.frustumCulled||hb.contains(l))){r(l,c);var p=g,q=p.object,t=p.buffer,u=void 0,u=u=void 0,u=q.material;u instanceof a.MeshFaceMaterial?(u=t.materialIndex,u>=0&&(u=q.geometry.materials[u],u.transparent?(p.transparent=u,p.opaque=null):(p.opaque=u,p.transparent=null))):u&&(u.transparent?(p.transparent=u,p.opaque=null):(p.opaque=u,p.transparent=null)),g.render=!0,this.sortObjects&&(l.renderDepth?g.z=l.renderDepth:(kb.copy(l.matrixWorld.getPosition()),ib.multiplyVector3(kb),g.z=kb.z))}}this.sortObjects&&m.sort(h),m=b.__webglObjectsImmediate,e=0;for(f=m.length;e<f;e++)g=m[e],l=g.object,l.visible&&(r(l,c),l=g.object.material,l.transparent?(g.transparent=l,g.opaque=null):(g.opaque=l,g.transparent=null));b.overrideMaterial?(e=b.overrideMaterial,this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst),this.setDepthTest(e.depthTest),this.setDepthWrite(e.depthWrite),s(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),j(b.__webglObjects,!1,"",c,n,o,!0,e),k(b.__webglObjectsImmediate,"",c,n,o,!1,e)):(this.setBlending(a.NormalBlending),j(b.__webglObjects,!0,"opaque",c,n,o,!1),k(b.__webglObjectsImmediate,"opaque",c,n,o,!1),j(b.__webglObjects,!1,"transparent",c,n,o,!0),k(b.__webglObjectsImmediate,"transparent",c,n,o,!0)),i(this.renderPluginsPost,b,c),d&&d.generateMipmaps&&d.minFilter!==a.NearestFilter&&d.minFilter!==a.LinearFilter&&(d instanceof a.WebGLRenderTargetCube?(J.bindTexture(J.TEXTURE_CUBE_MAP,d.__webglTexture),J.generateMipmap(J.TEXTURE_CUBE_MAP),J.bindTexture(J.TEXTURE_CUBE_MAP,null)):(J.bindTexture(J.TEXTURE_2D,d.__webglTexture),J.generateMipmap(J.TEXTURE_2D),J.bindTexture(J.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(a,b,c,d,e){var f=q(a,b,c,d,e);O=-1,I.setObjectFaces(e),e.immediateRenderCallback?e.immediateRenderCallback(f,J,hb):e.render(function(a){I.renderBufferImmediate(a,f,d.shading)})},this.initWebGLObjects=function(b){b.__webglObjects||(b.__webglObjects=[],b.__webglObjectsImmediate=[],b.__webglSprites=[],b.__webglFlares=[]);for(;b.__objectsAdded.length;){var h=b.__objectsAdded[0],i=b,j=void 0,k=void 0,q=void 0;if(!h.__webglInit){h.__webglInit=!0,h._modelViewMatrix=new a.Matrix4,h._normalMatrix=new a.Matrix3;if(h instanceof a.Mesh){k=h.geometry;if(k instanceof a.Geometry){if(k.geometryGroups===void 0){var r=k,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z={},A=r.morphTargets.length,B=r.morphNormals.length;r.geometryGroups={},s=0;for(t=r.faces.length;s<t;s++)u=r.faces[s],v=u.materialIndex,x=v!==void 0?v:-1,z[x]===void 0&&(z[x]={hash:x,counter:0}),y=z[x].hash+"_"+z[x].counter,r.geometryGroups[y]===void 0&&(r.geometryGroups[y]={faces3:[],faces4:[],materialIndex:v,vertices:0,numMorphTargets:A,numMorphNormals:B}),w=u instanceof a.Face3?3:4,r.geometryGroups[y].vertices+w>65535&&(z[x].counter=z[x].counter+1,y=z[x].hash+"_"+z[x].counter,r.geometryGroups[y]===void 0&&(r.geometryGroups[y]={faces3:[],faces4:[],materialIndex:v,vertices:0,numMorphTargets:A,numMorphNormals:B})),u instanceof a.Face3?r.geometryGroups[y].faces3.push(s):r.geometryGroups[y].faces4.push(s),r.geometryGroups[y].vertices=r.geometryGroups[y].vertices+w;r.geometryGroupsList=[];var C=void 0;for(C in r.geometryGroups)r.geometryGroups[C].id=Q++,r.geometryGroupsList.push(r.geometryGroups[C])}for(j in k.geometryGroups){q=k.geometryGroups[j];if(!q.__webglVertexBuffer){var D=q;D.__webglVertexBuffer=J.createBuffer(),D.__webglNormalBuffer=J.createBuffer(),D.__webglTangentBuffer=J.createBuffer(),D.__webglColorBuffer=J.createBuffer(),D.__webglUVBuffer=J.createBuffer(),D.__webglUV2Buffer=J.createBuffer(),D.__webglSkinVertexABuffer=J.createBuffer(),D.__webglSkinVertexBBuffer=J.createBuffer(),D.__webglSkinIndicesBuffer=J.createBuffer(),D.__webglSkinWeightsBuffer=J.createBuffer(),D.__webglFaceBuffer=J.createBuffer(),D.__webglLineBuffer=J.createBuffer();var E=void 0,F=void 0;if(D.numMorphTargets){D.__webglMorphTargetsBuffers=[],E=0;for(F=D.numMorphTargets;E<F;E++)D.__webglMorphTargetsBuffers.push(J.createBuffer())}if(D.numMorphNormals){D.__webglMorphNormalsBuffers=[],E=0;for(F=D.numMorphNormals;E<F;E++)D.__webglMorphNormalsBuffers.push(J.createBuffer())}I.info.memory.geometries++;var G=q,H=h,K=H.geometry,L=G.faces3,M=G.faces4,N=L.length*3+M.length*4,O=L.length*1+M.length*2,P=L.length*3+M.length*4,R=d(H,G),S=f(R),T=e(R),U=R.vertexColors?R.vertexColors:!1;G.__vertexArray=new Float32Array(N*3),T&&(G.__normalArray=new Float32Array(N*3)),K.hasTangents&&(G.__tangentArray=new Float32Array(N*4)),U&&(G.__colorArray=new Float32Array(N*3));if(S){if(K.faceUvs.length>0||K.faceVertexUvs.length>0)G.__uvArray=new Float32Array(N*2);if(K.faceUvs.length>1||K.faceVertexUvs.length>1)G.__uv2Array=new Float32Array(N*2)}H.geometry.skinWeights.length&&H.geometry.skinIndices.length&&(G.__skinVertexAArray=new Float32Array(N*4),G.__skinVertexBArray=new Float32Array(N*4),G.__skinIndexArray=new Float32Array(N*4),G.__skinWeightArray=new Float32Array(N*4)),G.__faceArray=new Uint16Array(O*3),G.__lineArray=new Uint16Array(P*2);var V=void 0,W=void 0;if(G.numMorphTargets){G.__morphTargetsArrays=[],V=0;for(W=G.numMorphTargets;V<W;V++)G.__morphTargetsArrays.push(new Float32Array(N*3))}if(G.numMorphNormals){G.__morphNormalsArrays=[],V=0;for(W=G.numMorphNormals;V<W;V++)G.__morphNormalsArrays.push(new Float32Array(N*3))}G.__webglFaceCount=O*3,G.__webglLineCount=P*2;if(R.attributes){G.__webglCustomAttributesList===void 0&&(G.__webglCustomAttributesList=[]);var X=void 0;for(X in R.attributes){var Y=R.attributes[X],Z={},$;for($ in Y)Z[$]=Y[$];if(!Z.__webglInitialized||Z.createUniqueBuffers){Z.__webglInitialized=!0;var _=1;Z.type==="v2"?_=2:Z.type==="v3"?_=3:Z.type==="v4"?_=4:Z.type==="c"&&(_=3),Z.size=_,Z.array=new Float32Array(N*_),Z.buffer=J.createBuffer(),Z.buffer.belongsToAttribute=X,Y.needsUpdate=!0,Z.__original=Y}G.__webglCustomAttributesList.push(Z)}}G.__inittedArrays=!0,k.verticesNeedUpdate=!0,k.morphTargetsNeedUpdate=!0,k.elementsNeedUpdate=!0,k.uvsNeedUpdate=!0,k.normalsNeedUpdate=!0,k.tangetsNeedUpdate=!0,k.colorsNeedUpdate=!0}}}}else if(h instanceof a.Ribbon){k=h.geometry;if(!k.__webglVertexBuffer){var ab=k;ab.__webglVertexBuffer=J.createBuffer(),ab.__webglColorBuffer=J.createBuffer(),I.info.memory.geometries++;var bb=k,cb=bb.vertices.length;bb.__vertexArray=new Float32Array(cb*3),bb.__colorArray=new Float32Array(cb*3),bb.__webglVertexCount=cb,k.verticesNeedUpdate=!0,k.colorsNeedUpdate=!0}}else if(h instanceof a.Line){k=h.geometry;if(!k.__webglVertexBuffer){var db=k;db.__webglVertexBuffer=J.createBuffer(),db.__webglColorBuffer=J.createBuffer(),I.info.memory.geometries++;var eb=k,fb=h,gb=eb.vertices.length;eb.__vertexArray=new Float32Array(gb*3),eb.__colorArray=new Float32Array(gb*3),eb.__webglLineCount=gb,c(eb,fb),k.verticesNeedUpdate=!0,k.colorsNeedUpdate=!0}}else if(h instanceof a.ParticleSystem){k=h.geometry;if(!k.__webglVertexBuffer){var hb=k;hb.__webglVertexBuffer=J.createBuffer(),hb.__webglColorBuffer=J.createBuffer(),I.info.geometries++;var ib=k,jb=h,kb=ib.vertices.length;ib.__vertexArray=new Float32Array(kb*3),ib.__colorArray=new Float32Array(kb*3),ib.__sortArray=[],ib.__webglParticleCount=kb,c(ib,jb),k.verticesNeedUpdate=!0,k.colorsNeedUpdate=!0}}}if(!h.__webglActive){if(h instanceof a.Mesh){k=h.geometry;if(k instanceof a.BufferGeometry)l(i.__webglObjects,k,h);else for(j in k.geometryGroups)q=k.geometryGroups[j],l(i.__webglObjects,q,h)}else h instanceof a.Ribbon||h instanceof a.Line||h instanceof a.ParticleSystem?(k=h.geometry,l(i.__webglObjects,k,h)):h instanceof a.ImmediateRenderObject||h.immediateRenderCallback?i.__webglObjectsImmediate.push({object:h,opaque:null,transparent:null}):h instanceof a.Sprite?i.__webglSprites.push(h):h instanceof a.LensFlare&&i.__webglFlares.push(h);h.__webglActive=!0}b.__objectsAdded.splice(0,1)}for(;b.__objectsRemoved.length;){var lb=b.__objectsRemoved[0],mb=b;lb instanceof a.Mesh||lb instanceof a.ParticleSystem||lb instanceof a.Ribbon||lb instanceof a.Line?o(mb.__webglObjects,lb):lb instanceof a.Sprite?p(mb.__webglSprites,lb):lb instanceof a.LensFlare?p(mb.__webglFlares,lb):(lb instanceof a.ImmediateRenderObject||lb.immediateRenderCallback)&&o(mb.__webglObjectsImmediate,lb),lb.__webglActive=!1,b.__objectsRemoved.splice(0,1)}for(var nb=0,ob=b.__webglObjects.length;nb<ob;nb++){var pb=b.__webglObjects[nb].object,qb=pb.geometry,rb=void 0,sb=void 0,tb=void 0;if(pb instanceof a.Mesh)if(qb instanceof a.BufferGeometry)qb.verticesNeedUpdate=!1,qb.elementsNeedUpdate=!1,qb.uvsNeedUpdate=!1,qb.normalsNeedUpdate=!1,qb.colorsNeedUpdate=!1;else{for(var ub=0,vb=qb.geometryGroupsList.length;ub<vb;ub++){rb=qb.geometryGroupsList[ub],tb=d(pb,rb),sb=tb.attributes&&m(tb);if(qb.verticesNeedUpdate||qb.morphTargetsNeedUpdate||qb.elementsNeedUpdate||qb.uvsNeedUpdate||qb.normalsNeedUpdate||qb.colorsNeedUpdate||qb.tangetsNeedUpdate||sb){var wb=rb,xb=pb,yb=J.DYNAMIC_DRAW,zb=!qb.dynamic,Ab=tb;if(wb.__inittedArrays){var Bb=e(Ab),Cb=Ab.vertexColors?Ab.vertexColors:!1,Db=f(Ab),Eb=Bb===a.SmoothShading,Fb=void 0,Gb=void 0,Hb=void 0,Ib=void 0,Jb=void 0,Kb=void 0,Lb=void 0,Mb=void 0,Nb=void 0,Ob=void 0,Pb=void 0,Qb=void 0,Rb=void 0,Sb=void 0,Tb=void 0,Ub=void 0,Vb=void 0,Wb=void 0,Xb=void 0,Yb=void 0,Zb=void 0,$b=void 0,_b=void 0,ac=void 0,bc=void 0,cc=void 0,dc=void 0,ec=void 0,fc=void 0,gc=void 0,hc=void 0,ic=void 0,jc=void 0,kc=void 0,lc=void 0,mc=void 0,nc=void 0,oc=void 0,pc=void 0,qc=void 0,rc=void 0,sc=void 0,tc=void 0,uc=void 0,vc=void 0,wc=void 0,xc=void 0,yc=void 0,zc=void 0,Ac=void 0,Bc=void 0,Cc=void 0,Dc=void 0,Ec=void 0,Fc=0,Gc=0,Hc=0,Ic=0,Jc=0,Kc=0,Lc=0,Mc=0,Nc=0,Oc=0,Pc=0,Qc=0,Rc=void 0,Sc=wb.__vertexArray,Tc=wb.__uvArray,Uc=wb.__uv2Array,Vc=wb.__normalArray,Wc=wb.__tangentArray,Xc=wb.__colorArray,Yc=wb.__skinVertexAArray,Zc=wb.__skinVertexBArray,$c=wb.__skinIndexArray,_c=wb.__skinWeightArray,ad=wb.__morphTargetsArrays,bd=wb.__morphNormalsArrays,cd=wb.__webglCustomAttributesList,dd=void 0,ed=wb.__faceArray,fd=wb.__lineArray,gd=xb.geometry,hd=gd.elementsNeedUpdate,id=gd.uvsNeedUpdate,jd=gd.normalsNeedUpdate,kd=gd.tangetsNeedUpdate,ld=gd.colorsNeedUpdate,md=gd.morphTargetsNeedUpdate,nd=gd.vertices,od=wb.faces3,pd=wb.faces4,qd=gd.faces,rd=gd.faceVertexUvs[0],sd=gd.faceVertexUvs[1],td=gd.skinVerticesA,ud=gd.skinVerticesB,vd=gd.skinIndices,wd=gd.skinWeights,xd=gd.morphTargets,yd=gd.morphNormals;if(gd.verticesNeedUpdate){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Qb=nd[Ib.a],Rb=nd[Ib.b],Sb=nd[Ib.c],Sc[Gc]=Qb.x,Sc[Gc+1]=Qb.y,Sc[Gc+2]=Qb.z,Sc[Gc+3]=Rb.x,Sc[Gc+4]=Rb.y,Sc[Gc+5]=Rb.z,Sc[Gc+6]=Sb.x,Sc[Gc+7]=Sb.y,Sc[Gc+8]=Sb.z,Gc+=9;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Qb=nd[Ib.a],Rb=nd[Ib.b],Sb=nd[Ib.c],Tb=nd[Ib.d],Sc[Gc]=Qb.x,Sc[Gc+1]=Qb.y,Sc[Gc+2]=Qb.z,Sc[Gc+3]=Rb.x,Sc[Gc+4]=Rb.y,Sc[Gc+5]=Rb.z,Sc[Gc+6]=Sb.x,Sc[Gc+7]=Sb.y,Sc[Gc+8]=Sb.z,Sc[Gc+9]=Tb.x,Sc[Gc+10]=Tb.y,Sc[Gc+11]=Tb.z,Gc+=12;J.bindBuffer(J.ARRAY_BUFFER,wb.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,Sc,yb)}if(md){zc=0;for(Ac=xd.length;zc<Ac;zc++){Fb=Pc=0;for(Gb=od.length;Fb<Gb;Fb++)Dc=od[Fb],Ib=qd[Dc],Qb=xd[zc].vertices[Ib.a],Rb=xd[zc].vertices[Ib.b],Sb=xd[zc].vertices[Ib.c],Bc=ad[zc],Bc[Pc]=Qb.x,Bc[Pc+1]=Qb.y,Bc[Pc+2]=Qb.z,Bc[Pc+3]=Rb.x,Bc[Pc+4]=Rb.y,Bc[Pc+5]=Rb.z,Bc[Pc+6]=Sb.x,Bc[Pc+7]=Sb.y,Bc[Pc+8]=Sb.z,Ab.morphNormals&&(Eb?(Ec=yd[zc].vertexNormals[Dc],Yb=Ec.a,Zb=Ec.b,$b=Ec.c):$b=Zb=Yb=yd[zc].faceNormals[Dc],Cc=bd[zc],Cc[Pc]=Yb.x,Cc[Pc+1]=Yb.y,Cc[Pc+2]=Yb.z,Cc[Pc+3]=Zb.x,Cc[Pc+4]=Zb.y,Cc[Pc+5]=Zb.z,Cc[Pc+6]=$b.x,Cc[Pc+7]=$b.y,Cc[Pc+8]=$b.z),Pc+=9;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Dc=pd[Fb],Ib=qd[Dc],Qb=xd[zc].vertices[Ib.a],Rb=xd[zc].vertices[Ib.b],Sb=xd[zc].vertices[Ib.c],Tb=xd[zc].vertices[Ib.d],Bc=ad[zc],Bc[Pc]=Qb.x,Bc[Pc+1]=Qb.y,Bc[Pc+2]=Qb.z,Bc[Pc+3]=Rb.x,Bc[Pc+4]=Rb.y,Bc[Pc+5]=Rb.z,Bc[Pc+6]=Sb.x,Bc[Pc+7]=Sb.y,Bc[Pc+8]=Sb.z,Bc[Pc+9]=Tb.x,Bc[Pc+10]=Tb.y,Bc[Pc+11]=Tb.z,Ab.morphNormals&&(Eb?(Ec=yd[zc].vertexNormals[Dc],Yb=Ec.a,Zb=Ec.b,$b=Ec.c,_b=Ec.d):_b=$b=Zb=Yb=yd[zc].faceNormals[Dc],Cc=bd[zc],Cc[Pc]=Yb.x,Cc[Pc+1]=Yb.y,Cc[Pc+2]=Yb.z,Cc[Pc+3]=Zb.x,Cc[Pc+4]=Zb.y,Cc[Pc+5]=Zb.z,Cc[Pc+6]=$b.x,Cc[Pc+7]=$b.y,Cc[Pc+8]=$b.z,Cc[Pc+9]=_b.x,Cc[Pc+10]=_b.y,Cc[Pc+11]=_b.z),Pc+=12;J.bindBuffer(J.ARRAY_BUFFER,wb.__webglMorphTargetsBuffers[zc]),J.bufferData(J.ARRAY_BUFFER,ad[zc],yb),Ab.morphNormals&&(J.bindBuffer(J.ARRAY_BUFFER,wb.__webglMorphNormalsBuffers[zc]),J.bufferData(J.ARRAY_BUFFER,bd[zc],yb))}}if(wd.length){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],ec=wd[Ib.a],fc=wd[Ib.b],gc=wd[Ib.c],_c[Oc]=ec.x,_c[Oc+1]=ec.y,_c[Oc+2]=ec.z,_c[Oc+3]=ec.w,_c[Oc+4]=fc.x,_c[Oc+5]=fc.y,_c[Oc+6]=fc.z,_c[Oc+7]=fc.w,_c[Oc+8]=gc.x,_c[Oc+9]=gc.y,_c[Oc+10]=gc.z,_c[Oc+11]=gc.w,ic=vd[Ib.a],jc=vd[Ib.b],kc=vd[Ib.c],$c[Oc]=ic.x,$c[Oc+1]=ic.y,$c[Oc+2]=ic.z,$c[Oc+3]=ic.w,$c[Oc+4]=jc.x,$c[Oc+5]=jc.y,$c[Oc+6]=jc.z,$c[Oc+7]=jc.w,$c[Oc+8]=kc.x,$c[Oc+9]=kc.y,$c[Oc+10]=kc.z,$c[Oc+11]=kc.w,mc=td[Ib.a],nc=td[Ib.b],oc=td[Ib.c],Yc[Oc]=mc.x,Yc[Oc+1]=mc.y,Yc[Oc+2]=mc.z,Yc[Oc+3]=1,Yc[Oc+4]=nc.x,Yc[Oc+5]=nc.y,Yc[Oc+6]=nc.z,Yc[Oc+7]=1,Yc[Oc+8]=oc.x,Yc[Oc+9]=oc.y,Yc[Oc+10]=oc.z,Yc[Oc+11]=1,qc=ud[Ib.a],rc=ud[Ib.b],sc=ud[Ib.c],Zc[Oc]=qc.x,Zc[Oc+1]=qc.y,Zc[Oc+2]=qc.z,Zc[Oc+3]=1,Zc[Oc+4]=rc.x,Zc[Oc+5]=rc.y,Zc[Oc+6]=rc.z,Zc[Oc+7]=1,Zc[Oc+8]=sc.x,Zc[Oc+9]=sc.y,Zc[Oc+10]=sc.z,Zc[Oc+11]=1,Oc+=12;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],ec=wd[Ib.a],fc=wd[Ib.b],gc=wd[Ib.c],hc=wd[Ib.d],_c[Oc]=ec.x,_c[Oc+1]=ec.y,_c[Oc+2]=ec.z,_c[Oc+3]=ec.w,_c[Oc+4]=fc.x,_c[Oc+5]=fc.y,_c[Oc+6]=fc.z,_c[Oc+7]=fc.w,_c[Oc+8]=gc.x,_c[Oc+9]=gc.y,_c[Oc+10]=gc.z,_c[Oc+11]=gc.w,_c[Oc+12]=hc.x,_c[Oc+13]=hc.y,_c[Oc+14]=hc.z,_c[Oc+15]=hc.w,ic=vd[Ib.a],jc=vd[Ib.b],kc=vd[Ib.c],lc=vd[Ib.d],$c[Oc]=ic.x,$c[Oc+1]=ic.y,$c[Oc+2]=ic.z,$c[Oc+3]=ic.w,$c[Oc+4]=jc.x,$c[Oc+5]=jc.y,$c[Oc+6]=jc.z,$c[Oc+7]=jc.w,$c[Oc+8]=kc.x,$c[Oc+9]=kc.y,$c[Oc+10]=kc.z,$c[Oc+11]=kc.w,$c[Oc+12]=lc.x,$c[Oc+13]=lc.y,$c[Oc+14]=lc.z,$c[Oc+15]=lc.w,mc=td[Ib.a],nc=td[Ib.b],oc=td[Ib.c],pc=td[Ib.d],Yc[Oc]=mc.x,Yc[Oc+1]=mc.y,Yc[Oc+2]=mc.z,Yc[Oc+3]=1,Yc[Oc+4]=nc.x,Yc[Oc+5]=nc.y,Yc[Oc+6]=nc.z,Yc[Oc+7]=1,Yc[Oc+8]=oc.x,Yc[Oc+9]=oc.y,Yc[Oc+10]=oc.z,Yc[Oc+11]=1,Yc[Oc+12]=pc.x,Yc[Oc+13]=pc.y,Yc[Oc+14]=pc.z,Yc[Oc+15]=1,qc=ud[Ib.a],rc=ud[Ib.b],sc=ud[Ib.c],tc=ud[Ib.d],Zc[Oc]=qc.x,Zc[Oc+1]=qc.y,Zc[Oc+2]=qc.z,Zc[Oc+3]=1,Zc[Oc+4]=rc.x,Zc[Oc+5]=rc.y,Zc[Oc+6]=rc.z,Zc[Oc+7]=1,Zc[Oc+8]=sc.x,Zc[Oc+9]=sc.y,Zc[Oc+10]=sc.z,Zc[Oc+11]=1,Zc[Oc+12]=tc.x,Zc[Oc+13]=tc.y,Zc[Oc+14]=tc.z,Zc[Oc+15]=1,Oc+=16;Oc>0&&(J.bindBuffer(J.ARRAY_BUFFER,wb.__webglSkinVertexABuffer),J.bufferData(J.ARRAY_BUFFER,Yc,yb),J.bindBuffer(J.ARRAY_BUFFER,wb.__webglSkinVertexBBuffer),J.bufferData(J.ARRAY_BUFFER,Zc,yb),J.bindBuffer(J.ARRAY_BUFFER,wb.__webglSkinIndicesBuffer),J.bufferData(J.ARRAY_BUFFER,$c,yb),J.bindBuffer(J.ARRAY_BUFFER,wb.__webglSkinWeightsBuffer),J.bufferData(J.ARRAY_BUFFER,_c,yb))}if(ld&&Cb){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Lb=Ib.vertexColors,Mb=Ib.color,Lb.length===3&&Cb===a.VertexColors?(ac=Lb[0],bc=Lb[1],cc=Lb[2]):cc=bc=ac=Mb,Xc[Nc]=ac.r,Xc[Nc+1]=ac.g,Xc[Nc+2]=ac.b,Xc[Nc+3]=bc.r,Xc[Nc+4]=bc.g,Xc[Nc+5]=bc.b,Xc[Nc+6]=cc.r,Xc[Nc+7]=cc.g,Xc[Nc+8]=cc.b,Nc+=9;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Lb=Ib.vertexColors,Mb=Ib.color,Lb.length===4&&Cb===a.VertexColors?(ac=Lb[0],bc=Lb[1],cc=Lb[2],dc=Lb[3]):dc=cc=bc=ac=Mb,Xc[Nc]=ac.r,Xc[Nc+1]=ac.g,Xc[Nc+2]=ac.b,Xc[Nc+3]=bc.r,Xc[Nc+4]=bc.g,Xc[Nc+5]=bc.b,Xc[Nc+6]=cc.r,Xc[Nc+7]=cc.g,Xc[Nc+8]=cc.b,Xc[Nc+9]=dc.r,Xc[Nc+10]=dc.g,Xc[Nc+11]=dc.b,Nc+=12;Nc>0&&(J.bindBuffer(J.ARRAY_BUFFER,wb.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,Xc,yb))}if(kd&&gd.hasTangents){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Nb=Ib.vertexTangents,Ub=Nb[0],Vb=Nb[1],Wb=Nb[2],Wc[Lc]=Ub.x,Wc[Lc+1]=Ub.y,Wc[Lc+2]=Ub.z,Wc[Lc+3]=Ub.w,Wc[Lc+4]=Vb.x,Wc[Lc+5]=Vb.y,Wc[Lc+6]=Vb.z,Wc[Lc+7]=Vb.w,Wc[Lc+8]=Wb.x,Wc[Lc+9]=Wb.y,Wc[Lc+10]=Wb.z,Wc[Lc+11]=Wb.w,Lc+=12;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Nb=Ib.vertexTangents,Ub=Nb[0],Vb=Nb[1],Wb=Nb[2],Xb=Nb[3],Wc[Lc]=Ub.x,Wc[Lc+1]=Ub.y,Wc[Lc+2]=Ub.z,Wc[Lc+3]=Ub.w,Wc[Lc+4]=Vb.x,Wc[Lc+5]=Vb.y,Wc[Lc+6]=Vb.z,Wc[Lc+7]=Vb.w,Wc[Lc+8]=Wb.x,Wc[Lc+9]=Wb.y,Wc[Lc+10]=Wb.z,Wc[Lc+11]=Wb.w,Wc[Lc+12]=Xb.x,Wc[Lc+13]=Xb.y,Wc[Lc+14]=Xb.z,Wc[Lc+15]=Xb.w,Lc+=16;J.bindBuffer(J.ARRAY_BUFFER,wb.__webglTangentBuffer),J.bufferData(J.ARRAY_BUFFER,Wc,yb)}if(jd&&Bb){Fb=0;for(Gb=od.length;Fb<Gb;Fb++){Ib=qd[od[Fb]],Jb=Ib.vertexNormals,Kb=Ib.normal;if(Jb.length===3&&Eb)for(uc=0;uc<3;uc++)wc=Jb[uc],Vc[Kc]=wc.x,Vc[Kc+1]=wc.y,Vc[Kc+2]=wc.z,Kc+=3;else for(uc=0;uc<3;uc++)Vc[Kc]=Kb.x,Vc[Kc+1]=Kb.y,Vc[Kc+2]=Kb.z,Kc+=3}Fb=0;for(Gb=pd.length;Fb<Gb;Fb++){Ib=qd[pd[Fb]],Jb=Ib.vertexNormals,Kb=Ib.normal;if(Jb.length===4&&Eb)for(uc=0;uc<4;uc++)wc=Jb[uc],Vc[Kc]=wc.x,Vc[Kc+1]=wc.y,Vc[Kc+2]=wc.z,Kc+=3;else for(uc=0;uc<4;uc++)Vc[Kc]=Kb.x,Vc[Kc+1]=Kb.y,Vc[Kc+2]=Kb.z,Kc+=3}J.bindBuffer(J.ARRAY_BUFFER,wb.__webglNormalBuffer),J.bufferData(J.ARRAY_BUFFER,Vc,yb)}if(id&&rd&&Db){Fb=0;for(Gb=od.length;Fb<Gb;Fb++){Hb=od[Fb],Ib=qd[Hb],Ob=rd[Hb];if(Ob!==void 0)for(uc=0;uc<3;uc++)xc=Ob[uc],Tc[Hc]=xc.u,Tc[Hc+1]=xc.v,Hc+=2}Fb=0;for(Gb=pd.length;Fb<Gb;Fb++){Hb=pd[Fb],Ib=qd[Hb],Ob=rd[Hb];if(Ob!==void 0)for(uc=0;uc<4;uc++)xc=Ob[uc],Tc[Hc]=xc.u,Tc[Hc+1]=xc.v,Hc+=2}Hc>0&&(J.bindBuffer(J.ARRAY_BUFFER,wb.__webglUVBuffer),J.bufferData(J.ARRAY_BUFFER,Tc,yb))}if(id&&sd&&Db){Fb=0;for(Gb=od.length;Fb<Gb;Fb++){Hb=od[Fb],Ib=qd[Hb],Pb=sd[Hb];if(Pb!==void 0)for(uc=0;uc<3;uc++)yc=Pb[uc],Uc[Ic]=yc.u,Uc[Ic+1]=yc.v,Ic+=2}Fb=0;for(Gb=pd.length;Fb<Gb;Fb++){Hb=pd[Fb],Ib=qd[Hb],Pb=sd[Hb];if(Pb!==void 0)for(uc=0;uc<4;uc++)yc=Pb[uc],Uc[Ic]=yc.u,Uc[Ic+1]=yc.v,Ic+=2}Ic>0&&(J.bindBuffer(J.ARRAY_BUFFER,wb.__webglUV2Buffer),J.bufferData(J.ARRAY_BUFFER,Uc,yb))}if(hd){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],ed[Jc]=Fc,ed[Jc+1]=Fc+1,ed[Jc+2]=Fc+2,Jc+=3,fd[Mc]=Fc,fd[Mc+1]=Fc+1,fd[Mc+2]=Fc,fd[Mc+3]=Fc+2,fd[Mc+4]=Fc+1,fd[Mc+5]=Fc+2,Mc+=6,Fc+=3;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],ed[Jc]=Fc,ed[Jc+1]=Fc+1,ed[Jc+2]=Fc+3,ed[Jc+3]=Fc+1,ed[Jc+4]=Fc+2,ed[Jc+5]=Fc+3,Jc+=6,fd[Mc]=Fc,fd[Mc+1]=Fc+1,fd[Mc+2]=Fc,fd[Mc+3]=Fc+3,fd[Mc+4]=Fc+1,fd[Mc+5]=Fc+2,fd[Mc+6]=Fc+2,fd[Mc+7]=Fc+3,Mc+=8,Fc+=4;J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,wb.__webglFaceBuffer),J.bufferData(J.ELEMENT_ARRAY_BUFFER,ed,yb),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,wb.__webglLineBuffer),J.bufferData(J.ELEMENT_ARRAY_BUFFER,fd,yb)}if(cd){uc=0;for(vc=cd.length;uc<vc;uc++){dd=cd[uc];if(dd.__original.needsUpdate){Qc=0;if(dd.size===1){if(dd.boundTo===void 0||dd.boundTo==="vertices"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],dd.array[Qc]=dd.value[Ib.a],dd.array[Qc+1]=dd.value[Ib.b],dd.array[Qc+2]=dd.value[Ib.c],Qc+=3;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],dd.array[Qc]=dd.value[Ib.a],dd.array[Qc+1]=dd.value[Ib.b],dd.array[Qc+2]=dd.value[Ib.c],dd.array[Qc+3]=dd.value[Ib.d],Qc+=4}else if(dd.boundTo==="faces"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Rc=dd.value[od[Fb]],dd.array[Qc]=Rc,dd.array[Qc+1]=Rc,dd.array[Qc+2]=Rc,Qc+=3;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Rc=dd.value[pd[Fb]],dd.array[Qc]=Rc,dd.array[Qc+1]=Rc,dd.array[Qc+2]=Rc,dd.array[Qc+3]=Rc,Qc+=4}}else if(dd.size===2){if(dd.boundTo===void 0||dd.boundTo==="vertices"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Rb.x,dd.array[Qc+3]=Rb.y,dd.array[Qc+4]=Sb.x,dd.array[Qc+5]=Sb.y,Qc+=6;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],Tb=dd.value[Ib.d],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Rb.x,dd.array[Qc+3]=Rb.y,dd.array[Qc+4]=Sb.x,dd.array[Qc+5]=Sb.y,dd.array[Qc+6]=Tb.x,dd.array[Qc+7]=Tb.y,Qc+=8}else if(dd.boundTo==="faces"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Sb=Rb=Qb=Rc=dd.value[od[Fb]],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Rb.x,dd.array[Qc+3]=Rb.y,dd.array[Qc+4]=Sb.x,dd.array[Qc+5]=Sb.y,Qc+=6;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Tb=Sb=Rb=Qb=Rc=dd.value[pd[Fb]],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Rb.x,dd.array[Qc+3]=Rb.y,dd.array[Qc+4]=Sb.x,dd.array[Qc+5]=Sb.y,dd.array[Qc+6]=Tb.x,dd.array[Qc+7]=Tb.y,Qc+=8}}else if(dd.size===3){var zd;zd=dd.type==="c"?["r","g","b"]:["x","y","z"];if(dd.boundTo===void 0||dd.boundTo==="vertices"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],dd.array[Qc]=Qb[zd[0]],dd.array[Qc+1]=Qb[zd[1]],dd.array[Qc+2]=Qb[zd[2]],dd.array[Qc+3]=Rb[zd[0]],dd.array[Qc+4]=Rb[zd[1]],dd.array[Qc+5]=Rb[zd[2]],dd.array[Qc+6]=Sb[zd[0]],dd.array[Qc+7]=Sb[zd[1]],dd.array[Qc+8]=Sb[zd[2]],Qc+=9;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],Tb=dd.value[Ib.d],dd.array[Qc]=Qb[zd[0]],dd.array[Qc+1]=Qb[zd[1]],dd.array[Qc+2]=Qb[zd[2]],dd.array[Qc+3]=Rb[zd[0]],dd.array[Qc+4]=Rb[zd[1]],dd.array[Qc+5]=Rb[zd[2]],dd.array[Qc+6]=Sb[zd[0]],dd.array[Qc+7]=Sb[zd[1]],dd.array[Qc+8]=Sb[zd[2]],dd.array[Qc+9]=Tb[zd[0]],dd.array[Qc+10]=Tb[zd[1]],dd.array[Qc+11]=Tb[zd[2]],Qc+=12}else if(dd.boundTo==="faces"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Sb=Rb=Qb=Rc=dd.value[od[Fb]],dd.array[Qc]=Qb[zd[0]],dd.array[Qc+1]=Qb[zd[1]],dd.array[Qc+2]=Qb[zd[2]],dd.array[Qc+3]=Rb[zd[0]],dd.array[Qc+4]=Rb[zd[1]],dd.array[Qc+5]=Rb[zd[2]],dd.array[Qc+6]=Sb[zd[0]],dd.array[Qc+7]=Sb[zd[1]],dd.array[Qc+8]=Sb[zd[2]],Qc+=9;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Tb=Sb=Rb=Qb=Rc=dd.value[pd[Fb]],dd.array[Qc]=Qb[zd[0]],dd.array[Qc+1]=Qb[zd[1]],dd.array[Qc+2]=Qb[zd[2]],dd.array[Qc+3]=Rb[zd[0]],dd.array[Qc+4]=Rb[zd[1]],dd.array[Qc+5]=Rb[zd[2]],dd.array[Qc+6]=Sb[zd[0]],dd.array[Qc+7]=Sb[zd[1]],dd.array[Qc+8]=Sb[zd[2]],dd.array[Qc+9]=Tb[zd[0]],dd.array[Qc+10]=Tb[zd[1]],dd.array[Qc+11]=Tb[zd[2]],Qc+=12}}else if(dd.size===4)if(dd.boundTo===void 0||dd.boundTo==="vertices"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Ib=qd[od[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Qb.z,dd.array[Qc+3]=Qb.w,dd.array[Qc+4]=Rb.x,dd.array[Qc+5]=Rb.y,dd.array[Qc+6]=Rb.z,dd.array[Qc+7]=Rb.w,dd.array[Qc+8]=Sb.x,dd.array[Qc+9]=Sb.y,dd.array[Qc+10]=Sb.z,dd.array[Qc+11]=Sb.w,Qc+=12;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Ib=qd[pd[Fb]],Qb=dd.value[Ib.a],Rb=dd.value[Ib.b],Sb=dd.value[Ib.c],Tb=dd.value[Ib.d],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Qb.z,dd.array[Qc+3]=Qb.w,dd.array[Qc+4]=Rb.x,dd.array[Qc+5]=Rb.y,dd.array[Qc+6]=Rb.z,dd.array[Qc+7]=Rb.w,dd.array[Qc+8]=Sb.x,dd.array[Qc+9]=Sb.y,dd.array[Qc+10]=Sb.z,dd.array[Qc+11]=Sb.w,dd.array[Qc+12]=Tb.x,dd.array[Qc+13]=Tb.y,dd.array[Qc+14]=Tb.z,dd.array[Qc+15]=Tb.w,Qc+=16}else if(dd.boundTo==="faces"){Fb=0;for(Gb=od.length;Fb<Gb;Fb++)Sb=Rb=Qb=Rc=dd.value[od[Fb]],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Qb.z,dd.array[Qc+3]=Qb.w,dd.array[Qc+4]=Rb.x,dd.array[Qc+5]=Rb.y,dd.array[Qc+6]=Rb.z,dd.array[Qc+7]=Rb.w,dd.array[Qc+8]=Sb.x,dd.array[Qc+9]=Sb.y,dd.array[Qc+10]=Sb.z,dd.array[Qc+11]=Sb.w,Qc+=12;Fb=0;for(Gb=pd.length;Fb<Gb;Fb++)Tb=Sb=Rb=Qb=Rc=dd.value[pd[Fb]],dd.array[Qc]=Qb.x,dd.array[Qc+1]=Qb.y,dd.array[Qc+2]=Qb.z,dd.array[Qc+3]=Qb.w,dd.array[Qc+4]=Rb.x,dd.array[Qc+5]=Rb.y,dd.array[Qc+6]=Rb.z,dd.array[Qc+7]=Rb.w,dd.array[Qc+8]=Sb.x,dd.array[Qc+9]=Sb.y,dd.array[Qc+10]=Sb.z,dd.array[Qc+11]=Sb.w,dd.array[Qc+12]=Tb.x,dd.array[Qc+13]=Tb.y,dd.array[Qc+14]=Tb.z,dd.array[Qc+15]=Tb.w,Qc+=16}J.bindBuffer(J.ARRAY_BUFFER,dd.buffer),J.bufferData(J.ARRAY_BUFFER,dd.array,yb)}}}zb&&(delete wb.__inittedArrays,delete wb.__colorArray,delete wb.__normalArray,delete wb.__tangentArray,delete wb.__uvArray,delete wb.__uv2Array,delete wb.__faceArray,delete wb.__vertexArray,delete wb.__lineArray,delete wb.__skinVertexAArray,delete wb.__skinVertexBArray,delete wb.__skinIndexArray,delete wb.__skinWeightArray)}}}qb.verticesNeedUpdate=!1,qb.morphTargetsNeedUpdate=!1,qb.elementsNeedUpdate=!1,qb.uvsNeedUpdate=!1,qb.normalsNeedUpdate=!1,qb.colorsNeedUpdate=!1,qb.tangetsNeedUpdate=!1,tb.attributes&&n(tb)}else if(pb instanceof a.Ribbon){if(qb.verticesNeedUpdate||qb.colorsNeedUpdate){var Ad=qb,Bd=J.DYNAMIC_DRAW,Cd=void 0,Dd=void 0,Ed=void 0,Fd=void 0,Gd=void 0,Hd=Ad.vertices,Id=Ad.colors,Jd=Hd.length,Kd=Id.length,Ld=Ad.__vertexArray,Md=Ad.__colorArray,Nd=Ad.colorsNeedUpdate;if(Ad.verticesNeedUpdate){for(Cd=0;Cd<Jd;Cd++)Ed=Hd[Cd],Fd=Cd*3,Ld[Fd]=Ed.x,Ld[Fd+1]=Ed.y,Ld[Fd+2]=Ed.z;J.bindBuffer(J.ARRAY_BUFFER,Ad.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,Ld,Bd)}if(Nd){for(Dd=0;Dd<Kd;Dd++)Gd=Id[Dd],Fd=Dd*3,Md[Fd]=Gd.r,Md[Fd+1]=Gd.g,Md[Fd+2]=Gd.b;J.bindBuffer(J.ARRAY_BUFFER,Ad.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,Md,Bd)}}qb.verticesNeedUpdate=!1,qb.colorsNeedUpdate=!1}else if(pb instanceof a.Line){tb=d(pb,rb),sb=tb.attributes&&m(tb);if(qb.verticesNeedUpdate||qb.colorsNeedUpdate||sb){var Od=qb,Pd=J.DYNAMIC_DRAW,Qd=void 0,Rd=void 0,Sd=void 0,Td=void 0,Ud=void 0,Vd=Od.vertices,Wd=Od.colors,Xd=Vd.length,Yd=Wd.length,Zd=Od.__vertexArray,$d=Od.__colorArray,_d=Od.colorsNeedUpdate,ae=Od.__webglCustomAttributesList,be=void 0,ce=void 0,de=void 0,ee=void 0,fe=void 0,ge=void 0;if(Od.verticesNeedUpdate){for(Qd=0;Qd<Xd;Qd++)Sd=Vd[Qd],Td=Qd*3,Zd[Td]=Sd.x,Zd[Td+1]=Sd.y,Zd[Td+2]=Sd.z;J.bindBuffer(J.ARRAY_BUFFER,Od.__webglVertexBuffer),J.bufferData(J.ARRAY_BUFFER,Zd,Pd)}if(_d){for(Rd=0;Rd<Yd;Rd++)Ud=Wd[Rd],Td=Rd*3,$d[Td]=Ud.r,$d[Td+1]=Ud.g,$d[Td+2]=Ud.b;J.bindBuffer(J.ARRAY_BUFFER,Od.__webglColorBuffer),J.bufferData(J.ARRAY_BUFFER,$d,Pd)}if(ae){be=0;for(ce=ae.length;be<ce;be++){ge=ae[be];if(ge.needsUpdate&&(ge.boundTo===void 0||ge.boundTo==="vertices")){Td=0,ee=ge.value.length;if(ge.size===1)for(de=0;de<ee;de++)ge.array[de]=ge.value[de];else if(ge.size===2)for(de=0;de<ee;de++)fe=ge.value[de],ge.array[Td]=fe.x,ge.array[Td+1]=fe.y,Td+=2;else if(ge.size===3)if(ge.type==="c")for(de=0;de<ee;de++)fe=ge.value[de],ge.array[Td]=fe.r,ge.array[Td+1]=fe.g,ge.array[Td+2]=fe.b,Td+=3;else for(de=0;de<ee;de++)fe=ge.value[de],ge.array[Td]=fe.x,ge.array[Td+1]=fe.y,ge.array[Td+2]=fe.z,Td+=3;else if(ge.size===4)for(de=0;de<ee;de++)fe=ge.value[de],ge.array[Td]=fe.x,ge.array[Td+1]=fe.y,ge.array[Td+2]=fe.z,ge.array[Td+3]=fe.w,Td+=4;J.bindBuffer(J.ARRAY_BUFFER,ge.buffer),J.bufferData(J.ARRAY_BUFFER,ge.array,Pd)}}}}qb.verticesNeedUpdate=!1,qb.colorsNeedUpdate=!1,tb.attributes&&n(tb)}else pb instanceof a.ParticleSystem&&(tb=d(pb,rb),sb=tb.attributes&&m(tb),(qb.verticesNeedUpdate||qb.colorsNeedUpdate||pb.sortParticles||sb)&&g(qb,J.DYNAMIC_DRAW,pb),qb.verticesNeedUpdate=!1,qb.colorsNeedUpdate=!1,tb.attributes&&n(tb))}},this.initMaterial=function(b,c,d,e){var f,g,h;b instanceof a.MeshDepthMaterial?h="depth":b instanceof a.MeshNormalMaterial?h="normal":b instanceof a.MeshBasicMaterial?h="basic":b instanceof a.MeshLambertMaterial?h="lambert":b instanceof a.MeshPhongMaterial?h="phong":b instanceof a.LineBasicMaterial?h="basic":b instanceof a.ParticleBasicMaterial&&(h="particle_basic");if(h){var i=a.ShaderLib[h];b.uniforms=a.UniformsUtils.clone(i.uniforms),b.vertexShader=i.vertexShader,b.fragmentShader=i.fragmentShader}var j,k,l,m,n;j=m=n=i=0;for(k=c.length;j<k;j++)l=c[j],l.onlyShadow||(l instanceof a.DirectionalLight&&m++,l instanceof a.PointLight&&n++,l instanceof a.SpotLight&&i++);n+i+m<=H?(k=m,l=n,m=i):(k=Math.ceil(H*m/(n+m)),m=l=H-k);var o=0,i=0;for(n=c.length;i<n;i++)j=c[i],j.castShadow&&(j instanceof a.SpotLight&&o++,j instanceof a.DirectionalLight&&!j.shadowCascade&&o++);var p=50;e!==void 0&&e instanceof a.SkinnedMesh&&(p=e.bones.length);var q;a:{n=b.fragmentShader,j=b.vertexShader;var i=b.uniforms,c=b.attributes,d={map:!!b.map,envMap:!!b.envMap,lightMap:!!b.lightMap,vertexColors:b.vertexColors,fog:d,useFog:b.fog,sizeAttenuation:b.sizeAttenuation,skinning:b.skinning,maxBones:p,morphTargets:b.morphTargets,morphNormals:b.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:k,maxPointLights:l,maxSpotLights:m,maxShadows:o,shadowMapEnabled:this.shadowMapEnabled&&e.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:b.alphaTest,metal:b.metal,perPixel:b.perPixel,wrapAround:b.wrapAround,doubleSided:e&&e.doubleSided},r,e=[];h?e.push(h):(e.push(n),e.push(j));for(r in d)e.push(r),e.push(d[r]);h=e.join(),r=0;for(e=K.length;r<e;r++)if(K[r].code===h){q=K[r].program;break a}r=J.createProgram(),e=["precision "+z+" float;",ob>0?"#define VERTEX_TEXTURES":"",I.gammaInput?"#define GAMMA_INPUT":"",I.gammaOutput?"#define GAMMA_OUTPUT":"",I.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_SHADOWS "+d.maxShadows,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.vertexColors?"#define USE_COLOR":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals?"#define USE_MORPHNORMALS":"",d.perPixel?"#define PHONG_PER_PIXEL":"",d.wrapAround?"#define WRAP_AROUND":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapSoft?"#define SHADOWMAP_SOFT":"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),k=["precision "+z+" float;","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_SHADOWS "+d.maxShadows,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"",I.gammaInput?"#define GAMMA_INPUT":"",I.gammaOutput?"#define GAMMA_OUTPUT":"",I.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fog instanceof a.FogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.vertexColors?"#define USE_COLOR":"",d.metal?"#define METAL":"",d.perPixel?"#define PHONG_PER_PIXEL":"",d.wrapAround?"#define WRAP_AROUND":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapSoft?"#define SHADOWMAP_SOFT":"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),J.attachShader(r,t("fragment",k+n)),J.attachShader(r,t("vertex",e+j)),J.linkProgram(r),J.getProgramParameter(r,J.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+J.getProgramParameter(r,J.VALIDATE_STATUS)+", gl error ["+J.getError()+"]"),r.uniforms={},r.attributes={};var s,e=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(s in i)e.push(s);s=e,e=0;for(i=s.length;e<i;e++)n=s[e],r.uniforms[n]=J.getUniformLocation(r,n);e=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(s=0;s<d.maxMorphTargets;s++)e.push("morphTarget"+s);for(s=0;s<d.maxMorphNormals;s++)e.push("morphNormal"+s);for(q in c)e.push(q);q=e,s=0;for(c=q.length;s<c;s++)d=q[s],r.attributes[d]=J.getAttribLocation(r,d);r.id=K.length,K.push({program:r,code:h}),I.info.memory.programs=K.length,q=r}b.program=q,q=b.program.attributes,q.position>=0&&J.enableVertexAttribArray(q.position),q.color>=0&&J.enableVertexAttribArray(q.color),q.normal>=0&&J.enableVertexAttribArray(q.normal),q.tangent>=0&&J.enableVertexAttribArray(q.tangent),b.skinning&&q.skinVertexA>=0&&q.skinVertexB>=0&&q.skinIndex>=0&&q.skinWeight>=0&&(J.enableVertexAttribArray(q.skinVertexA),J.enableVertexAttribArray(q.skinVertexB),J.enableVertexAttribArray(q.skinIndex),J.enableVertexAttribArray(q.skinWeight));if(b.attributes)for(g in b.attributes)q[g]!==void 0&&q[g]>=0&&J.enableVertexAttribArray(q[g]);if(b.morphTargets){b.numSupportedMorphTargets=0,r="morphTarget";for(g=0;g<this.maxMorphTargets;g++)s=r+g,q[s]>=0&&(J.enableVertexAttribArray(q[s]),b.numSupportedMorphTargets++)}if(b.morphNormals){b.numSupportedMorphNormals=0,r="morphNormal";for(g=0;g<this.maxMorphNormals;g++)s=r+g,q[s]>=0&&(J.enableVertexAttribArray(q[s]),b.numSupportedMorphNormals++)}b.uniformsList=[];for(f in b.uniforms)b.uniformsList.push([b.uniforms[f],f])},this.setFaceCulling=function(a,b){a?(!b||b==="ccw"?J.frontFace(J.CCW):J.frontFace(J.CW),a==="back"?J.cullFace(J.BACK):a==="front"?J.cullFace(J.FRONT):J.cullFace(J.FRONT_AND_BACK),J.enable(J.CULL_FACE)):J.disable(J.CULL_FACE)},this.setObjectFaces=function(a){R!==a.doubleSided&&(a.doubleSided?J.disable(J.CULL_FACE):J.enable(J.CULL_FACE),R=a.doubleSided),S!==a.flipSided&&(a.flipSided?J.frontFace(J.CW):J.frontFace(J.CCW),S=a.flipSided)},this.setDepthTest=function(a){X!==a&&(a?J.enable(J.DEPTH_TEST):J.disable(J.DEPTH_TEST),X=a)},this.setDepthWrite=function(a){Y!==a&&(J.depthMask(a),Y=a)},this.setBlending=function(b,c,d,e){if(b!==T){switch(b){case a.NoBlending:J.disable(J.BLEND);break;case a.AdditiveBlending:J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.SRC_ALPHA,J.ONE);break;case a.SubtractiveBlending:J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.ZERO,J.ONE_MINUS_SRC_COLOR);break;case a.MultiplyBlending:J.enable(J.BLEND),J.blendEquation(J.FUNC_ADD),J.blendFunc(J.ZERO,J.SRC_COLOR);break;case a.CustomBlending:J.enable(J.BLEND);break;default:J.enable(J.BLEND),J.blendEquationSeparate(J.FUNC_ADD,J.FUNC_ADD),J.blendFuncSeparate(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA,J.ONE,J.ONE_MINUS_SRC_ALPHA)}T=b}if(b===a.CustomBlending){c!==U&&(J.blendEquation(x(c)),U=c);if(d!==V||e!==W)J.blendFunc(x(d),x(e)),V=d,W=e}else W=V=U=null},this.setTexture=function(b,c){if(b.needsUpdate){b.__webglInit||(b.__webglInit=!0,b.__webglTexture=J.createTexture(),I.info.memory.textures++),J.activeTexture(J.TEXTURE0+c),J.bindTexture(J.TEXTURE_2D,b.__webglTexture),J.pixelStorei(J.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);var d=b.image,e=(d.width&d.width-1)===0&&(d.height&d.height-1)===0,f=x(b.format),g=x(b.type);u(J.TEXTURE_2D,b,e),b instanceof a.DataTexture?J.texImage2D(J.TEXTURE_2D,0,f,d.width,d.height,0,f,g,d.data):J.texImage2D(J.TEXTURE_2D,0,f,f,g,b.image),b.generateMipmaps&&e&&J.generateMipmap(J.TEXTURE_2D),b.needsUpdate=!1,b.onUpdate&&b.onUpdate()}else J.activeTexture(J.TEXTURE0+c),J.bindTexture(J.TEXTURE_2D,b.__webglTexture)},this.setRenderTarget=function(b){var c=b instanceof a.WebGLRenderTargetCube;if(b&&!b.__webglFramebuffer){b.depthBuffer===void 0&&(b.depthBuffer=!0),b.stencilBuffer===void 0&&(b.stencilBuffer=!0),b.__webglTexture=J.createTexture();var d=(b.width&b.width-1)===0&&(b.height&b.height-1)===0,e=x(b.format),f=x(b.type);if(c){b.__webglFramebuffer=[],b.__webglRenderbuffer=[],J.bindTexture(J.TEXTURE_CUBE_MAP,b.__webglTexture),u(J.TEXTURE_CUBE_MAP,b,d);for(var g=0;g<6;g++){b.__webglFramebuffer[g]=J.createFramebuffer(),b.__webglRenderbuffer[g]=J.createRenderbuffer(),J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,e,b.width,b.height,0,e,f,null);var h=b,i=J.TEXTURE_CUBE_MAP_POSITIVE_X+g;J.bindFramebuffer(J.FRAMEBUFFER,b.__webglFramebuffer[g]),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,i,h.__webglTexture,0),v(b.__webglRenderbuffer[g],b)}d&&J.generateMipmap(J.TEXTURE_CUBE_MAP)}else b.__webglFramebuffer=J.createFramebuffer(),b.__webglRenderbuffer=J.createRenderbuffer(),J.bindTexture(J.TEXTURE_2D,b.__webglTexture),u(J.TEXTURE_2D,b,d),J.texImage2D(J.TEXTURE_2D,0,e,b.width,b.height,0,e,f,null),e=J.TEXTURE_2D,J.bindFramebuffer(J.FRAMEBUFFER,b.__webglFramebuffer),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,e,b.__webglTexture,0),v(b.__webglRenderbuffer,b),d&&J.generateMipmap(J.TEXTURE_2D);c?J.bindTexture(J.TEXTURE_CUBE_MAP,null):J.bindTexture(J.TEXTURE_2D,null),J.bindRenderbuffer(J.RENDERBUFFER,null),J.bindFramebuffer(J.FRAMEBUFFER,null)}b?(c=c?b.__webglFramebuffer[b.activeCubeFace]:b.__webglFramebuffer,d=b.width,b=b.height,f=e=0):(c=null,d=db,b=eb,e=bb,f=cb),c!==M&&(J.bindFramebuffer(J.FRAMEBUFFER,c),J.viewport(e,f,d,b),M=c),fb=d,gb=b},this.shadowMapPlugin=new a.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new a.SpritePlugin),this.addPostPlugin(new a.LensFlarePlugin)},a.WebGLRenderTarget=function(b,c,d){this.width=b,this.height=c,d=d||{},this.wrapS=d.wrapS!==void 0?d.wrapS:a.ClampToEdgeWrapping,this.wrapT=d.wrapT!==void 0?d.wrapT:a.ClampToEdgeWrapping,this.magFilter=d.magFilter!==void 0?d.magFilter:a.LinearFilter,this.minFilter=d.minFilter!==void 0?d.minFilter:a.LinearMipMapLinearFilter,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.format=d.format!==void 0?d.format:a.RGBAFormat,this.type=d.type!==void 0?d.type:a.UnsignedByteType,this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0,this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!0,this.generateMipmaps=!0},a.WebGLRenderTarget.prototype.clone=function(){var b=new a.WebGLRenderTarget(this.width,this.height);return b.wrapS=this.wrapS,b.wrapT=this.wrapT,b.magFilter=this.magFilter,b.minFilter=this.minFilter,b.offset.copy(this.offset),b.repeat.copy(this.repeat),b.format=this.format,b.type=this.type,b.depthBuffer=this.depthBuffer,b.stencilBuffer=this.stencilBuffer,b},a.WebGLRenderTargetCube=function(b,c,d){a.WebGLRenderTarget.call(this,b,c,d),this.activeCubeFace=0},a.WebGLRenderTargetCube.prototype=new a.WebGLRenderTarget,a.WebGLRenderTargetCube.prototype.constructor=a.WebGLRenderTargetCube,a.RenderableVertex=function(){this.positionWorld=new a.Vector3,this.positionScreen=new a.Vector4,this.visible=!0},a.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},a.RenderableFace3=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},a.RenderableFace4=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.v4=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},a.RenderableObject=function(){this.z=this.object=null},a.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new a.Vector2,this.material=null},a.RenderableLine=function(){this.z=null,this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.material=null},a.ColorUtils={adjustHSV:function(b,c,d,e){var f=a.ColorUtils.__hsv;a.ColorUtils.rgbToHsv(b,f),f.h=a.Math.clamp(f.h+c,0,1),f.s=a.Math.clamp(f.s+d,0,1),f.v=a.Math.clamp(f.v+e,0,1),b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(a,b){var c=a.r,d=a.g,e=a.b,f=Math.max(Math.max(c,d),e),g=Math.min(Math.min(c,d),e);if(g===f)g=c=0;else{var h=f-g,g=h/f,c=(c===f?(d-e)/h:d===f?2+(e-c)/h:4+(c-d)/h)/6;c<0&&(c+=1),c>1&&(c-=1)}return b===void 0&&(b={h:0,s:0,v:0}),b.h=c,b.s=g,b.v=f,b}},a.ColorUtils.__hsv={h:0,s:0,v:0},a.GeometryUtils={merge:function(b,c){for(var d,e,f=b.vertices.length,g=c instanceof a.Mesh?c.geometry:c,h=b.vertices,i=g.vertices,j=b.faces,k=g.faces,l=b.faceVertexUvs[0],m=g.faceVertexUvs[0],n={},o=0;o<b.materials.length;o++)n[b.materials[o].id]=o;c instanceof a.Mesh&&(c.matrixAutoUpdate&&c.updateMatrix(),d=c.matrix,e=new a.Matrix4,e.extractRotation(d,c.scale));for(var o=0,p=i.length;o<p;o++){var q=i[o].clone();d&&d.multiplyVector3(q),h.push(q)}o=0;for(p=k.length;o<p;o++){var h=k[o],r,s,t=h.vertexNormals,u=h.vertexColors;h instanceof a.Face3?r=new a.Face3(h.a+f,h.b+f,h.c+f):h instanceof a.Face4&&(r=new a.Face4(h.a+f,h.b+f,h.c+f,h.d+f)),r.normal.copy(h.normal),e&&e.multiplyVector3(r.normal),i=0;for(q=t.length;i<q;i++)s=t[i].clone(),e&&e.multiplyVector3(s),r.vertexNormals.push(s);r.color.copy(h.color),i=0;for(q=u.length;i<q;i++)s=u[i],r.vertexColors.push(s.clone());h.materialIndex!==void 0&&(i=g.materials[h.materialIndex],q=i.id,u=n[q],u===void 0&&(u=b.materials.length,n[q]=u,b.materials.push(i)),r.materialIndex=u),r.centroid.copy(h.centroid),d&&d.multiplyVector3(r.centroid),j.push(r)}o=0;for(p=m.length;o<p;o++){d=m[o],e=[],i=0;for(q=d.length;i<q;i++)e.push(new a.UV(d[i].u,d[i].v));l.push(e)}},clone:function(b){var c=new a.Geometry,d,e=b.vertices,f=b.faces,g=b.faceVertexUvs[0];b.materials&&(c.materials=b.materials.slice()),b=0;for(d=e.length;b<d;b++)c.vertices.push(e[b].clone());b=0;for(d=f.length;b<d;b++)c.faces.push(f[b].clone());b=0;for(d=g.length;b<d;b++){for(var e=g[b],f=[],h=0,i=e.length;h<i;h++)f.push(new a.UV(e[h].u,e[h].v));c.faceVertexUvs[0].push(f)}return c},randomPointInTriangle:function(b,c,d){var e,f,g,h=new a.Vector3,i=a.GeometryUtils.__v1;return e=a.GeometryUtils.random(),f=a.GeometryUtils.random(),e+f>1&&(e=1-e,f=1-f),g=1-e-f,h.copy(b),h.multiplyScalar(e),i.copy(c),i.multiplyScalar(f),h.addSelf(i),i.copy(d),i.multiplyScalar(g),h.addSelf(i),h},randomPointInFace:function(b,c,d){var e,f,g;if(b instanceof a.Face3)return e=c.vertices[b.a],f=c.vertices[b.b],g=c.vertices[b.c],a.GeometryUtils.randomPointInTriangle(e,f,g);if(b instanceof a.Face4){e=c.vertices[b.a],f=c.vertices[b.b],g=c.vertices[b.c];var c=c.vertices[b.d],h;return d?b._area1&&b._area2?(d=b._area1,h=b._area2):(d=a.GeometryUtils.triangleArea(e,f,c),h=a.GeometryUtils.triangleArea(f,g,c),b._area1=d,b._area2=h):(d=a.GeometryUtils.triangleArea(e,f,c),h=a.GeometryUtils.triangleArea(f,g,c)),a.GeometryUtils.random()*(d+h)<d?a.GeometryUtils.randomPointInTriangle(e,f,c):a.GeometryUtils.randomPointInTriangle(f,g,c)}},randomPointsInGeometry:function(b,c){function d(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return k[e]>a?b(c,e-1):k[e]<a?b(e+1,d):e}return b(0,k.length-1)}var e,f,g=b.faces,h=b.vertices,i=g.length,j=0,k=[],l,m,n,o;for(f=0;f<i;f++)e=g[f],e instanceof a.Face3?(l=h[e.a],m=h[e.b],n=h[e.c],e._area=a.GeometryUtils.triangleArea(l,m,n)):e instanceof a.Face4&&(l=h[e.a],m=h[e.b],n=h[e.c],o=h[e.d],e._area1=a.GeometryUtils.triangleArea(l,m,o),e._area2=a.GeometryUtils.triangleArea(m,n,o),e._area=e._area1+e._area2),j+=e._area,k[f]=j;e=[];for(f=0;f<c;f++)h=a.GeometryUtils.random()*j,h=d(h),e[f]=a.GeometryUtils.randomPointInFace(g[h],b,!0);return e},triangleArea:function(b,c,d){var e,f=a.GeometryUtils.__v1;return f.sub(b,c),e=f.length(),f.sub(b,d),b=f.length(),f.sub(c,d),d=f.length(),c=.5*(e+b+d),Math.sqrt(c*(c-e)*(c-b)*(c-d))},center:function(b){b.computeBoundingBox();var c=b.boundingBox,d=new a.Vector3;return d.add(c.min,c.max),d.multiplyScalar(-0.5),b.applyMatrix((new a.Matrix4).makeTranslation(d.x,d.y,d.z)),b.computeBoundingBox(),d},normalizeUVs:function(a){for(var a=a.faceVertexUvs[0],b=0,c=a.length;b<c;b++)for(var d=a[b],e=0,f=d.length;e<f;e++)d[e].u!==1&&(d[e].u=d[e].u-Math.floor(d[e].u)),d[e].v!==1&&(d[e].v=d[e].v-Math.floor(d[e].v))},triangulateQuads:function(b){var c,d,e,f,g=[],h=[],i=[];c=0;for(d=b.faceUvs.length;c<d;c++)h[c]=[];c=0;for(d=b.faceVertexUvs.length;c<d;c++)i[c]=[];c=0;for(d=b.faces.length;c<d;c++){e=b.faces[c];if(e instanceof a.Face4){f=e.a;var j=e.b,k=e.c,l=e.d,m=new a.Face3,n=new a.Face3;m.color.copy(e.color),n.color.copy(e.color),m.materialIndex=e.materialIndex,n.materialIndex=e.materialIndex,m.a=f,m.b=j,m.c=l,n.a=j,n.b=k,n.c=l,e.vertexColors.length===4&&(m.vertexColors[0]=e.vertexColors[0].clone(),m.vertexColors[1]=e.vertexColors[1].clone(),m.vertexColors[2]=e.vertexColors[3].clone(),n.vertexColors[0]=e.vertexColors[1].clone(),n.vertexColors[1]=e.vertexColors[2].clone(),n.vertexColors[2]=e.vertexColors[3].clone()),g.push(m,n),e=0;for(f=b.faceVertexUvs.length;e<f;e++)b.faceVertexUvs[e].length&&(m=b.faceVertexUvs[e][c],j=m[1],k=m[2],l=m[3],m=[m[0].clone(),j.clone(),l.clone()],j=[j.clone(),k.clone(),l.clone()],i[e].push(m,j));e=0;for(f=b.faceUvs.length;e<f;e++)b.faceUvs[e].length&&(j=b.faceUvs[e][c],h[e].push(j,j))}else{g.push(e),e=0;for(f=b.faceUvs.length;e<f;e++)h[e].push(b.faceUvs[e]);e=0;for(f=b.faceVertexUvs.length;e<f;e++)i[e].push(b.faceVertexUvs[e])}}b.faces=g,b.faceUvs=h,b.faceVertexUvs=i,b.computeCentroids(),b.computeFaceNormals(),b.computeVertexNormals(),b.hasTangents&&b.computeTangents()},explode:function(b){for(var c=[],d=0,e=b.faces.length;d<e;d++){var f=c.length,g=b.faces[d];if(g instanceof a.Face4){var h=g.a,i=g.b,j=g.c,h=b.vertices[h],i=b.vertices[i],j=b.vertices[j],k=b.vertices[g.d];c.push(h.clone()),c.push(i.clone()),c.push(j.clone()),c.push(k.clone()),g.a=f,g.b=f+1,g.c=f+2,g.d=f+3}else h=g.a,i=g.b,j=g.c,h=b.vertices[h],i=b.vertices[i],j=b.vertices[j],c.push(h.clone()),c.push(i.clone()),c.push(j.clone()),g.a=f,g.b=f+1,g.c=f+2}b.vertices=c,delete b.__tmpVertices},tessellate:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[],x=[];d=0;for(e=b.faceVertexUvs.length;d<e;d++)x[d]=[];d=0;for(e=b.faces.length;d<e;d++){f=b.faces[d];if(f instanceof a.Face3){g=f.a,h=f.b,i=f.c,k=b.vertices[g],l=b.vertices[h],m=b.vertices[i],o=k.distanceTo(l),p=l.distanceTo(m),n=k.distanceTo(m);if(o>c||p>c||n>c){j=b.vertices.length,u=f.clone(),v=f.clone(),o>=p&&o>=n?(k=k.clone(),k.lerpSelf(l,.5),u.a=g,u.b=j,u.c=i,v.a=j,v.b=h,v.c=i,f.vertexNormals.length===3&&(g=f.vertexNormals[0].clone(),g.lerpSelf(f.vertexNormals[1],.5),u.vertexNormals[1].copy(g),v.vertexNormals[0].copy(g)),f.vertexColors.length===3&&(g=f.vertexColors[0].clone(),g.lerpSelf(f.vertexColors[1],.5),u.vertexColors[1].copy(g),v.vertexColors[0].copy(g)),f=0):p>=o&&p>=n?(k=l.clone(),k.lerpSelf(m,.5),u.a=g,u.b=h,u.c=j,v.a=j,v.b=i,v.c=g,f.vertexNormals.length===3&&(g=f.vertexNormals[1].clone(),g.lerpSelf(f.vertexNormals[2],.5),u.vertexNormals[2].copy(g),v.vertexNormals[0].copy(g),v.vertexNormals[1].copy(f.vertexNormals[2]),v.vertexNormals[2].copy(f.vertexNormals[0])),f.vertexColors.length===3&&(g=f.vertexColors[1].clone(),g.lerpSelf(f.vertexColors[2],.5),u.vertexColors[2].copy(g),v.vertexColors[0].copy(g),v.vertexColors[1].copy(f.vertexColors[2]),v.vertexColors[2].copy(f.vertexColors[0])),f=1):(k=k.clone(),k.lerpSelf(m,.5),u.a=g,u.b=h,u.c=j,v.a=j,v.b=h,v.c=i,f.vertexNormals.length===3&&(g=f.vertexNormals[0].clone(),g.lerpSelf(f.vertexNormals[2],.5),u.vertexNormals[2].copy(g),v.vertexNormals[0].copy(g)),f.vertexColors.length===3&&(g=f.vertexColors[0].clone(),g.lerpSelf(f.vertexColors[2],.5),u.vertexColors[2].copy(g),v.vertexColors[0].copy(g)),f=2),w.push(u,v),b.vertices.push(k),g=0;for(h=b.faceVertexUvs.length;g<h;g++)b.faceVertexUvs[g].length&&(k=b.faceVertexUvs[g][d],v=k[0],i=k[1],u=k[2],f===0?(l=v.clone(),l.lerpSelf(i,.5),k=[v.clone(),l.clone(),u.clone()],i=[l.clone(),i.clone(),u.clone()]):f===1?(l=i.clone(),l.lerpSelf(u,.5),k=[v.clone(),i.clone(),l.clone()],i=[l.clone(),u.clone(),v.clone()]):(l=v.clone(),l.lerpSelf(u,.5),k=[v.clone(),i.clone(),l.clone()],i=[l.clone(),i.clone(),u.clone()]),x[g].push(k,i))}else{w.push(f),g=0;for(h=b.faceVertexUvs.length;g<h;g++)x[g].push(b.faceVertexUvs[g][d])}}else{g=f.a,h=f.b,i=f.c,j=f.d,k=b.vertices[g],l=b.vertices[h],m=b.vertices[i],n=b.vertices[j],o=k.distanceTo(l),p=l.distanceTo(m),q=m.distanceTo(n),r=k.distanceTo(n);if(o>c||p>c||q>c||r>c){s=b.vertices.length,t=b.vertices.length+1,u=f.clone(),v=f.clone(),o>=p&&o>=q&&o>=r||q>=p&&q>=o&&q>=r?(o=k.clone(),o.lerpSelf(l,.5),l=m.clone(),l.lerpSelf(n,.5),u.a=g,u.b=s,u.c=t,u.d=j,v.a=s,v.b=h,v.c=i,v.d=t,f.vertexNormals.length===4&&(g=f.vertexNormals[0].clone(),g.lerpSelf(f.vertexNormals[1],.5),h=f.vertexNormals[2].clone(),h.lerpSelf(f.vertexNormals[3],.5),u.vertexNormals[1].copy(g),u.vertexNormals[2].copy(h),v.vertexNormals[0].copy(g),v.vertexNormals[3].copy(h)),f.vertexColors.length===4&&(g=f.vertexColors[0].clone(),g.lerpSelf(f.vertexColors[1],.5),h=f.vertexColors[2].clone(),h.lerpSelf(f.vertexColors[3],.5),u.vertexColors[1].copy(g),u.vertexColors[2].copy(h),v.vertexColors[0].copy(g),v.vertexColors[3].copy(h)),f=0):(o=l.clone(),o.lerpSelf(m,.5),l=n.clone(),l.lerpSelf(k,.5),u.a=g,u.b=h,u.c=s,u.d=t,v.a=t,v.b=s,v.c=i,v.d=j,f.vertexNormals.length===4&&(g=f.vertexNormals[1].clone(),g.lerpSelf(f.vertexNormals[2],.5),h=f.vertexNormals[3].clone(),h.lerpSelf(f.vertexNormals[0],.5),u.vertexNormals[2].copy(g),u.vertexNormals[3].copy(h),v.vertexNormals[0].copy(h),v.vertexNormals[1].copy(g)),f.vertexColors.length===4&&(g=f.vertexColors[1].clone(),g.lerpSelf(f.vertexColors[2],.5),h=f.vertexColors[3].clone(),h.lerpSelf(f.vertexColors[0],.5),u.vertexColors[2].copy(g),u.vertexColors[3].copy(h),v.vertexColors[0].copy(h),v.vertexColors[1].copy(g)),f=1),w.push(u,v),b.vertices.push(o,l),g=0;for(h=b.faceVertexUvs.length;g<h;g++)b.faceVertexUvs[g].length&&(k=b.faceVertexUvs[g][d],v=k[0],i=k[1],u=k[2],k=k[3],f===0?(l=v.clone(),l.lerpSelf(i,.5),m=u.clone(),m.lerpSelf(k,.5),v=[v.clone(),l.clone(),m.clone(),k.clone()],i=[l.clone(),i.clone(),u.clone(),m.clone()]):(l=i.clone(),l.lerpSelf(u,.5),m=k.clone(),m.lerpSelf(v,.5),v=[v.clone(),i.clone(),l.clone(),m.clone()],i=[m.clone(),l.clone(),u.clone(),k.clone()]),x[g].push(v,i))}else{w.push(f),g=0;for(h=b.faceVertexUvs.length;g<h;g++)x[g].push(b.faceVertexUvs[g][d])}}}b.faces=w,b.faceVertexUvs=x}},a.GeometryUtils.random=a.Math.random16,a.GeometryUtils.__v1=new a.Vector3,a.ImageUtils={crossOrigin:"anonymous",loadTexture:function(b,c,d){var e=new Image,f=new a.Texture(e,c);return e.onload=function(){f.needsUpdate=!0,d&&d(this)},e.crossOrigin=this.crossOrigin,e.src=b,f},loadTextureCube:function(b,c,d){var e,f=[],g=new a.Texture(f,c),c=f.loadCount=0;for(e=b.length;c<e;++c)f[c]=new Image,f[c].onload=function(){f.loadCount=f.loadCount+1,f.loadCount===6&&(g.needsUpdate=!0),d&&d(this)},f[c].crossOrigin=this.crossOrigin,f[c].src=b[c];return g},getNormalMap:function(a,b){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]},b=b|1,d=a.width,e=a.height,f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0);for(var h=g.getImageData(0,0,d,e).data,i=g.createImageData(d,e),j=i.data,k=0;k<d;k++)for(var l=0;l<e;l++){var m=l-1<0?0:l-1,n=l+1>e-1?e-1:l+1,o=k-1<0?0:k-1,p=k+1>d-1?d-1:k+1,q=[],r=[0,0,h[(l*d+k)*4]/255*b];q.push([-1,0,h[(l*d+o)*4]/255*b]),q.push([-1,-1,h[(m*d+o)*4]/255*b]),q.push([0,-1,h[(m*d+k)*4]/255*b]),q.push([1,-1,h[(m*d+p)*4]/255*b]),q.push([1,0,h[(l*d+p)*4]/255*b]),q.push([1,1,h[(n*d+p)*4]/255*b]),q.push([0,1,h[(n*d+k)*4]/255*b]),q.push([-1,1,h[(n*d+o)*4]/255*b]),m=[],o=q.length;for(n=0;n<o;n++){var p=q[n],s=q[(n+1)%o],p=[p[0]-r[0],p[1]-r[1],p[2]-r[2]],s=[s[0]-r[0],s[1]-r[1],s[2]-r[2]];m.push(c([p[1]*s[2]-p[2]*s[1],p[2]*s[0]-p[0]*s[2],p[0]*s[1]-p[1]*s[0]]))}q=[0,0,0];for(n=0;n<m.length;n++)q[0]=q[0]+m[n][0],q[1]=q[1]+m[n][1],q[2]=q[2]+m[n][2];q[0]=q[0]/m.length,q[1]=q[1]/m.length,q[2]=q[2]/m.length,r=(l*d+k)*4,j[r]=(q[0]+1)/2*255|0,j[r+1]=(q[1]+.5)*255|0,j[r+2]=q[2]*255|0,j[r+3]=255}return g.putImageData(i,0,0),f},generateDataTexture:function(b,c,d){for(var e=b*c,f=new Uint8Array(3*e),g=Math.floor(d.r*255),h=Math.floor(d.g*255),d=Math.floor(d.b*255),i=0;i<e;i++)f[i*3]=g,f[i*3+1]=h,f[i*3+2]=d;return b=new a.DataTexture(f,b,c,a.RGBFormat),b.needsUpdate=!0,b}},a.SceneUtils={showHierarchy:function(b,c){a.SceneUtils.traverseHierarchy(b,function(a){a.visible=c})},traverseHierarchy:function(b,c){var d,e,f=b.children.length;for(e=0;e<f;e++)d=b.children[e],c(d),a.SceneUtils.traverseHierarchy(d,c)},createMultiMaterialObject:function(b,c){var d,e=c.length,f=new a.Object3D;for(d=0;d<e;d++){var g=new a.Mesh(b,c[d]);f.add(g)}return f},cloneObject:function(b){var c;b instanceof a.MorphAnimMesh?(c=new a.MorphAnimMesh(b.geometry,b.material),c.duration=b.duration,c.mirroredLoop=b.mirroredLoop,c.time=b.time,c.lastKeyframe=b.lastKeyframe,c.currentKeyframe=b.currentKeyframe,c.direction=b.direction,c.directionBackwards=b.directionBackwards):b instanceof a.SkinnedMesh?c=new a.SkinnedMesh(b.geometry,b.material):b instanceof a.Mesh?c=new a.Mesh(b.geometry,b.material):b instanceof a.Line?c=new a.Line(b.geometry,b.material,b.type):b instanceof a.Ribbon?c=new a.Ribbon(b.geometry,b.material):b instanceof a.ParticleSystem?(c=new a.ParticleSystem(b.geometry,b.material),c.sortParticles=b.sortParticles):b instanceof a.Particle?c=new a.Particle(b.material):b instanceof a.Sprite?(c=new a.Sprite({}),c.color.copy(b.color),c.map=b.map,c.blending=b.blending,c.useScreenCoordinates=b.useScreenCoordinates,c.mergeWith3D=b.mergeWith3D,c.affectedByDistance=b.affectedByDistance,c.scaleByViewport=b.scaleByViewport,c.alignment=b.alignment,c.rotation3d.copy(b.rotation3d),c.rotation=b.rotation,c.opacity=b.opacity,c.uvOffset.copy(b.uvOffset),c.uvScale.copy(b.uvScale)):b instanceof a.LOD?c=new a.LOD:b instanceof a.Object3D&&(c=new a.Object3D),c.name=b.name,c.parent=b.parent,c.up.copy(b.up),c.position.copy(b.position),c.rotation instanceof a.Vector3&&c.rotation.copy(b.rotation),c.eulerOrder=b.eulerOrder,c.scale.copy(b.scale),c.dynamic=b.dynamic,c.doubleSided=b.doubleSided,c.flipSided=b.flipSided,c.renderDepth=b.renderDepth,c.rotationAutoUpdate=b.rotationAutoUpdate,c.matrix.copy(b.matrix),c.matrixWorld.copy(b.matrixWorld),c.matrixRotationWorld.copy(b.matrixRotationWorld),c.matrixAutoUpdate=b.matrixAutoUpdate,c.matrixWorldNeedsUpdate=b.matrixWorldNeedsUpdate,c.quaternion.copy(b.quaternion),c.useQuaternion=b.useQuaternion,c.boundRadius=b.boundRadius,c.boundRadiusScale=b.boundRadiusScale,c.visible=b.visible,c.castShadow=b.castShadow,c.receiveShadow=b.receiveShadow,c.frustumCulled=b.frustumCulled;for(var d=0;d<b.children.length;d++){var e=a.SceneUtils.cloneObject(b.children[d]);c.children[d]=e,e.parent=c}if(b instanceof a.LOD)for(d=0;d<b.LODs.length;d++)c.LODs[d]={visibleAtDistance:b.LODs[d].visibleAtDistance,object3D:c.children[d]};return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(b,c,d){var e=new a.Matrix4;e.getInverse(d.matrixWorld),b.applyMatrix(e),c.remove(b),d.add(b)}},a.WebGLRenderer&&(a.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new a.Color(16777215)},uSpecularColor:{type:"c",value:new a.Color(1118481)},uAmbientColor:{type:"c",value:new a.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new a.Vector2(0,0)},uRepeat:{type:"v2",value:new a.Vector2(1,1)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",a.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",a.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),a.BufferGeometry=function(){this.id=a.GeometryCount++,this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null,this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.morphTargets=[]},a.BufferGeometry.prototype={constructor:a.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}},a.Curve=function(){},a.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},a.Curve.prototype.getPointAt=function(a){return this.getPoint(this.getUtoTmapping(a))},a.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},a.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},a.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},a.Curve.prototype.getLengths=function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b},a.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},a.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-1,i;g<=h;){d=Math.floor(g+(h-g)/2),i=c[d]-f;if(i<0)g=d+1;else{if(!(i>0)){h=d;break}h=d-1}}return d=h,c[d]==f?d/(e-1):(g=c[d],c=(d+(f-g)/(c[d+1]-g))/(e-1))},a.Curve.prototype.getNormalVector=function(b){return b=this.getTangent(b),new a.Vector2(-b.y,b.x)},a.Curve.prototype.getTangent=function(a){var b=a-1e-4,a=a+1e-4;return b<0&&(b=0),a>1&&(a=1),b=this.getPoint(b),this.getPoint(a).clone().subSelf(b).normalize()},a.Curve.prototype.getTangentAt=function(a){return this.getTangent(this.getUtoTmapping(a))},a.LineCurve=function(a,b){this.v1=a,this.v2=b},a.LineCurve.prototype=new a.Curve,a.LineCurve.prototype.constructor=a.LineCurve,a.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().subSelf(this.v1);return b.multiplyScalar(a).addSelf(this.v1),b},a.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},a.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},a.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},a.QuadraticBezierCurve.prototype=new a.Curve,a.QuadraticBezierCurve.prototype.constructor=a.QuadraticBezierCurve,a.QuadraticBezierCurve.prototype.getPoint=function(b){var c;return c=a.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x),b=a.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y),new a.Vector2(c,b)},a.QuadraticBezierCurve.prototype.getTangent=function(b){var c;return c=a.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x),b=a.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y),c=new a.Vector2(c,b),c.normalize(),c},a.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},a.CubicBezierCurve.prototype=new a.Curve,a.CubicBezierCurve.prototype.constructor=a.CubicBezierCurve,a.CubicBezierCurve.prototype.getPoint=function(b){var c;return c=a.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b=a.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new a.Vector2(c,b)},a.CubicBezierCurve.prototype.getTangent=function(b){var c;return c=a.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b=a.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y),c=new a.Vector2(c,b),c.normalize(),c},a.SplineCurve=function(a){this.points=a==void 0?[]:a},a.SplineCurve.prototype=new a.Curve,a.SplineCurve.prototype.constructor=a.SplineCurve,a.SplineCurve.prototype.getPoint=function(b){var c=new a.Vector2,d=[],e=this.points,f;return f=(e.length-1)*b,b=Math.floor(f),f-=b,d[0]=b==0?b:b-1,d[1]=b,d[2]=b>e.length-2?e.length-1:b+1,d[3]=b>e.length-3?e.length-1:b+2,c.x=a.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,f),c.y=a.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,f),c},a.ArcCurve=function(a,b,c,d,e,f){this.aX=a,this.aY=b,this.aRadius=c,this.aStartAngle=d,this.aEndAngle=e,this.aClockwise=f},a.ArcCurve.prototype=new a.Curve,a.ArcCurve.prototype.constructor=a.ArcCurve,a.ArcCurve.prototype.getPoint=function(b){var c=this.aEndAngle-this.aStartAngle;return this.aClockwise||(b=1-b),c=this.aStartAngle+b*c,b=this.aX+this.aRadius*Math.cos(c),c=this.aY+this.aRadius*Math.sin(c),new a.Vector2(b,c)},a.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){var a=(c-a)*.5,d=(d-b)*.5,f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}},a.Curve.create=function(b,c){return b.prototype=new a.Curve,b.prototype.constructor=b,b.prototype.getPoint=c,b},a.LineCurve3=a.Curve.create(function(a,b){this.v1=a,this.v2=b},function(b){var c=new a.Vector3;return c.sub(this.v2,this.v1),c.multiplyScalar(b),c.addSelf(this.v1),c}),a.QuadraticBezierCurve3=a.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(b){var c,d;return c=a.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x),d=a.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y),b=a.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z),new a.Vector3(c,d,b)}),a.CubicBezierCurve3=a.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(b){var c,d;return c=a.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=a.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b=a.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new a.Vector3(c,d,b)}),a.SplineCurve3=a.Curve.create(function(a){this.points=a==void 0?[]:a},function(b){var c=new a.Vector3,d=[],e=this.points,f,b=(e.length-1)*b;f=Math.floor(b),b-=f,d[0]=f==0?f:f-1,d[1]=f,d[2]=f>e.length-2?e.length-1:f+1,d[3]=f>e.length-3?e.length-1:f+2,f=e[d[0]];var g=e[d[1]],h=e[d[2]],d=e[d[3]];return c.x=a.Curve.Utils.interpolate(f.x,g.x,h.x,d.x,b),c.y=a.Curve.Utils.interpolate(f.y,g.y,h.y,d.y,b),c.z=a.Curve.Utils.interpolate(f.z,g.z,h.z,d.z,b),c}),a.ClosedSplineCurve3=a.Curve.create(function(a){this.points=a==void 0?[]:a},function(b){var c=new a.Vector3,d=[],e=this.points,f;return f=(e.length-0)*b,b=Math.floor(f),f-=b,b+=b>0?0:(Math.floor(Math.abs(b)/e.length)+1)*e.length,d[0]=(b-1)%e.length,d[1]=b%e.length,d[2]=(b+1)%e.length,d[3]=(b+2)%e.length,c.x=a.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,f),c.y=a.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,f),c.z=a.Curve.Utils.interpolate(e[d[0]].z,e[d[1]].z,e[d[2]].z,e[d[3]].z,f),c}),a.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},a.CurvePath.prototype=new a.Curve,a.CurvePath.prototype.constructor=a.CurvePath,a.CurvePath.prototype.add=function(a){this.curves.push(a)},a.CurvePath.prototype.checkConnection=function(){},a.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);b.equals(c)||this.curves.push(new a.LineCurve(c,b))},a.CurvePath.prototype.getPoint=function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],b=1-b/a.getLength(),a.getPointAt(b);a++}return null},a.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},a.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a=[],b=0,c,d=this.curves.length;for(c=0;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},a.CurvePath.prototype.getBoundingBox=function(){var b=this.getPoints(),c,d,e,f;c=d=Number.NEGATIVE_INFINITY,e=f=Number.POSITIVE_INFINITY;var g,h,i,j;j=new a.Vector2,h=0;for(i=b.length;h<i;h++)g=b[h],g.x>c?c=g.x:g.x<e&&(e=g.x),g.y>d?d=g.y:g.y<d&&(f=g.y),j.addSelf(g.x,g.y);return{minX:e,minY:f,maxX:c,maxY:d,centroid:j.divideScalar(i)}},a.CurvePath.prototype.createPointsGeometry=function(a){return this.createGeometry(this.getPoints(a,!0))},a.CurvePath.prototype.createSpacedPointsGeometry=function(a){return this.createGeometry(this.getSpacedPoints(a,!0))},a.CurvePath.prototype.createGeometry=function(b){for(var c=new a.Geometry,d=0;d<b.length;d++)c.vertices.push(new a.Vector3(b[d].x,b[d].y,0));return c},a.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},a.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a),d,e;b||(b=this.bends),d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c},a.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a),d,e;b||(b=this.bends),d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c},a.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox(),d,e,f,g,h,i;d=0;for(e=a.length;d<e;d++)f=a[d],g=f.x,h=f.y,i=g/c.maxX,i=b.getUtoTmapping(i,g),g=b.getPoint(i),h=b.getNormalVector(i).multiplyScalar(h),f.x=g.x+h.x,f.y=g.y+h.y;return a},a.EventTarget=function(){var a={};this.addEventListener=function(b,c){a[b]==void 0&&(a[b]=[]),a[b].indexOf(c)===-1&&a[b].push(c)},this.dispatchEvent=function(b){for(var c in a[b.type])a[b.type][c](b)},this.removeEventListener=function(b,c){var d=a[b].indexOf(c);d!==-1&&a[b].splice(d,1)}},a.Gyroscope=function(){a.Object3D.call(this)},a.Gyroscope.prototype=new a.Object3D,a.Gyroscope.prototype.constructor=a.Gyroscope,a.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},a.Gyroscope.prototype.translationWorld=new a.Vector3,a.Gyroscope.prototype.translationObject=new a.Vector3,a.Gyroscope.prototype.rotationWorld=new a.Quaternion,a.Gyroscope.prototype.rotationObject=new a.Quaternion,a.Gyroscope.prototype.scaleWorld=new a.Vector3,a.Gyroscope.prototype.scaleObject=new a.Vector3,a.Path=function(b){a.CurvePath.call(this),this.actions=[],b&&this.fromPoints(b)},a.Path.prototype=new a.CurvePath,a.Path.prototype.constructor=a.Path,a.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},a.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},a.Path.prototype.moveTo=function(b,c){var d=Array.prototype.slice.call(arguments);this.actions.push({action:a.PathActions.MOVE_TO,args:d})},a.Path.prototype.lineTo=function(b,c){var d=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args;this.curves.push(new a.LineCurve(new a.Vector2(e[e.length-2],e[e.length-1]),new a.Vector2(b,c))),this.actions.push({action:a.PathActions.LINE_TO,args:d})},a.Path.prototype.quadraticCurveTo=function(b,c,d,e){var f=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args;this.curves.push(new a.QuadraticBezierCurve(new a.Vector2(g[g.length-2],g[g.length-1]),new a.Vector2(b,c),new a.Vector2(d,e))),this.actions.push({action:a.PathActions.QUADRATIC_CURVE_TO,args:f})},a.Path.prototype.bezierCurveTo=function(b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args;this.curves.push(new a.CubicBezierCurve(new a.Vector2(i[i.length-2],i[i.length-1]),new a.Vector2(b,c),new a.Vector2(d,e),new a.Vector2(f,g))),this.actions.push({action:a.PathActions.BEZIER_CURVE_TO,args:h})},a.Path.prototype.splineThru=function(b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=[new a.Vector2(d[d.length-2],d[d.length-1])];Array.prototype.push.apply(d,b),this.curves.push(new a.SplineCurve(d)),this.actions.push({action:a.PathActions.CSPLINE_THRU,args:c})},a.Path.prototype.arc=function(b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1],i=new a.ArcCurve(i.x+b,i.y+c,d,e,f,g);this.curves.push(i),i=i.getPoint(g?1:0),h.push(i.x),h.push(i.y),this.actions.push({action:a.PathActions.ARC,args:h})},a.Path.prototype.absarc=function(b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=new a.ArcCurve(b,c,d,e,f,g);this.curves.push(i),i=i.getPoint(g?1:0),h.push(i.x),h.push(i.y),this.actions.push({action:a.PathActions.ARC,args:h})},a.Path.prototype.getSpacedPoints=function(a){a||(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));return b},a.Path.prototype.getPoints=function(b,c){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(b,c);var b=b||12,d=[],e,f,g,h,i,j,k,l,m,n,o,p,q;e=0;for(f=this.actions.length;e<f;e++){g=this.actions[e],h=g.action,g=g.args;switch(h){case a.PathActions.MOVE_TO:d.push(new a.Vector2(g[0],g[1]));break;case a.PathActions.LINE_TO:d.push(new a.Vector2(g[0],g[1]));break;case a.PathActions.QUADRATIC_CURVE_TO:i=g[2],j=g[3],m=g[0],n=g[1],d.length>0?(h=d[d.length-1],o=h.x,p=h.y):(h=this.actions[e-1].args,o=h[h.length-2],p=h[h.length-1]);for(g=1;g<=b;g++)q=g/b,h=a.Shape.Utils.b2(q,o,m,i),q=a.Shape.Utils.b2(q,p,n,j),d.push(new a.Vector2(h,q));break;case a.PathActions.BEZIER_CURVE_TO:i=g[4],j=g[5],m=g[0],n=g[1],k=g[2],l=g[3],d.length>0?(h=d[d.length-1],o=h.x,p=h.y):(h=this.actions[e-1].args,o=h[h.length-2],p=h[h.length-1]);for(g=1;g<=b;g++)q=g/b,h=a.Shape.Utils.b3(q,o,m,k,i),q=a.Shape.Utils.b3(q,p,n,l,j),d.push(new a.Vector2(h,q));break;case a.PathActions.CSPLINE_THRU:h=this.actions[e-1].args,q=[new a.Vector2(h[h.length-2],h[h.length-1])],h=b*g[0].length,q=q.concat(g[0]),q=new a.SplineCurve(q);for(g=1;g<=h;g++)d.push(q.getPointAt(g/h));break;case a.PathActions.ARC:i=g[0],j=g[1],k=g[2],m=g[3],n=!!g[5],l=g[4]-m,o=b*2;for(g=1;g<=o;g++)q=g/o,n||(q=1-q),q=m+q*l,h=i+k*Math.cos(q),q=j+k*Math.sin(q),d.push(new a.Vector2(h,q))}}return e=d[d.length-1],Math.abs(e.x-d[0].x)<1e-10&&Math.abs(e.y-d[0].y)<1e-10&&d.splice(d.length-1,1),c&&d.push(d[0]),d},a.Path.prototype.transform=function(a,b){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(b),a)},a.Path.prototype.nltransform=function(a,b,c,d,e,f){var g=this.getPoints(),h,i,j,k,l;h=0;for(i=g.length;h<i;h++)j=g[h],k=j.x,l=j.y,j.x=a*k+b*l+c,j.y=d*l+e*k+f;return g},a.Path.prototype.debug=function(b){var c=this.getBoundingBox();b||(b=document.createElement("canvas"),b.setAttribute("width",c.maxX+100),b.setAttribute("height",c.maxY+100),document.body.appendChild(b)),c=b.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.width,b.height),c.strokeStyle="black",c.beginPath();var d,e,f,b=0;for(d=this.actions.length;b<d;b++)e=this.actions[b],f=e.args,e=e.action,e!=a.PathActions.CSPLINE_THRU&&c[e].apply(c,f);c.stroke(),c.closePath(),c.strokeStyle="red",e=this.getPoints(),b=0;for(d=e.length;b<d;b++)f=e[b],c.beginPath(),c.arc(f.x,f.y,1.5,0,Math.PI*2,!1),c.stroke(),c.closePath()},a.Path.prototype.toShapes=function(){var b,c,d,e,f=[],g=new a.Path;b=0;for(c=this.actions.length;b<c;b++)d=this.actions[b],e=d.args,d=d.action,d==a.PathActions.MOVE_TO&&g.actions.length!=0&&(f.push(g),g=new a.Path),g[d].apply(g,e);g.actions.length!=0&&f.push(g);if(f.length==0)return[];var h;e=[],b=!a.Shape.Utils.isClockWise(f[0].getPoints());if(f.length==1)return g=f[0],h=new a.Shape,h.actions=g.actions,h.curves=g.curves,e.push(h),e;if(b){h=new a.Shape,b=0;for(c=f.length;b<c;b++)g=f[b],a.Shape.Utils.isClockWise(g.getPoints())?(h.actions=g.actions,h.curves=g.curves,e.push(h),h=new a.Shape):h.holes.push(g)}else{b=0;for(c=f.length;b<c;b++)g=f[b],a.Shape.Utils.isClockWise(g.getPoints())?(h&&e.push(h),h=new a.Shape,h.actions=g.actions,h.curves=g.curves):h.holes.push(g);e.push(h)}return e},a.Shape=function(){a.Path.apply(this,arguments),this.holes=[]},a.Shape.prototype=new a.Path,a.Shape.prototype.constructor=a.Path,a.Shape.prototype.extrude=function(b){return new a.ExtrudeGeometry(this,b)},a.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},a.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},a.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},a.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},a.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},a.Shape.Utils={removeHoles:function(b,c){var d=b.concat(),e=d.concat(),f,g,h,i,j,k,l,m,n,o,p=[];for(j=0;j<c.length;j++){k=c[j],Array.prototype.push.apply(e,k),g=Number.POSITIVE_INFINITY;for(f=0;f<k.length;f++){n=k[f],o=[];for(m=0;m<d.length;m++)l=d[m],l=n.distanceToSquared(l),o.push(l),l<g&&(g=l,h=f,i=m)}f=i-1>=0?i-1:d.length-1,g=h-1>=0?h-1:k.length-1;var q=[k[h],d[i],d[f]];m=a.FontUtils.Triangulate.area(q);var r=[k[h],k[g],d[i]];n=a.FontUtils.Triangulate.area(r),o=i,l=h,i+=1,h+=-1,i<0&&(i+=d.length),i%=d.length,h<0&&(h+=k.length),h%=k.length,f=i-1>=0?i-1:d.length-1,g=h-1>=0?h-1:k.length-1,q=[k[h],d[i],d[f]],q=a.FontUtils.Triangulate.area(q),r=[k[h],k[g],d[i]],r=a.FontUtils.Triangulate.area(r),m+n>q+r&&(i=o,h=l,i<0&&(i+=d.length),i%=d.length,h<0&&(h+=k.length),h%=k.length,f=i-1>=0?i-1:d.length-1,g=h-1>=0?h-1:k.length-1),m=d.slice(0,i),n=d.slice(i),o=k.slice(h),l=k.slice(0,h),g=[k[h],k[g],d[i]],p.push([k[h],d[i],d[f]]),p.push(g),d=m.concat(o).concat(l).concat(n)}return{shape:d,isolatedPts:p,allpoints:e}},triangulateShape:function(b,c){var d=a.Shape.Utils.removeHoles(b,c),e=d.allpoints,f=d.isolatedPts,d=a.FontUtils.Triangulate(d.shape,!1),g,h,i,j,k={};g=0;for(h=e.length;g<h;g++)j=e[g].x+":"+e[g].y,k[j]!==void 0&&console.log("Duplicate point",j),k[j]=g;g=0;for(h=d.length;g<h;g++){i=d[g];for(e=0;e<3;e++)j=i[e].x+":"+i[e].y,j=k[j],j!==void 0&&(i[e]=j)}g=0;for(h=f.length;g<h;g++){i=f[g];for(e=0;e<3;e++)j=i[e].x+":"+i[e].y,j=k[j],j!==void 0&&(i[e]=j)}return d.concat(f)},isClockWise:function(b){return a.FontUtils.Triangulate.area(b)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},a.TextPath=function(b,c){a.Path.call(this),this.parameters=c||{},this.set(b)},a.TextPath.prototype.set=function(b,c){c=c||this.parameters,this.text=b;var d=c.curveSegments!==void 0?c.curveSegments:4,e=c.font!==void 0?c.font:"helvetiker",f=c.weight!==void 0?c.weight:"normal",g=c.style!==void 0?c.style:"normal";a.FontUtils.size=c.size!==void 0?c.size:100,a.FontUtils.divisions=d,a.FontUtils.face=e,a.FontUtils.weight=f,a.FontUtils.style=g},a.TextPath.prototype.toShapes=function(){for(var b=a.FontUtils.drawText(this.text).paths,c=[],d=0,e=b.length;d<e;d++)Array.prototype.push.apply(c,b[d].toShapes());return c},a.AnimationHandler=function(){var b=[],c={},d={update:function(a){for(var c=0;c<b.length;c++)b[c].update(a)},addToUpdate:function(a){b.indexOf(a)===-1&&b.push(a)},removeFromUpdate:function(a){a=b.indexOf(a),a!==-1&&b.splice(a,1)},add:function(b){c[b.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+b.name+" already exists in library. Overwriting."),c[b.name]=b;if(b.initialized!==!0){for(var d=0;d<b.hierarchy.length;d++){for(var e=0;e<b.hierarchy[d].keys.length;e++){b.hierarchy[d].keys[e].time<0&&(b.hierarchy[d].keys[e].time=0);if(b.hierarchy[d].keys[e].rot!==void 0&&!(b.hierarchy[d].keys[e].rot instanceof a.Quaternion)){var f=b.hierarchy[d].keys[e].rot;b.hierarchy[d].keys[e].rot=new a.Quaternion(f[0],f[1],f[2],f[3])}}if(b.hierarchy[d].keys.length&&b.hierarchy[d].keys[0].morphTargets!==void 0){f={};for(e=0;e<b.hierarchy[d].keys.length;e++)for(var g=0;g<b.hierarchy[d].keys[e].morphTargets.length;g++){var h=b.hierarchy[d].keys[e].morphTargets[g];f[h]=-1}b.hierarchy[d].usedMorphTargets=f;for(e=0;e<b.hierarchy[d].keys.length;e++){var i={};for(h in f){for(g=0;g<b.hierarchy[d].keys[e].morphTargets.length;g++)if(b.hierarchy[d].keys[e].morphTargets[g]===h){i[h]=b.hierarchy[d].keys[e].morphTargetsInfluences[g];break}g===b.hierarchy[d].keys[e].morphTargets.length&&(i[h]=0)}b.hierarchy[d].keys[e].morphTargetsInfluences=i}}for(e=1;e<b.hierarchy[d].keys.length;e++)b.hierarchy[d].keys[e].time===b.hierarchy[d].keys[e-1].time&&(b.hierarchy[d].keys.splice(e,1),e--);for(e=0;e<b.hierarchy[d].keys.length;e++)b.hierarchy[d].keys[e].index=e}e=parseInt(b.length*b.fps,10),b.JIT={},b.JIT.hierarchy=[];for(d=0;d<b.hierarchy.length;d++)b.JIT.hierarchy.push(Array(e));b.initialized=!0}},get:function(a){if(typeof a=="string")return c[a]?c[a]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+a),null)},parse:function(b){var c=[];if(b instanceof a.SkinnedMesh)for(var d=0;d<b.bones.length;d++)c.push(b.bones[d]);else e(b,c);return c}},e=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)e(a.children[c],b)};return d.LINEAR=0,d.CATMULLROM=1,d.CATMULLROM_FORWARD=2,d}(),a.Animation=function(b,c,d,e){this.root=b,this.data=a.AnimationHandler.get(c),this.hierarchy=a.AnimationHandler.parse(b),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=d!==void 0?d:a.AnimationHandler.LINEAR,this.JITCompile=e!==void 0?e:!0,this.points=[],this.target=new a.Vector3},a.Animation.prototype.play=function(b,c){if(!this.isPlaying){this.isPlaying=!0,this.loop=b!==void 0?b:!0,this.currentTime=c!==void 0?c:0;var d,e=this.hierarchy.length,f;for(d=0;d<e;d++){f=this.hierarchy[d],this.interpolationType!==a.AnimationHandler.CATMULLROM_FORWARD&&(f.useQuaternion=!0),f.matrixAutoUpdate=!0,f.animationCache===void 0&&(f.animationCache={},f.animationCache.prevKey={pos:0,rot:0,scl:0},f.animationCache.nextKey={pos:0,rot:0,scl:0},f.animationCache.originalMatrix=f instanceof a.Bone?f.skinMatrix:f.matrix);var g=f.animationCache.prevKey;f=f.animationCache.nextKey,g.pos=this.data.hierarchy[d].keys[0],g.rot=this.data.hierarchy[d].keys[0],g.scl=this.data.hierarchy[d].keys[0],f.pos=this.getNextKeyWith("pos",d,1),f.rot=this.getNextKeyWith("rot",d,1),f.scl=this.getNextKeyWith("scl",d,1)}this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.Animation.prototype.pause=function(){this.isPaused?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,a.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)this.hierarchy[b].animationCache!==void 0&&(this.hierarchy[b]instanceof a.Bone?this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix:this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix,delete this.hierarchy[b].animationCache)},a.Animation.prototype.update=function(b){if(this.isPlaying){var c=["pos","rot","scl"],d,e,f,g,h,i,j,k,l=this.data.JIT.hierarchy,m,n;n=this.currentTime=this.currentTime+b*this.timeScale,m=this.currentTime=this.currentTime%this.data.length,k=parseInt(Math.min(m*this.data.fps,this.data.length*this.data.fps),10);for(var o=0,p=this.hierarchy.length;o<p;o++){b=this.hierarchy[o],j=b.animationCache;if(this.JITCompile&&l[o][k]!==void 0)b instanceof a.Bone?(b.skinMatrix=l[o][k],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=!1):(b.matrix=l[o][k],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(b instanceof a.Bone?b.skinMatrix=b.animationCache.originalMatrix:b.matrix=b.animationCache.originalMatrix);for(var q=0;q<3;q++){d=c[q],h=j.prevKey[d],i=j.nextKey[d];if(i.time<=n){if(m<n){if(!this.loop){this.stop();return}h=this.data.hierarchy[o].keys[0];for(i=this.getNextKeyWith(d,o,1);i.time<m;)h=i,i=this.getNextKeyWith(d,o,i.index+1)}else do h=i,i=this.getNextKeyWith(d,o,i.index+1);while(i.time<m);j.prevKey[d]=h,j.nextKey[d]=i}b.matrixAutoUpdate=!0,b.matrixWorldNeedsUpdate=!0,e=(m-h.time)/(i.time-h.time),f=h[d],g=i[d];if(e<0||e>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+o),e=e<0?0:1;if(d==="pos"){d=b.position;if(this.interpolationType===a.AnimationHandler.LINEAR)d.x=f[0]+(g[0]-f[0])*e,d.y=f[1]+(g[1]-f[1])*e,d.z=f[2]+(g[2]-f[2])*e;else if(this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",o,h.index-1).pos,this.points[1]=f,this.points[2]=g,this.points[3]=this.getNextKeyWith("pos",o,i.index+1).pos,e=e*.33+.33,f=this.interpolateCatmullRom(this.points,e),d.x=f[0],d.y=f[1],d.z=f[2],this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD&&(e=this.interpolateCatmullRom(this.points,e*1.01),this.target.set(e[0],e[1],e[2]),this.target.subSelf(d),this.target.y=0,this.target.normalize(),e=Math.atan2(this.target.x,this.target.z),b.rotation.set(0,e,0))}else d==="rot"?a.Quaternion.slerp(f,g,b.quaternion,e):d==="scl"&&(d=b.scale,d.x=f[0]+(g[0]-f[0])*e,d.y=f[1]+(g[1]-f[1])*e,d.z=f[2]+(g[2]-f[2])*e)}}}if(this.JITCompile&&l[0][k]===void 0){this.hierarchy[0].updateMatrixWorld(!0);for(o=0;o<this.hierarchy.length;o++)l[o][k]=this.hierarchy[o]instanceof a.Bone?this.hierarchy[o].skinMatrix.clone():this.hierarchy[o].matrix.clone()}}},a.Animation.prototype.interpolateCatmullRom=function(a,b){var c=[],d=[],e,f,g,h,i,j;return e=(a.length-1)*b,f=Math.floor(e),e-=f,c[0]=f===0?f:f-1,c[1]=f,c[2]=f>a.length-2?f:f+1,c[3]=f>a.length-3?f:f+2,f=a[c[0]],h=a[c[1]],i=a[c[2]],j=a[c[3]],c=e*e,g=e*c,d[0]=this.interpolate(f[0],h[0],i[0],j[0],e,c,g),d[1]=this.interpolate(f[1],h[1],i[1],j[1],e,c,g),d[2]=this.interpolate(f[2],h[2],i[2],j[2],e,c,g),d},a.Animation.prototype.interpolate=function(a,b,c,d,e,f,g){return a=(c-a)*.5,d=(d-b)*.5,(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b},a.Animation.prototype.getNextKeyWith=function(b,c,d){for(var e=this.data.hierarchy[c].keys,d=this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?d<e.length-1?d:e.length-1:d%e.length;d<e.length;d++)if(e[d][b]!==void 0)return e[d];return this.data.hierarchy[c].keys[0]},a.Animation.prototype.getPrevKeyWith=function(b,c,d){for(var e=this.data.hierarchy[c].keys,d=this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+e.length;d>=0;d--)if(e[d][b]!==void 0)return e[d];return this.data.hierarchy[c].keys[e.length-1]},a.KeyFrameAnimation=function(b,c,d){this.root=b,this.data=a.AnimationHandler.get(c),this.hierarchy=a.AnimationHandler.parse(b),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=d!==void 0?d:!0,b=0;for(c=this.hierarchy.length;b<c;b++){var d=this.data.hierarchy[b].sids,e=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&d){for(var f=0;f<d.length;f++){var g=d[f],h=this.getNextKeyWith(g,b,0);h&&h.apply(g)}e.matrixAutoUpdate=!1,this.data.hierarchy[b].node.updateMatrix(),e.matrixWorldNeedsUpdate=!0}}},a.KeyFrameAnimation.prototype.play=function(b,c){if(!this.isPlaying){this.isPlaying=!0,this.loop=b!==void 0?b:!0,this.currentTime=c!==void 0?c:0,this.startTimeMs=c,this.startTime=1e7,this.endTime=-this.startTime;var d,e=this.hierarchy.length,f,g;for(d=0;d<e;d++)f=this.hierarchy[d],g=this.data.hierarchy[d],f.useQuaternion=!0,g.animationCache===void 0&&(g.animationCache={},g.animationCache.prevKey=null,g.animationCache.nextKey=null,g.animationCache.originalMatrix=f instanceof a.Bone?f.skinMatrix:f.matrix),f=this.data.hierarchy[d].keys,f.length&&(g.animationCache.prevKey=f[0],g.animationCache.nextKey=f[1],this.startTime=Math.min(f[0].time,this.startTime),this.endTime=Math.max(f[f.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.KeyFrameAnimation.prototype.pause=function(){this.isPaused?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,a.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var c=this.hierarchy[b],d=this.data.hierarchy[b];if(d.animationCache!==void 0){var e=d.animationCache.originalMatrix;c instanceof a.Bone?(e.copy(c.skinMatrix),c.skinMatrix=e):(e.copy(c.matrix),c.matrix=e),delete d.animationCache}}},a.KeyFrameAnimation.prototype.update=function(b){if(this.isPlaying){var c,d,e,f,g=this.data.JIT.hierarchy,h,i,j;i=this.currentTime=this.currentTime+b*this.timeScale,h=this.currentTime=this.currentTime%this.data.length,h<this.startTimeMs&&(h=this.currentTime=this.startTimeMs+h),f=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);if((j=h<i)&&!this.loop){for(var b=0,k=this.hierarchy.length;b<k;b++){var l=this.data.hierarchy[b].keys,g=this.data.hierarchy[b].sids;e=l.length-1,f=this.hierarchy[b];if(l.length){for(l=0;l<g.length;l++)h=g[l],(i=this.getPrevKeyWith(h,b,e))&&i.apply(h);this.data.hierarchy[b].node.updateMatrix(),f.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(h<this.startTime)){b=0;for(k=this.hierarchy.length;b<k;b++){e=this.hierarchy[b],c=this.data.hierarchy[b];var l=c.keys,m=c.animationCache;if(this.JITCompile&&g[b][f]!==void 0)e instanceof a.Bone?(e.skinMatrix=g[b][f],e.matrixWorldNeedsUpdate=!1):(e.matrix=g[b][f],e.matrixWorldNeedsUpdate=!0);else if(l.length){this.JITCompile&&m&&(e instanceof a.Bone?e.skinMatrix=m.originalMatrix:e.matrix=m.originalMatrix),c=m.prevKey,d=m.nextKey;if(c&&d){if(d.time<=i){if(j&&this.loop){c=l[0];for(d=l[1];d.time<h;)c=d,d=l[c.index+1]}else if(!j)for(var n=l.length-1;d.time<h&&d.index!==n;)c=d,d=l[c.index+1];m.prevKey=c,m.nextKey=d}d.time>=h?c.interpolate(d,h):c.interpolate(d,d.time)}this.data.hierarchy[b].node.updateMatrix(),e.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&g[0][f]===void 0){this.hierarchy[0].updateMatrixWorld(!0);for(b=0;b<this.hierarchy.length;b++)g[b][f]=this.hierarchy[b]instanceof a.Bone?this.hierarchy[b].skinMatrix.clone():this.hierarchy[b].matrix.clone()}}}},a.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c%=b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]},a.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c=c>=0?c:c+b.length;c>=0;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]},a.CubeCamera=function(b,c,d){a.Object3D.call(this);var e=new a.PerspectiveCamera(90,1,b,c);e.up.set(0,-1,0),e.lookAt(new a.Vector3(1,0,0)),this.add(e);var f=new a.PerspectiveCamera(90,1,b,c);f.up.set(0,-1,0),f.lookAt(new a.Vector3(-1,0,0)),this.add(f);var g=new a.PerspectiveCamera(90,1,b,c);g.up.set(0,0,1),g.lookAt(new a.Vector3(0,1,0)),this.add(g);var h=new a.PerspectiveCamera(90,1,b,c);h.up.set(0,0,-1),h.lookAt(new a.Vector3(0,-1,0)),this.add(h);var i=new a.PerspectiveCamera(90,1,b,c);i.up.set(0,-1,0),i.lookAt(new a.Vector3(0,0,1)),this.add(i);var j=new a.PerspectiveCamera(90,1,b,c);j.up.set(0,-1,0),j.lookAt(new a.Vector3(0,0,-1)),this.add(j),this.renderTarget=new a.WebGLRenderTargetCube(d,d,{format:a.RGBFormat,magFilter:a.LinearFilter,minFilter:a.LinearFilter}),this.updateCubeMap=function(a,b){var c=this.renderTarget,d=c.generateMipmaps;c.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,e,c),c.activeCubeFace=1,a.render(b,f,c),c.activeCubeFace=2,a.render(b,g,c),c.activeCubeFace=3,a.render(b,h,c),c.activeCubeFace=4,a.render(b,i,c),c.generateMipmaps=d,c.activeCubeFace=5,a.render(b,j,c)}},a.CubeCamera.prototype=new a.Object3D,a.CubeCamera.prototype.constructor=a.CubeCamera,a.CombinedCamera=function(b,c,d,e,f,g,h){a.Camera.call(this),this.fov=d,this.left=-b/2,this.right=b/2,this.top=c/2,this.bottom=-c/2,this.cameraO=new a.OrthographicCamera(b/-2,b/2,c/2,c/-2,g,h),this.cameraP=new a.PerspectiveCamera(d,b/c,e,f),this.zoom=1,this.toPerspective()},a.CombinedCamera.prototype=new a.Camera,a.CombinedCamera.prototype.constructor=a.CombinedCamera,a.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},a.CombinedCamera.prototype.toOrthographic=function(){var a=this.cameraP.aspect,b=(this.cameraP.near+this.cameraP.far)/2,b=Math.tan(this.fov/2)*b,a=2*b*a/2,b=b/this.zoom,a=a/this.zoom;this.cameraO.left=-a,this.cameraO.right=a,this.cameraO.top=b,this.cameraO.bottom=-b,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},a.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},a.CombinedCamera.prototype.setFov=function(a){this.fov=a,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPersepectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},a.CombinedCamera.prototype.setLens=function(a,b){var c=2*Math.atan((b!==void 0?b:24)/(a*2))*(180/Math.PI);return this.setFov(c),c},a.CombinedCamera.prototype.setZoom=function(a){this.zoom=a,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.FirstPersonControls=function(b,c){function d(a,b){return function(){b.apply(a,arguments)}}this.object=b,this.target=new a.Vector3(0,0,0),this.domElement=c!==void 0?c:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(a){a.preventDefault(),a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(b){var c=0;if(!this.freeze){this.heightSpeed?(c=a.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=b*c*this.heightCoef):this.autoSpeedFactor=0,c=b*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(c+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(c),this.moveLeft&&this.object.translateX(-c),this.moveRight&&this.object.translateX(c),this.moveUp&&this.object.translateY(c),this.moveDown&&this.object.translateY(-c),b*=this.lookSpeed,this.activeLook||(b=0),this.lon=this.lon+this.mouseX*b,this.lookVertical&&(this.lat=this.lat-this.mouseY*b),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var c=this.target,d=this.object.position;c.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta),c.y=d.y+100*Math.cos(this.phi),c.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta),c=1,this.constrainVertical&&(c=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*b,this.lookVertical&&(this.lat=this.lat-this.mouseY*b*c),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=a.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),c=this.target,d=this.object.position,c.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta),c.y=d.y+100*Math.cos(this.phi),c.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(c)}},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousemove",d(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",d(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",d(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",d(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",d(this,this.onKeyUp),!1)},a.PathControls=function(b,c){function d(a){return(a*=2)<1?.5*a*a:-0.5*(--a*(a-2)-1)}function e(a,b){return function(){b.apply(a,arguments)}}function f(b,c,d,e){var f={name:d,fps:.6,length:e,hierarchy:[]},g,h=c.getControlPointsArray(),i=c.getLength(),j=h.length,k=0;g=j-1,c={parent:-1,keys:[]},c.keys[0]={time:0,pos:h[0],rot:[0,0,0,1],scl:[1,1,1]},c.keys[g]={time:e,pos:h[g],rot:[0,0,0,1],scl:[1,1,1]};for(g=1;g<j-1;g++)k=e*i.chunks[g]/i.total,c.keys[g]={time:k,pos:h[g]};return f.hierarchy[0]=c,a.AnimationHandler.add(f),new a.Animation(b,d,a.AnimationHandler.CATMULLROM_FORWARD,!1)}function g(b,c){var d,e,f=new a.Geometry;for(d=0;d<b.points.length*c;d++)e=d/(b.points.length*c),e=b.getPoint(e),f.vertices[d]=new a.Vector3(e.x,e.y,e.z);return f}this.object=b,this.domElement=c!==void 0?c:document,this.id="PathControls"+a.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new a.Object3D,this.debugDummy=new a.Object3D,this.animationParent=new a.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new a.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var h=Math.PI*2,i=Math.PI/180;this.update=function(b){var c;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*b),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*b),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*i,this.theta=this.lon*i,b=this.phi%h,this.phi=b>=0?b:b+h,c=this.verticalAngleMap.srcRange,b=this.verticalAngleMap.dstRange,c=a.Math.mapLinear(this.phi,c[0],c[1],b[0],b[1]);var e=b[1]-b[0];this.phi=d((c-b[0])/e)*e+b[0],c=this.horizontalAngleMap.srcRange,b=this.horizontalAngleMap.dstRange,c=a.Math.mapLinear(this.theta,c[0],c[1],b[0],b[1]),e=b[1]-b[0],this.theta=d((c-b[0])/e)*e+b[0],b=this.target.position,b.x=100*Math.sin(this.phi)*Math.cos(this.theta),b.y=100*Math.cos(this.phi),b.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){this.spline=new a.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var b=new a.MeshLambertMaterial({color:30719}),c=new a.MeshLambertMaterial({color:65280}),d=new a.CubeGeometry(10,10,20),h=new a.CubeGeometry(2,2,10);this.animationParent=new a.Mesh(d,b),b=new a.Mesh(h,c),b.position.set(0,10,0),this.animation=f(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(b)}else this.animation=f(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var b=this.debugPath,c=this.spline,h=g(c,10),d=g(c,10),i=new a.LineBasicMaterial({color:16711680,linewidth:3}),h=new a.Line(h,i),d=new a.ParticleSystem(d,new a.ParticleBasicMaterial({color:16755200,size:3}));h.scale.set(1,1,1),b.add(h),d.scale.set(1,1,1),b.add(d);for(var h=new a.SphereGeometry(1,16,8),i=new a.MeshBasicMaterial({color:65280}),j=0;j<c.points.length;j++)d=new a.Mesh(h,i),d.position.copy(c.points[j]),b.add(d)}this.domElement.addEventListener("mousemove",e(this,this.onMouseMove),!1)}},a.PathControlsIdCounter=0,a.FlyControls=function(b,c){function d(a,b){return function(){b.apply(a,arguments)}}this.object=b,this.domElement=c!==void 0?c:document,c&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new a.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new a.Vector3(0,0,0),this.rotationVector=new a.Vector3(0,0,0),this.handleEvent=function(a){typeof this[a.type]=="function"&&this[a.type](a)},this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(a.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(a){if(!this.dragToLook||this.mouseStatus>0){var b=this.getContainerDimensions(),c=b.size[0]/2,d=b.size[1]/2;this.moveState.yawLeft=-(a.pageX-b.offset[0]-c)/c,this.moveState.pitchDown=(a.pageY-b.offset[1]-d)/d,this.updateRotationVector()}},this.mouseup=function(a){a.preventDefault(),a.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(a){var b=a*this.movementSpeed,a=a*this.rollSpeed;this.object.translateX(this.moveVector.x*b),this.object.translateY(this.moveVector.y*b),this.object.translateZ(this.moveVector.z*b),this.tmpQuaternion.set(this.rotationVector.x*a,this.rotationVector.y*a,this.rotationVector.z*a,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-a+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",d(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",d(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",d(this,this.mouseup),!1),this.domElement.addEventListener("keydown",d(this,this.keydown),!1),this.domElement.addEventListener("keyup",d(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},a.RollControls=function(b,c){this.object=b,this.domElement=c!==void 0?c:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-0.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new a.Vector3(0,0,1),this.roll=0;var d=new a.Vector3,e=new a.Vector3,f=new a.Vector3,g=new a.Matrix4,h=!1,i=1,j=0,k=0,l=0,m=0,n=0,o=window.innerWidth/2,p=window.innerHeight/2;this.update=function(a){if(this.mouseLook){var b=a*this.lookSpeed;this.rotateHorizontally(b*m),this.rotateVertically(b*n)}b=a*this.movementSpeed,this.object.translateZ(-b*(j>0||this.autoForward&&!(j<0)?1:j)),this.object.translateX(b*k),this.object.translateY(b*l),h&&(this.roll=this.roll+this.rollSpeed*a*i),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),f.copy(this.forward),e.set(0,1,0),d.cross(e,f).normalize(),e.cross(f,d).normalize(),this.object.matrix.elements[0]=d.x,this.object.matrix.elements[4]=e.x,this.object.matrix.elements[8]=f.x,this.object.matrix.elements[1]=d.y,this.object.matrix.elements[5]=e.y,this.object.matrix.elements[9]=f.y,this.object.matrix.elements[2]=d.z,this.object.matrix.elements[6]=e.z,this.object.matrix.elements[10]=f.z,g.identity(),g.elements[0]=Math.cos(this.roll),g.elements[4]=-Math.sin(this.roll),g.elements[1]=Math.sin(this.roll),g.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(g),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(a){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*a,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*a,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*a},this.translateY=function(a){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*a,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*a,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*a},this.translateZ=function(a){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*a,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*a,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*a},this.rotateHorizontally=function(a){d.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),d.multiplyScalar(a),this.forward.subSelf(d),this.forward.normalize()},this.rotateVertically=function(a){e.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),e.multiplyScalar(a),this.forward.addSelf(e),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(a){m=(a.clientX-o)/window.innerWidth,n=(a.clientY-p)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(a){a.preventDefault(),a.stopPropagation();switch(a.button){case 0:j=1;break;case 2:j=-1}},!1),this.domElement.addEventListener("mouseup",function(a){a.preventDefault(),a.stopPropagation();switch(a.button){case 0:j=0;break;case 2:j=0}},!1),this.domElement.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 87:j=1;break;case 37:case 65:k=-1;break;case 40:case 83:j=-1;break;case 39:case 68:k=1;break;case 81:h=!0,i=1;break;case 69:h=!0,i=-1;break;case 82:l=1;break;case 70:l=-1}},!1),this.domElement.addEventListener("keyup",function(a){switch(a.keyCode){case 38:case 87:j=0;break;case 37:case 65:k=0;break;case 40:case 83:j=0;break;case 39:case 68:k=0;break;case 81:h=!1;break;case 69:h=!1;break;case 82:l=0;break;case 70:l=0}},!1)},a.TrackballControls=function(b,c){a.EventTarget.call(this);var d=this;this.object=b,this.domElement=c!==void 0?c:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new a.Vector3;var e=new a.Vector3,f=!1,g=-1,h=new a.Vector3,i=new a.Vector3,j=new a.Vector3,k=new a.Vector2,l=new a.Vector2,m=new a.Vector2,n=new a.Vector2,o={type:"change"};this.handleEvent=function(a){typeof this[a.type]=="function"&&this[a.type](a)},this.getMouseOnScreen=function(b,c){return new a.Vector2((b-d.screen.offsetLeft)/d.radius*.5,(c-d.screen.offsetTop)/d.radius*.5)},this.getMouseProjectionOnBall=function(b,c){var e=new a.Vector3((b-d.screen.width*.5-d.screen.offsetLeft)/d.radius,(d.screen.height*.5+d.screen.offsetTop-c)/d.radius,0),f=e.length();return f>1?e.normalize():e.z=Math.sqrt(1-f*f),h.copy(d.object.position).subSelf(d.target),f=d.object.up.clone().setLength(e.y),f.addSelf(d.object.up.clone().crossSelf(h).setLength(e.x)),f.addSelf(h.setLength(e.z)),f},this.rotateCamera=function(){var b=Math.acos(i.dot(j)/i.length()/j.length());if(b){var c=(new a.Vector3).cross(i,j).normalize(),e=new a.Quaternion,b=b*d.rotateSpeed;e.setFromAxisAngle(c,-b),e.multiplyVector3(h),e.multiplyVector3(d.object.up),e.multiplyVector3(j),d.staticMoving?i=j:(e.setFromAxisAngle(c,b*(d.dynamicDampingFactor-1)),e.multiplyVector3(i))}},this.zoomCamera=function(){var a=1+(l.y-k.y)*d.zoomSpeed;a!==1&&a>0&&(h.multiplyScalar(a),d.staticMoving?k=l:k.y=k.y+(l.y-k.y)*this.dynamicDampingFactor)},this.panCamera=function(){var a=n.clone().subSelf(m);if(a.lengthSq()){a.multiplyScalar(h.length()*d.panSpeed);var b=h.clone().crossSelf(d.object.up).setLength(a.x);b.addSelf(d.object.up.clone().setLength(a.y)),d.object.position.addSelf(b),d.target.addSelf(b),d.staticMoving?m=n:m.addSelf(a.sub(n,m).multiplyScalar(d.dynamicDampingFactor))}},this.checkDistances=function(){if(!d.noZoom||!d.noPan)d.object.position.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.setLength(d.maxDistance),h.lengthSq()<d.minDistance*d.minDistance&&d.object.position.add(d.target,h.setLength(d.minDistance))},this.update=function(){h.copy(d.object.position).subSelf(d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.add(d.target,h),d.checkDistances(),d.object.lookAt(d.target),e.distanceTo(d.object.position)>0&&(d.dispatchEvent(o),e.copy(d.object.position))},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(a){d.enabled&&(f&&(i=j=d.getMouseProjectionOnBall(a.clientX,a.clientY),k=l=d.getMouseOnScreen(a.clientX,a.clientY),m=n=d.getMouseOnScreen(a.clientX,a.clientY),f=!1),g!==-1&&(g===0&&!d.noRotate?j=d.getMouseProjectionOnBall(a.clientX,a.clientY):g===1&&!d.noZoom?l=d.getMouseOnScreen(a.clientX,a.clientY):g===2&&!d.noPan&&(n=d.getMouseOnScreen(a.clientX,a.clientY))))},!1),this.domElement.addEventListener("mousedown",function(a){d.enabled&&(a.preventDefault(),a.stopPropagation(),g===-1&&(g=a.button,g===0&&!d.noRotate?i=j=d.getMouseProjectionOnBall(a.clientX,a.clientY):g===1&&!d.noZoom?k=l=d.getMouseOnScreen(a.clientX,a.clientY):this.noPan||(m=n=d.getMouseOnScreen(a.clientX,a.clientY))))},!1),this.domElement.addEventListener("mouseup",function(a){d.enabled&&(a.preventDefault(),a.stopPropagation(),g=-1)},!1),window.addEventListener("keydown",function(a){d.enabled&&g===-1&&(a.keyCode===d.keys[0]&&!d.noRotate?g=0:a.keyCode===d.keys[1]&&!d.noZoom?g=1:a.keyCode===d.keys[2]&&!d.noPan&&(g=2),g!==-1&&(f=!0))},!1),window.addEventListener("keyup",function(){d.enabled&&g!==-1&&(g=-1)},!1)},a.CubeGeometry=function(b,c,d,e,f,g,h,i){function j(b,c,d,h,i,j,l,m){var n,o=e||1,p=f||1,q=i/2,r=j/2,s=k.vertices.length;if(b==="x"&&c==="y"||b==="y"&&c==="x")n="z";else if(b==="x"&&c==="z"||b==="z"&&c==="x")n="y",p=g||1;else if(b==="z"&&c==="y"||b==="y"&&c==="z")n="x",o=g||1;var t=o+1,u=p+1,v=i/o,w=j/p,x=new a.Vector3;x[n]=l>0?1:-1;for(i=0;i<u;i++)for(j=0;j<t;j++){var y=new a.Vector3;y[b]=(j*v-q)*d,y[c]=(i*w-r)*h,y[n]=l,k.vertices.push(y)}for(i=0;i<p;i++)for(j=0;j<o;j++)b=new a.Face4(j+t*i+s,j+t*(i+1)+s,j+1+t*(i+1)+s,j+1+t*i+s),b.normal.copy(x),b.vertexNormals.push(x.clone(),x.clone(),x.clone(),x.clone()),b.materialIndex=m,k.faces.push(b),k.faceVertexUvs[0].push([new a.UV(j/o,i/p),new a.UV(j/o,(i+1)/p),new a.UV((j+1)/o,(i+1)/p),new a.UV((j+1)/o,i/p)])}a.Geometry.call(this);var k=this,l=b/2,m=c/2,n=d/2,o,p,q,r,s,t;if(h!==void 0){if(h instanceof Array)this.materials=h;else{this.materials=[];for(o=0;o<6;o++)this.materials.push(h)}o=0,r=1,p=2,s=3,q=4,t=5}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(i!=void 0)for(var u in i)this.sides[u]!==void 0&&(this.sides[u]=i[u]);this.sides.px&&j("z","y",-1,-1,d,c,l,o),this.sides.nx&&j("z","y",1,-1,d,c,-l,r),this.sides.py&&j("x","z",1,1,b,d,m,p),this.sides.ny&&j("x","z",1,-1,b,d,-m,s),this.sides.pz&&j("x","y",1,-1,b,c,n,q),this.sides.nz&&j("x","y",-1,-1,b,c,-n,t),this.computeCentroids(),this.mergeVertices()},a.CubeGeometry.prototype=new a.Geometry,a.CubeGeometry.prototype.constructor=a.CubeGeometry,a.CylinderGeometry=function(b,c,d,e,f,g){a.Geometry.call(this);var b=b!==void 0?b:20,c=c!==void 0?c:20,d=d!==void 0?d:100,h=d/2,e=e||8,f=f||1,i,j,k=[],l=[];for(j=0;j<=f;j++){var m=[],n=[],o=j/f,p=o*(c-b)+b;for(i=0;i<=e;i++){var q=i/e,r=new a.Vector3;r.x=p*Math.sin(q*Math.PI*2),r.y=-o*d+h,r.z=p*Math.cos(q*Math.PI*2),this.vertices.push(r),m.push(this.vertices.length-1),n.push(new a.UV(q,o))}k.push(m),l.push(n)}d=(c-b)/d;for(i=0;i<e;i++){b!==0?(m=this.vertices[k[0][i]].clone(),n=this.vertices[k[0][i+1]].clone()):(m=this.vertices[k[1][i]].clone(),n=this.vertices[k[1][i+1]].clone()),m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*d).normalize(),n.setY(Math.sqrt(n.x*n.x+n.z*n.z)*d).normalize();for(j=0;j<f;j++){var o=k[j][i],p=k[j+1][i],q=k[j+1][i+1],r=k[j][i+1],s=m.clone(),t=m.clone(),u=n.clone(),v=n.clone(),w=l[j][i].clone(),x=l[j+1][i].clone(),y=l[j+1][i+1].clone(),z=l[j][i+1].clone();this.faces.push(new a.Face4(o,p,q,r,[s,t,u,v])),this.faceVertexUvs[0].push([w,x,y,z])}}if(!g&&b>0){this.vertices.push(new a.Vector3(0,h,0));for(i=0;i<e;i++)o=k[0][i],p=k[0][i+1],q=this.vertices.length-1,s=new a.Vector3(0,1,0),t=new a.Vector3(0,1,0),u=new a.Vector3(0,1,0),w=l[0][i].clone(),x=l[0][i+1].clone(),y=new a.UV(x.u,0),this.faces.push(new a.Face3(o,p,q,[s,t,u])),this.faceVertexUvs[0].push([w,x,y])}if(!g&&c>0){this.vertices.push(new a.Vector3(0,-h,0));for(i=0;i<e;i++)o=k[j][i+1],p=k[j][i],q=this.vertices.length-1,s=new a.Vector3(0,-1,0),t=new a.Vector3(0,-1,0),u=new a.Vector3(0,-1,0),w=l[j][i+1].clone(),x=l[j][i].clone(),y=new a.UV(x.u,1),this.faces.push(new a.Face3(o,p,q,[s,t,u])),this.faceVertexUvs[0].push([w,x,y])}this.computeCentroids(),this.computeFaceNormals()},a.CylinderGeometry.prototype=new a.Geometry,a.CylinderGeometry.prototype.constructor=a.CylinderGeometry,a.ExtrudeGeometry=function(b,c){typeof b!="undefined"&&(a.Geometry.call(this),b=b instanceof Array?b:[b],this.shapebb=b[b.length-1].getBoundingBox(),this.addShapeList(b,c),this.computeCentroids(),this.computeFaceNormals())},a.ExtrudeGeometry.prototype=new a.Geometry,a.ExtrudeGeometry.prototype.constructor=a.ExtrudeGeometry,a.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)},a.ExtrudeGeometry.prototype.addShape=function(b,c){function d(a,b,c){return b||console.log("die"),b.clone().multiplyScalar(c).addSelf(a)}function e(b,c,d){var e=a.ExtrudeGeometry.__v1,f=a.ExtrudeGeometry.__v2,g=a.ExtrudeGeometry.__v3,h=a.ExtrudeGeometry.__v4,i=a.ExtrudeGeometry.__v5,j=a.ExtrudeGeometry.__v6;return e.set(b.x-c.x,b.y-c.y),f.set(b.x-d.x,b.y-d.y),e=e.normalize(),f=f.normalize(),g.set(-e.y,e.x),h.set(f.y,-f.x),i.copy(b).addSelf(g),j.copy(b).addSelf(h),i.equals(j)?h.clone():(i.copy(c).addSelf(g),j.copy(d).addSelf(h),g=e.dot(h),h=j.subSelf(i).dot(h),g===0&&(console.log("Either infinite or no solutions!"),h===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),h/=g,h<0?(c=Math.atan2(c.y-b.y,c.x-b.x),b=Math.atan2(d.y-b.y,d.x-b.x),c>b&&(b+=Math.PI*2),d=(c+b)/2,b=-Math.cos(d),d=-Math.sin(d),new a.Vector2(b,d)):e.multiplyScalar(h).addSelf(i).subSelf(b).clone())}function f(d,e){var f,g;for(O=d.length;--O>=0;){f=O,g=O-1,g<0&&(g=d.length-1);for(var h=0,i=n+l*2,h=0;h<i;h++){var j=L*h,k=L*(h+1),m=e+f+j,j=e+g+j,o=e+g+k,k=e+f+k,p=d,q=h,r=i,m=m+C,j=j+C,o=o+C,k=k+C;B.faces.push(new a.Face4(m,j,o,k,null,null,t)),m=S.generateSideWallUV(B,b,p,c,m,j,o,k,q,r),B.faceVertexUvs[0].push(m)}}}function g(b,c,d){B.vertices.push(new a.Vector3(b,c,d))}function h(d,e,f,g){d+=C,e+=C,f+=C,B.faces.push(new a.Face3(d,e,f,null,null,s)),d=g?S.generateBottomUV(B,b,c,d,e,f):S.generateTopUV(B,b,c,d,e,f),B.faceVertexUvs[0].push(d)}var i=c.amount!==void 0?c.amount:100,j=c.bevelThickness!==void 0?c.bevelThickness:6,k=c.bevelSize!==void 0?c.bevelSize:j-2,l=c.bevelSegments!==void 0?c.bevelSegments:3,m=c.bevelEnabled!==void 0?c.bevelEnabled:!0,n=c.steps!==void 0?c.steps:1,o=c.bendPath,p=c.extrudePath,q,r=!1,s=c.material,t=c.extrudeMaterial,u,v,w,x;p&&(q=p.getSpacedPoints(n),r=!0,m=!1,u=new a.TubeGeometry.FrenetFrames(p,n,!1),v=new a.Vector3,w=new a.Vector3,x=new a.Vector3),m||(k=j=l=0);var y,z,A,B=this,C=this.vertices.length;o&&b.addWrapPath(o);var p=b.extractPoints(),o=p.shape,D=p.holes;if(p=!a.Shape.Utils.isClockWise(o)){o=o.reverse(),z=0;for(A=D.length;z<A;z++)y=D[z],a.Shape.Utils.isClockWise(y)&&(D[z]=y.reverse());p=!1}var E=a.Shape.Utils.triangulateShape(o,D),F=o;z=0;for(A=D.length;z<A;z++)y=D[z],o=o.concat(y);var G,H,I,J,K,L=o.length,M,N=E.length,p=[],O=0;I=F.length,G=I-1;for(H=O+1;O<I;O++,G++,H++)G===I&&(G=0),H===I&&(H=0),p[O]=e(F[O],F[G],F[H]);var P=[],Q,R=p.concat();z=0;for(A=D.length;z<A;z++){y=D[z],Q=[],O=0,I=y.length,G=I-1;for(H=O+1;O<I;O++,G++,H++)G===I&&(G=0),H===I&&(H=0),Q[O]=e(y[O],y[G],y[H]);P.push(Q),R=R.concat(Q)}for(G=0;G<l;G++){I=G/l,J=j*(1-I),H=k*Math.sin(I*Math.PI/2),O=0;for(I=F.length;O<I;O++)K=d(F[O],p[O],H),g(K.x,K.y,-J);z=0;for(A=D.length;z<A;z++){y=D[z],Q=P[z],O=0;for(I=y.length;O<I;O++)K=d(y[O],Q[O],H),g(K.x,K.y,-J)}}H=k;for(O=0;O<L;O++)K=m?d(o[O],R[O],H):o[O],r?(w.copy(u.normals[0]).multiplyScalar(K.x),v.copy(u.binormals[0]).multiplyScalar(K.y),x.copy(q[0]).addSelf(w).addSelf(v),g(x.x,x.y,x.z)):g(K.x,K.y,0);for(I=1;I<=n;I++)for(O=0;O<L;O++)K=m?d(o[O],R[O],H):o[O],r?(w.copy(u.normals[I]).multiplyScalar(K.x),v.copy(u.binormals[I]).multiplyScalar(K.y),x.copy(q[I]).addSelf(w).addSelf(v),g(x.x,x.y,x.z)):g(K.x,K.y,i/n*I);for(G=l-1;G>=0;G--){I=G/l,J=j*(1-I),H=k*Math.sin(I*Math.PI/2),O=0;for(I=F.length;O<I;O++)K=d(F[O],p[O],H),g(K.x,K.y,i+J);z=0;for(A=D.length;z<A;z++){y=D[z],Q=P[z],O=0;for(I=y.length;O<I;O++)K=d(y[O],Q[O],H),r?g(K.x,K.y+q[n-1].y,q[n-1].x+J):g(K.x,K.y,i+J)}}var S=a.ExtrudeGeometry.WorldUVGenerator;(function(){if(m){var a;a=L*0;for(O=0;O<N;O++)M=E[O],h(M[2]+a,M[1]+a,M[0]+a,!0);a=n+l*2,a=L*a;for(O=0;O<N;O++)M=E[O],h(M[0]+a,M[1]+a,M[2]+a,!1)}else{for(O=0;O<N;O++)M=E[O],h(M[2],M[1],M[0],!0);for(O=0;O<N;O++)M=E[O],h(M[0]+L*n,M[1]+L*n,M[2]+L*n,!1)}})(),function(){var a=0;f(F,a),a+=F.length,z=0;for(A=D.length;z<A;z++)y=D[z],f(y,a),a+=y.length}()},a.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(b,c,d,e,f,g){return c=b.vertices[f].x,f=b.vertices[f].y,d=b.vertices[g].x,g=b.vertices[g].y,[new a.UV(b.vertices[e].x,1-b.vertices[e].y),new a.UV(c,1-f),new a.UV(d,1-g)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(b,c,d,e,f,g,h,i){var c=b.vertices[f].x,d=b.vertices[f].y,f=b.vertices[f].z,e=b.vertices[g].x,j=b.vertices[g].y,g=b.vertices[g].z,k=b.vertices[h].x,l=b.vertices[h].y,h=b.vertices[h].z,m=b.vertices[i].x,n=b.vertices[i].y,b=b.vertices[i].z;return Math.abs(d-j)<.01?[new a.UV(c,f),new a.UV(e,g),new a.UV(k,h),new a.UV(m,b)]:[new a.UV(d,f),new a.UV(j,g),new a.UV(l,h),new a.UV(n,b)]}},a.ExtrudeGeometry.__v1=new a.Vector2,a.ExtrudeGeometry.__v2=new a.Vector2,a.ExtrudeGeometry.__v3=new a.Vector2,a.ExtrudeGeometry.__v4=new a.Vector2,a.ExtrudeGeometry.__v5=new a.Vector2,a.ExtrudeGeometry.__v6=new a.Vector2,a.LatheGeometry=function(b,c,d){a.Geometry.call(this);for(var c=c||12,d=d||2*Math.PI,e=[],f=(new a.Matrix4).makeRotationZ(d/c),g=0;g<b.length;g++)e[g]=b[g].clone(),this.vertices.push(e[g]);for(var h=c+1,d=0;d<h;d++)for(g=0;g<e.length;g++)e[g]=f.multiplyVector3(e[g].clone()),this.vertices.push(e[g]);for(d=0;d<c;d++){e=0;for(f=b.length;e<f-1;e++)this.faces.push(new a.Face4(d*f+e,(d+1)%h*f+e,(d+1)%h*f+(e+1)%f,d*f+(e+1)%f)),this.faceVertexUvs[0].push([new a.UV(1-d/c,e/f),new a.UV(1-(d+1)/c,e/f),new a.UV(1-(d+1)/c,(e+1)/f),new a.UV(1-d/c,(e+1)/f)])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.LatheGeometry.prototype=new a.Geometry,a.LatheGeometry.prototype.constructor=a.LatheGeometry,a.PlaneGeometry=function(b,c,d,e){a.Geometry.call(this);for(var f=b/2,g=c/2,d=d||1,e=e||1,h=d+1,i=e+1,j=b/d,k=c/e,l=new a.Vector3(0,1,0),b=0;b<i;b++)for(c=0;c<h;c++)this.vertices.push(new a.Vector3(c*j-f,0,b*k-g));for(b=0;b<e;b++)for(c=0;c<d;c++)f=new a.Face4(c+h*b,c+h*(b+1),c+1+h*(b+1),c+1+h*b),f.normal.copy(l),f.vertexNormals.push(l.clone(),l.clone(),l.clone(),l.clone()),this.faces.push(f),this.faceVertexUvs[0].push([new a.UV(c/d,b/e),new a.UV(c/d,(b+1)/e),new a.UV((c+1)/d,(b+1)/e),new a.UV((c+1)/d,b/e)]);this.computeCentroids()},a.PlaneGeometry.prototype=new a.Geometry,a.PlaneGeometry.prototype.constructor=a.PlaneGeometry,a.SphereGeometry=function(b,c,d,e,f,g,h){a.Geometry.call(this);var b=b||50,e=e!==void 0?e:0,f=f!==void 0?f:Math.PI*2,g=g!==void 0?g:0,h=h!==void 0?h:Math.PI,c=Math.max(3,Math.floor(c)||8),d=Math.max(2,Math.floor(d)||6),i,j,k=[],l=[];for(j=0;j<=d;j++){var m=[],n=[];for(i=0;i<=c;i++){var o=i/c,p=j/d,q=new a.Vector3;q.x=-b*Math.cos(e+o*f)*Math.sin(g+p*h),q.y=b*Math.cos(g+p*h),q.z=b*Math.sin(e+o*f)*Math.sin(g+p*h),this.vertices.push(q),m.push(this.vertices.length-1),n.push(new a.UV(o,p))}k.push(m),l.push(n)}for(j=0;j<d;j++)for(i=0;i<c;i++){var e=k[j][i+1],f=k[j][i],g=k[j+1][i],h=k[j+1][i+1],m=this.vertices[e].clone().normalize(),n=this.vertices[f].clone().normalize(),o=this.vertices[g].clone().normalize(),p=this.vertices[h].clone().normalize(),q=l[j][i+1].clone(),r=l[j][i].clone(),s=l[j+1][i].clone(),t=l[j+1][i+1].clone();Math.abs(this.vertices[e].y)==b?(this.faces.push(new a.Face3(e,g,h,[m,o,p])),this.faceVertexUvs[0].push([q,s,t])):Math.abs(this.vertices[g].y)==b?(this.faces.push(new a.Face3(e,f,g,[m,n,o])),this.faceVertexUvs[0].push([q,r,s])):(this.faces.push(new a.Face4(e,f,g,h,[m,n,o,p])),this.faceVertexUvs[0].push([q,r,s,t]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:b}},a.SphereGeometry.prototype=new a.Geometry,a.SphereGeometry.prototype.constructor=a.SphereGeometry,a.TextGeometry=function(b,c){var d=(new a.TextPath(b,c)).toShapes();c.amount=c.height!==void 0?c.height:50,c.bevelThickness===void 0&&(c.bevelThickness=10),c.bevelSize===void 0&&(c.bevelSize=8),c.bevelEnabled===void 0&&(c.bevelEnabled=!1);if(c.bend){var e=d[d.length-1].getBoundingBox().maxX;c.bendPath=new a.QuadraticBezierCurve(new a.Vector2(0,0),new a.Vector2(e/2,120),new a.Vector2(e,0))}a.ExtrudeGeometry.call(this,d,c)},a.TextGeometry.prototype=new a.ExtrudeGeometry,a.TextGeometry.prototype.constructor=a.TextGeometry,a.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase();return this.faces[b]=this.faces[b]||{},this.faces[b][a.cssFontWeight]=this.faces[b][a.cssFontWeight]||{},this.faces[b][a.cssFontWeight][a.cssFontStyle]=a,this.faces[b][a.cssFontWeight][a.cssFontStyle]=a},drawText:function(b){for(var c=this.getFace(),d=this.size/c.resolution,e=0,f=(""+b).split(""),g=f.length,h=[],b=0;b<g;b++){var i=new a.Path,i=this.extractGlyphPoints(f[b],c,d,e,i),e=e+i.offset;h.push(i.path)}return{paths:h,offset:e/2}},extractGlyphPoints:function(b,c,d,e,f){var g=[],h,i,j,k,l,m,n,o,p,q,r,s=c.glyphs[b]||c.glyphs["?"];if(s){if(s.o){c=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),k=c.length;for(b=0;b<k;){j=c[b++];switch(j){case"m":j=c[b++]*d+e,l=c[b++]*d,g.push(new a.Vector2(j,l)),f.moveTo(j,l);break;case"l":j=c[b++]*d+e,l=c[b++]*d,g.push(new a.Vector2(j,l)),f.lineTo(j,l);break;case"q":j=c[b++]*d+e,l=c[b++]*d,o=c[b++]*d+e,p=c[b++]*d,f.quadraticCurveTo(o,p,j,l);if(h=g[g.length-1]){m=h.x,n=h.y,h=1;for(i=this.divisions;h<=i;h++){var t=h/i,u=a.Shape.Utils.b2(t,m,o,j),t=a.Shape.Utils.b2(t,n,p,l);g.push(new a.Vector2(u,t))}}break;case"b":j=c[b++]*d+e,l=c[b++]*d,o=c[b++]*d+e,p=c[b++]*-d,q=c[b++]*d+e,r=c[b++]*-d,f.bezierCurveTo(j,l,o,p,q,r);if(h=g[g.length-1]){m=h.x,n=h.y,h=1;for(i=this.divisions;h<=i;h++)t=h/i,u=a.Shape.Utils.b3(t,m,o,q,j),t=a.Shape.Utils.b3(t,n,p,r,l),g.push(new a.Vector2(u,t))}}}}return{offset:s.ha*d,points:g,path:f}}}},function(a){var b=function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return c*.5};return a.Triangulate=function(a,c){var d=a.length;if(d<3)return null;var e=[],f=[],g=[],h,i,j;if(b(a)>0)for(i=0;i<d;i++)f[i]=i;else for(i=0;i<d;i++)f[i]=d-1-i;var k=2*d;for(i=d-1;d>2;){if(k--<=0){console.log("Warning, unable to triangulate polygon!");break}h=i,d<=h&&(h=0),i=h+1,d<=i&&(i=0),j=i+1,d<=j&&(j=0);var l;a:{l=a;var m=h,n=i,o=j,p=d,q=f,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,s=l[q[m]].x,t=l[q[m]].y,u=l[q[n]].x,v=l[q[n]].y,w=l[q[o]].x,x=l[q[o]].y;if(1e-10>(u-s)*(x-t)-(v-t)*(w-s))l=!1;else{for(r=0;r<p;r++)if(r!=m&&r!=n&&r!=o){var y=l[q[r]].x,z=l[q[r]].y,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0,A=C=E=void 0,A=w-u,B=x-v,C=s-w,D=t-x,E=u-s,F=v-t,G=y-s,H=z-t,I=y-u,J=z-v,K=y-w,L=z-x,A=A*J-B*I,E=E*H-F*G,C=C*L-D*K;if(A>=0&&C>=0&&E>=0){l=!1;break a}}l=!0}}if(l){e.push([a[f[h]],a[f[i]],a[f[j]]]),g.push([f[h],f[i],f[j]]),h=i;for(j=i+1;j<d;h++,j++)f[h]=f[j];d--,k=2*d}}return c?g:e},a.Triangulate.area=b,a}(a.FontUtils),self._typeface_js={faces:a.FontUtils.faces,loadFace:a.FontUtils.loadFace},a.TorusGeometry=function(b,c,d,e,f){a.Geometry.call(this),this.radius=b||100,this.tube=c||40,this.segmentsR=d||8,this.segmentsT=e||6,this.arc=f||Math.PI*2,f=new a.Vector3,b=[],c=[];for(d=0;d<=this.segmentsR;d++)for(e=0;e<=this.segmentsT;e++){var g=e/this.segmentsT*this.arc,h=d/this.segmentsR*Math.PI*2;f.x=this.radius*Math.cos(g),f.y=this.radius*Math.sin(g);var i=new a.Vector3;i.x=(this.radius+this.tube*Math.cos(h))*Math.cos(g),i.y=(this.radius+this.tube*Math.cos(h))*Math.sin(g),i.z=this.tube*Math.sin(h),this.vertices.push(i),b.push(new a.UV(e/this.segmentsT,1-d/this.segmentsR)),c.push(i.clone().subSelf(f).normalize())}for(d=1;d<=this.segmentsR;d++)for(e=1;e<=this.segmentsT;e++){var f=(this.segmentsT+1)*d+e-1,g=(this.segmentsT+1)*(d-1)+e-1,h=(this.segmentsT+1)*(d-1)+e,i=(this.segmentsT+1)*d+e,j=new a.Face4(f,g,h,i,[c[f],c[g],c[h],c[i]]);j.normal.addSelf(c[f]),j.normal.addSelf(c[g]),j.normal.addSelf(c[h]),j.normal.addSelf(c[i]),j.normal.normalize(),this.faces.push(j),this.faceVertexUvs[0].push([b[f].clone(),b[g].clone(),b[h].clone(),b[i].clone()])}this.computeCentroids()},a.TorusGeometry.prototype=new a.Geometry,a.TorusGeometry.prototype.constructor=a.TorusGeometry,a.TorusKnotGeometry=function(b,c,d,e,f,g,h){function i(b,c,d,e,f,g){var h=Math.cos(b);return Math.cos(c),c=Math.sin(b),b=d/e*b,d=Math.cos(b),h=f*(2+d)*.5*h,c=f*(2+d)*c*.5,f=g*f*Math.sin(b)*.5,new a.Vector3(h,c,f)}a.Geometry.call(this),this.radius=b||200,this.tube=c||40,this.segmentsR=d||64,this.segmentsT=e||8,this.p=f||2,this.q=g||3,this.heightScale=h||1,this.grid=Array(this.segmentsR),d=new a.Vector3,e=new a.Vector3,f=new a.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(c=0;c<this.segmentsT;++c){var j=b/this.segmentsR*2*this.p*Math.PI,h=c/this.segmentsT*2*Math.PI,g=i(j,h,this.q,this.p,this.radius,this.heightScale),j=i(j+.01,h,this.q,this.p,this.radius,this.heightScale);d.sub(j,g),e.add(j,g),f.cross(d,e),e.cross(f,d),f.normalize(),e.normalize(),j=-this.tube*Math.cos(h),h=this.tube*Math.sin(h),g.x=g.x+(j*e.x+h*f.x),g.y=g.y+(j*e.y+h*f.y),g.z=g.z+(j*e.z+h*f.z),this.grid[b][c]=this.vertices.push(new a.Vector3(g.x,g.y,g.z))-1}}for(b=0;b<this.segmentsR;++b)for(c=0;c<this.segmentsT;++c){var f=(b+1)%this.segmentsR,g=(c+1)%this.segmentsT,d=this.grid[b][c],e=this.grid[f][c],f=this.grid[f][g],g=this.grid[b][g],h=new a.UV(b/this.segmentsR,c/this.segmentsT),j=new a.UV((b+1)/this.segmentsR,c/this.segmentsT),k=new a.UV((b+1)/this.segmentsR,(c+1)/this.segmentsT),l=new a.UV(b/this.segmentsR,(c+1)/this.segmentsT);this.faces.push(new a.Face4(d,e,f,g)),this.faceVertexUvs[0].push([h,j,k,l])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TorusKnotGeometry.prototype=new a.Geometry,a.TorusKnotGeometry.prototype.constructor=a.TorusKnotGeometry,a.TubeGeometry=function(b,c,d,e,f,g){a.Geometry.call(this),this.path=b,this.segments=c||64,this.radius=d||1,this.segmentsRadius=e||8,this.closed=f||!1,g&&(this.debug=new a.Object3D),this.grid=[];var h,i,g=this.segments+1,j,k,l,m=new a.Vector3,n,o,p,c=new a.TubeGeometry.FrenetFrames(b,c,f);n=c.tangents,o=c.normals,p=c.binormals,this.tangents=n,this.normals=o,this.binormals=p;for(c=0;c<g;c++){this.grid[c]=[],e=c/(g-1),l=b.getPointAt(e),e=n[c],h=o[c],i=p[c],this.debug&&(this.debug.add(new a.ArrowHelper(e,l,d,255)),this.debug.add(new a.ArrowHelper(h,l,d,16711680)),this.debug.add(new a.ArrowHelper(i,l,d,65280)));for(e=0;e<this.segmentsRadius;e++)j=e/this.segmentsRadius*2*Math.PI,k=-this.radius*Math.cos(j),j=this.radius*Math.sin(j),m.copy(l),m.x=m.x+(k*h.x+j*i.x),m.y=m.y+(k*h.y+j*i.y),m.z=m.z+(k*h.z+j*i.z),this.grid[c][e]=this.vertices.push(new a.Vector3(m.x,m.y,m.z))-1}for(c=0;c<this.segments;c++)for(e=0;e<this.segmentsRadius;e++)g=f?(c+1)%this.segments:c+1,m=(e+1)%this.segmentsRadius,b=this.grid[c][e],d=this.grid[g][e],g=this.grid[g][m],m=this.grid[c][m],n=new a.UV(c/this.segments,e/this.segmentsRadius),o=new a.UV((c+1)/this.segments,e/this.segmentsRadius),p=new a.UV((c+1)/this.segments,(e+1)/this.segmentsRadius),h=new a.UV(c/this.segments,(e+1)/this.segmentsRadius),this.faces.push(new a.Face4(b,d,g,m)),this.faceVertexUvs[0].push([n,o,p,h]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TubeGeometry.prototype=new a.Geometry,a.TubeGeometry.prototype.constructor=a.TubeGeometry,a.TubeGeometry.FrenetFrames=function(b,c,d){new a.Vector3;var e=new a.Vector3;new a.Vector3;var f=[],g=[],h=[],i=new a.Vector3,j=new a.Matrix4,c=c+1,k,l,m;this.tangents=f,this.normals=g,this.binormals=h;for(k=0;k<c;k++)l=k/(c-1),f[k]=b.getTangentAt(l),f[k].normalize();g[0]=new a.Vector3,h[0]=new a.Vector3,b=Number.MAX_VALUE,k=Math.abs(f[0].x),l=Math.abs(f[0].y),m=Math.abs(f[0].z),k<=b&&(b=k,e.set(1,0,0)),l<=b&&(b=l,e.set(0,1,0)),m<=b&&e.set(0,0,1),i.cross(f[0],e).normalize(),g[0].cross(f[0],i),h[0].cross(f[0],g[0]);for(k=1;k<c;k++)g[k]=g[k-1].clone(),h[k]=h[k-1].clone(),i.cross(f[k-1],f[k]),i.length()>1e-4&&(i.normalize(),e=Math.acos(f[k-1].dot(f[k])),j.makeRotationAxis(i,e).multiplyVector3(g[k])),h[k].cross(f[k],g[k]);if(d){e=Math.acos(g[0].dot(g[c-1])),e/=c-1,f[0].dot(i.cross(g[0],g[c-1]))>0&&(e=-e);for(k=1;k<c;k++)j.makeRotationAxis(f[k],e*k).multiplyVector3(g[k]),h[k].cross(f[k],g[k])}},a.PolyhedronGeometry=function(b,c,d,e){function f(b){var c=b.normalize().clone();c.index=j.vertices.push(c)-1;var d=Math.atan2(b.z,-b.x)/2/Math.PI+.5,b=Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))/Math.PI+.5;return c.uv=new a.UV(d,b),c}function g(b,c,d,e){e<1?(e=new a.Face3(b.index,c.index,d.index,[b.clone(),c.clone(),d.clone()]),e.centroid.addSelf(b).addSelf(c).addSelf(d).divideScalar(3),e.normal=e.centroid.clone().normalize(),j.faces.push(e),e=Math.atan2(e.centroid.z,-e.centroid.x),j.faceVertexUvs[0].push([i(b.uv,b,e),i(c.uv,c,e),i(d.uv,d,e)])):(e-=1,g(b,h(b,c),h(b,d),e),g(h(b,c),c,h(c,d),e),g(h(b,d),h(c,d),d,e),g(h(b,c),h(c,d),h(b,d),e))}function h(b,c){m[b.index]||(m[b.index]=[]),m[c.index]||(m[c.index]=[]);var d=m[b.index][c.index];return d===void 0&&(m[b.index][c.index]=m[c.index][b.index]=d=f((new a.Vector3).add(b,c).divideScalar(2))),d}function i(b,c,d){return d<0&&b.u===1&&(b=new a.UV(b.u-1,b.v)),c.x===0&&c.z===0&&(b=new a.UV(d/2/Math.PI+.5,b.v)),b}a.Geometry.call(this);for(var d=d||1,e=e||0,j=this,k=0,l=b.length;k<l;k++)f(new a.Vector3(b[k][0],b[k][1],b[k][2]));for(var m=[],b=this.vertices,k=0,l=c.length;k<l;k++)g(b[c[k][0]],b[c[k][1]],b[c[k][2]],e);this.mergeVertices(),k=0;for(l=this.vertices.length;k<l;k++)this.vertices[k].multiplyScalar(d);this.computeCentroids(),this.boundingSphere={radius:d}},a.PolyhedronGeometry.prototype=new a.Geometry,a.PolyhedronGeometry.prototype.constructor=a.PolyhedronGeometry,a.IcosahedronGeometry=function(b,c){var d=(1+Math.sqrt(5))/2;a.PolyhedronGeometry.call(this,[[-1,d,0],[1,d,0],[-1,-d,0],[1,-d,0],[0,-1,d],[0,1,d],[0,-1,-d],[0,1,-d],[d,0,-1],[d,0,1],[-d,0,-1],[-d,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],b,c)},a.IcosahedronGeometry.prototype=new a.Geometry,a.IcosahedronGeometry.prototype.constructor=a.IcosahedronGeometry,a.OctahedronGeometry=function(b,c){a.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],b,c)},a.OctahedronGeometry.prototype=new a.Geometry,a.OctahedronGeometry.prototype.constructor=a.OctahedronGeometry,a.TetrahedronGeometry=function(b,c){a.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],b,c)},a.TetrahedronGeometry.prototype=new a.Geometry,a.TetrahedronGeometry.prototype.constructor=a.TetrahedronGeometry,a.ParametricGeometry=function(b,c,d,e){a.Geometry.call(this);var f=this.vertices,g=this.faces,h=this.faceVertexUvs[0],e=e===void 0?!1:e,i,j,k,l,m=c+1;for(i=0;i<=d;i++){l=i/d;for(j=0;j<=c;j++)k=j/c,k=b(k,l),f.push(k)}var n,o,p,q;for(i=0;i<d;i++)for(j=0;j<c;j++)b=i*m+j,f=i*m+j+1,l=(i+1)*m+j,k=(i+1)*m+j+1,n=new a.UV(i/c,j/d),o=new a.UV(i/c,(j+1)/d),p=new a.UV((i+1)/c,j/d),q=new a.UV((i+1)/c,(j+1)/d),e?(g.push(new a.Face3(b,f,l)),g.push(new a.Face3(f,k,l)),h.push([n,o,p]),h.push([o,q,p])):(g.push(new a.Face4(b,f,k,l)),h.push([n,o,p,q]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.ParametricGeometry.prototype=new a.Geometry,a.ParametricGeometry.prototype.constructor=a.ParametricGeometry,a.AxisHelper=function(){a.Object3D.call(this);var b=new a.Geometry;b.vertices.push(new a.Vector3),b.vertices.push(new a.Vector3(0,100,0));var c=new a.CylinderGeometry(0,5,25,5,1),d;d=new a.Line(b,new a.LineBasicMaterial({color:16711680})),d.rotation.z=-Math.PI/2,this.add(d),d=new a.Mesh(c,new a.MeshBasicMaterial({color:16711680})),d.position.x=100,d.rotation.z=-Math.PI/2,this.add(d),d=new a.Line(b,new a.LineBasicMaterial({color:65280})),this.add(d),d=new a.Mesh(c,new a.MeshBasicMaterial({color:65280})),d.position.y=100,this.add(d),d=new a.Line(b,new a.LineBasicMaterial({color:255})),d.rotation.x=Math.PI/2,this.add(d),d=new a.Mesh(c,new a.MeshBasicMaterial({color:255})),d.position.z=100,d.rotation.x=Math.PI/2,this.add(d)},a.AxisHelper.prototype=new a.Object3D,a.AxisHelper.prototype.constructor=a.AxisHelper,a.ArrowHelper=function(b,c,d,e){a.Object3D.call(this),e===void 0&&(e=16776960),d===void 0&&(d=20);var f=new a.Geometry;f.vertices.push(new a.Vector3(0,0,0)),f.vertices.push(new a.Vector3(0,1,0)),this.line=new a.Line(f,new a.LineBasicMaterial({color:e})),this.add(this.line),f=new a.CylinderGeometry(0,.05,.25,5,1),this.cone=new a.Mesh(f,new a.MeshBasicMaterial({color:e})),this.cone.position.set(0,1,0),this.add(this.cone),c instanceof a.Vector3&&(this.position=c),this.setDirection(b),this.setLength(d)},a.ArrowHelper.prototype=new a.Object3D,a.ArrowHelper.prototype.constructor=a.ArrowHelper,a.ArrowHelper.prototype.setDirection=function(b){var c=(new a.Vector3(0,1,0)).crossSelf(b),b=Math.acos((new a.Vector3(0,1,0)).dot(b.clone().normalize()));this.matrix=(new a.Matrix4).makeRotationAxis(c.normalize(),b),this.rotation.getRotationFromMatrix(this.matrix,this.scale)},a.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)},a.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a),this.cone.material.color.setHex(a)},a.CameraHelper=function(b){function c(a,b,c){d(a,c),d(b,c)}function d(b,c){e.lineGeometry.vertices.push(new a.Vector3),e.lineGeometry.colors.push(new a.Color(c)),e.pointMap[b]===void 0&&(e.pointMap[b]=[]),e.pointMap[b].push(e.lineGeometry.vertices.length-1)}a.Object3D.call(this);var e=this;this.lineGeometry=new a.Geometry,this.lineMaterial=new a.LineBasicMaterial({color:16777215,vertexColors:a.FaceColors}),this.pointMap={},c("n1","n2",16755200),c("n2","n4",16755200),c("n4","n3",16755200),c("n3","n1",16755200),c("f1","f2",16755200),c("f2","f4",16755200),c("f4","f3",16755200),c("f3","f1",16755200),c("n1","f1",16755200),c("n2","f2",16755200),c("n3","f3",16755200),c("n4","f4",16755200),c("p","n1",16711680),c("p","n2",16711680),c("p","n3",16711680),c("p","n4",16711680),c("u1","u2",43775),c("u2","u3",43775),c("u3","u1",43775),c("c","t",16777215),c("p","c",3355443),c("cn1","cn2",3355443),c("cn3","cn4",3355443),c("cf1","cf2",3355443),c("cf3","cf4",3355443),this.camera=b,this.update(b),this.lines=new a.Line(this.lineGeometry,this.lineMaterial,a.LinePieces),this.add(this.lines)},a.CameraHelper.prototype=new a.Object3D,a.CameraHelper.prototype.constructor=a.CameraHelper,a.CameraHelper.prototype.update=function(){function b(b,d,e,f){a.CameraHelper.__v.set(d,e,f),a.CameraHelper.__projector.unprojectVector(a.CameraHelper.__v,a.CameraHelper.__c),b=c.pointMap[b];if(b!==void 0){d=0;for(e=b.length;d<e;d++)c.lineGeometry.vertices[b[d]].copy(a.CameraHelper.__v)}}var c=this;a.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),b("c",0,0,-1),b("t",0,0,1),b("n1",-1,-1,-1),b("n2",1,-1,-1),b("n3",-1,1,-1),b("n4",1,1,-1),b("f1",-1,-1,1),b("f2",1,-1,1),b("f3",-1,1,1),b("f4",1,1,1),b("u1",.7,1.1,-1),b("u2",-0.7,1.1,-1),b("u3",0,2,-1),b("cf1",-1,0,1),b("cf2",1,0,1),b("cf3",0,-1,1),b("cf4",0,1,1),b("cn1",-1,0,-1),b("cn2",1,0,-1),b("cn3",0,-1,-1),b("cn4",0,1,-1),this.lineGeometry.verticesNeedUpdate=!0},a.CameraHelper.__projector=new a.Projector,a.CameraHelper.__v=new a.Vector3,a.CameraHelper.__c=new a.Camera,a.SubdivisionModifier=function(a){this.subdivisions=a===void 0?1:a,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},a.SubdivisionModifier.prototype.constructor=a.SubdivisionModifier,a.SubdivisionModifier.prototype.modify=function(a){for(var b=this.subdivisions;b-->0;)this.smooth(a)},a.SubdivisionModifier.prototype.smooth=function(b){function c(){n.debug&&console.log.apply(console,arguments)}function d(){console&&console.log.apply(console,arguments)}function e(b,d,e,f,h,i,j){var k=new a.Face4(b,d,e,f,null,h.color,h.material);if(n.useOldVertexColors){k.vertexColors=[];for(var o,p,q,r=0;r<4;r++){q=i[r],o=new a.Color,o.setRGB(0,0,0);for(var s=0;s<q.length;s++)p=h.vertexColors[q[s]-1],o.r=o.r+p.r,o.g=o.g+p.g,o.b=o.b+p.b;o.r=o.r/q.length,o.g=o.g/q.length,o.b=o.b/q.length,k.vertexColors[r]=o}}l.push(k),n.supportUVs&&(h=[g(b,""),g(d,j),g(e,j),g(f,j)],h[0]?h[1]?h[2]?h[3]?m.push(h):c("d :( ",f+":"+j):c("c :( ",e+":"+j):c("b :( ",d+":"+j):c("a :( ",b+":"+j))}function f(a,b){return Math.min(a,b)+"_"+Math.max(a,b)}function g(a,b){var e=a+":"+b,f=t[e];return f?f:(a>=u&&a<u+p.length?c("face pt"):c("edge pt"),d("warning, UV not found for",e),null)}function h(a,b,c){var e=a+":"+b;e in t?d("dup vertexNo",a,"oldFaceNo",b,"value",c,"key",e,t[e]):t[e]=c}function i(a,b){E[a]===void 0&&(E[a]=[]),E[a].push(b)}function j(a,b,c){F[a]===void 0&&(F[a]={}),F[a][b]=c}var k=[],l=[],m=[],n=this,o=b.vertices,p=b.faces,k=o.concat(),q=[],r={},s={},t={},u=o.length,v,w,x,y,z,A=b.faceVertexUvs[0],B;c("originalFaces, uvs, originalVerticesLength",p.length,A.length,u);if(n.supportUVs){v=0;for(w=A.length;v<w;v++){x=0;for(y=A[v].length;x<y;x++)B=p[v]["abcd".charAt(x)],h(B,v,A[v][x])}}A.length==0&&(n.supportUVs=!1),v=0;for(z in t)v++;v||(n.supportUVs=!1,c("no uvs")),c("-- Original Faces + Vertices UVs completed",t,"vs",A.length),v=0;for(w=p.length;v<w;v++)z=p[v],q.push(z.centroid),k.push(z.centroid),n.supportUVs&&(A=new a.UV,z instanceof a.Face3?(A.u=g(z.a,v).u+g(z.b,v).u+g(z.c,v).u,A.v=g(z.a,v).v+g(z.b,v).v+g(z.c,v).v,A.u=A.u/3,A.v=A.v/3):z instanceof a.Face4&&(A.u=g(z.a,v).u+g(z.b,v).u+g(z.c,v).u+g(z.d,v).u,A.v=g(z.a,v).v+g(z.b,v).v+g(z.c,v).v+g(z.d,v).v,A.u=A.u/4,A.v=A.v/4),h(u+v,"",A));c("-- added UVs for new Faces",t),w=function(b){function c(a,b){i[a]===void 0&&(i[a]=[]),i[a].push(b)}var d,e,g,h,i={};d=0;for(e=b.faces.length;d<e;d++)g=b.faces[d],g instanceof a.Face3?(h=f(g.a,g.b),c(h,d),h=f(g.b,g.c),c(h,d),h=f(g.c,g.a),c(h,d)):g instanceof a.Face4&&(h=f(g.a,g.b),c(h,d),h=f(g.b,g.c),c(h,d),h=f(g.c,g.d),c(h,d),h=f(g.d,g.a),c(h,d));return i}(b),B=0;var C,D,E={},F={};for(v in w){A=w[v],C=v.split("_"),D=C[0],C=C[1],i(D,[D,C]),i(C,[D,C]),x=0;for(y=A.length;x<y;x++)z=A[x],j(D,z,v),j(C,z,v);A.length<2&&(s[v]=!0)}c("vertexEdgeMap",E,"vertexFaceMap",F);for(v in w)A=w[v],z=A[0],y=A[1],C=v.split("_"),D=C[0],C=C[1],A=new a.Vector3,s[v]?(A.addSelf(o[D]),A.addSelf(o[C]),A.multiplyScalar(.5)):(A.addSelf(q[z]),A.addSelf(q[y]),A.addSelf(o[D]),A.addSelf(o[C]),A.multiplyScalar(.25)),r[v]=u+p.length+B,k.push(A),B++,n.supportUVs&&(A=new a.UV,A.u=g(D,z).u+g(C,z).u,A.v=g(D,z).v+g(C,z).v,A.u=A.u/2,A.v=A.v/2,h(r[v],z,A),s[v]||(A=new a.UV,A.u=g(D,y).u+g(C,y).u,A.v=g(D,y).v+g(C,y).v,A.u=A.u/2,A.v=A.v/2,h(r[v],y,A)));c("-- Step 2 done");var G,H;y=["123","12","2","23"],C=["123","23","3","31"];var I=["123","31","1","12"],J=["1234","12","2","23"],K=["1234","23","3","34"],L=["1234","34","4","41"],M=["1234","41","1","12"];v=0;for(w=q.length;v<w;v++)z=p[v],A=u+v,z instanceof a.Face3?(B=f(z.a,z.b),D=f(z.b,z.c),G=f(z.c,z.a),e(A,r[B],z.b,r[D],z,y,v),e(A,r[D],z.c,r[G],z,C,v),e(A,r[G],z.a,r[B],z,I,v)):z instanceof a.Face4?(B=f(z.a,z.b),D=f(z.b,z.c),G=f(z.c,z.d),H=f(z.d,z.a),e(A,r[B],z.b,r[D],z,J,v),e(A,r[D],z.c,r[G],z,K,v),e(A,r[G],z.d,r[H],z,L,v),e(A,r[H],z.a,r[B],z,M,v)):c("face should be a face!",z);r=new a.Vector3,z=new a.Vector3,v=0;for(w=o.length;v<w;v++)if(E[v]!==void 0){r.set(0,0,0),z.set(0,0,0),D=new a.Vector3(0,0,0),A=0;for(x in F[v])r.addSelf(q[x]),A++;y=0,B=E[v].length;for(x=0;x<B;x++)s[f(E[v][x][0],E[v][x][1])]&&y++;if(y!=2){r.divideScalar(A);for(x=0;x<B;x++)A=E[v][x],A=o[A[0]].clone().addSelf(o[A[1]]).divideScalar(2),z.addSelf(A);z.divideScalar(B),D.addSelf(o[v]),D.multiplyScalar(B-3),D.addSelf(r),D.addSelf(z.multiplyScalar(2)),D.divideScalar(B),k[v]=D}}b.vertices=k,b.faces=l,b.faceVertexUvs[0]=m,delete b.__tmpVertices,b.computeCentroids(),b.computeFaceNormals(),b.computeVertexNormals()},a.ImmediateRenderObject=function(){a.Object3D.call(this),this.render=function(){}},a.ImmediateRenderObject.prototype=new a.Object3D,a.ImmediateRenderObject.prototype.constructor=a.ImmediateRenderObject,a.LensFlare=function(b,c,d,e,f){a.Object3D.call(this),this.lensFlares=[],this.positionScreen=new a.Vector3,this.customUpdateCallback=void 0,b!==void 0&&this.add(b,c,d,e,f)},a.LensFlare.prototype=new a.Object3D,a.LensFlare.prototype.constructor=a.LensFlare,a.LensFlare.prototype.supr=a.Object3D.prototype,a.LensFlare.prototype.add=function(b,c,d,e,f,g){c===void 0&&(c=-1),d===void 0&&(d=0),g===void 0&&(g=1),f===void 0&&(f=new a.Color(16777215)),e===void 0&&(e=a.NormalBlending),d=Math.min(d,Math.max(0,d)),this.lensFlares.push({texture:b,size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:1,opacity:g,color:f,blending:e})},a.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,d=-this.positionScreen.x*2,e=-this.positionScreen.y*2;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation=c.rotation+(c.wantedRotation-c.rotation)*.25},a.MorphBlendMesh=function(b,c){a.Mesh.call(this,b,c),this.animationsMap={},this.animationsList=[];var d=this.geometry.morphTargets.length;this.createAnimation("__default",0,d-1,d/1),this.setAnimationWeight("__default",1)},a.MorphBlendMesh.prototype=new a.Mesh,a.MorphBlendMesh.prototype.constructor=a.MorphBlendMesh,a.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[a]=b,this.animationsList.push(b)},a.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&h.length>1){var i=h[1];d[i]||(d[i]={start:Infinity,end:-Infinity}),h=d[i],f<h.start&&(h.start=f),f>h.end&&(h.end=f),c||(c=i)}}for(i in d)h=d[i],this.createAnimation(i,h.start,h.end,a);this.firstAnimation=c},a.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1},a.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0},a.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},a.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},a.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},a.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},a.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b},a.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b},a.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")},a.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1},a.MorphBlendMesh.prototype.update=function(b){for(var c=0,d=this.animationsList.length;c<d;c++){var e=this.animationsList[c];if(e.active){var f=e.duration/e.length;e.time=e.time+e.direction*b;if(e.mirroredLoop){if(e.time>e.duration||e.time<0)e.direction=e.direction*-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),e.time<0&&(e.time=0,e.directionBackwards=!1)}else e.time=e.time%e.duration,e.time<0&&(e.time=e.time+e.duration);var g=e.startFrame+a.Math.clamp(Math.floor(e.time/f),0,e.length-1),h=e.weight;g!==e.currentFrame&&(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*h,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g),f=e.time%f/f,e.directionBackwards&&(f=1-f),this.morphTargetInfluences[e.currentFrame]=f*h,this.morphTargetInfluences[e.lastFrame]=(1-f)*h}}},a.LensFlarePlugin=function(){function b(a){var b=c.createProgram(),d=c.createShader(c.FRAGMENT_SHADER),e=c.createShader(c.VERTEX_SHADER);return c.shaderSource(d,a.fragmentShader),c.shaderSource(e,a.vertexShader),c.compileShader(d),c.compileShader(e),c.attachShader(b,d),c.attachShader(b,e),c.linkProgram(b),b}var c,d,e,f,g,h,i,j,k,l,m,n,o;this.init=function(q){c=q.context,d=q,e=new Float32Array(16),f=new Uint16Array(6),q=0,e[q++]=-1,e[q++]=-1,e[q++]=0,e[q++]=0,e[q++]=1,e[q++]=-1,e[q++]=1,e[q++]=0,e[q++]=1,e[q++]=1,e[q++]=1,e[q++]=1,e[q++]=-1,e[q++]=1,e[q++]=0,e[q++]=1,q=0,f[q++]=0,f[q++]=1,f[q++]=2,f[q++]=0,f[q++]=2,f[q++]=3,g=c.createBuffer(),h=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,g),c.bufferData(c.ARRAY_BUFFER,e,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h),c.bufferData(c.ELEMENT_ARRAY_BUFFER,f,c.STATIC_DRAW),i=c.createTexture(),j=c.createTexture(),c.bindTexture(c.TEXTURE_2D,i),c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.bindTexture(c.TEXTURE_2D,j),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(k=!1,l=b(a.ShaderFlares.lensFlare)):(k=!0,l=b(a.ShaderFlares.lensFlareVertexTexture)),m={},n={},m.vertex=c.getAttribLocation(l,"position"),m.uv=c.getAttribLocation(l,"uv"),n.renderType=c.getUniformLocation(l,"renderType"),n.map=c.getUniformLocation(l,"map"),n.occlusionMap=c.getUniformLocation(l,"occlusionMap"),n.opacity=c.getUniformLocation(l,"opacity"),n.color=c.getUniformLocation(l,"color"),n.scale=c.getUniformLocation(l,"scale"),n.rotation=c.getUniformLocation(l,"rotation"),n.screenPosition=c.getUniformLocation(l,"screenPosition"),o=!1},this.render=function(b,e,f,q){var b=b.__webglFlares,r=b.length;if(r){var s=new a.Vector3,t=q/f,u=f*.5,v=q*.5,w=16/q,x=new a.Vector2(w*t,w),y=new a.Vector3(1,1,0),z=new a.Vector2(1,1),A=n,w=m;c.useProgram(l),o||(c.enableVertexAttribArray(m.vertex),c.enableVertexAttribArray(m.uv),o=!0),c.uniform1i(A.occlusionMap,0),c.uniform1i(A.map,1),c.bindBuffer(c.ARRAY_BUFFER,g),c.vertexAttribPointer(w.vertex,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(w.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h),c.disable(c.CULL_FACE),c.depthMask(!1);var B,C,D,E,F;for(B=0;B<r;B++){w=16/q,x.set(w*t,w),E=b[B],s.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]),e.matrixWorldInverse.multiplyVector3(s),e.projectionMatrix.multiplyVector3(s),y.copy(s),z.x=y.x*u+u,z.y=y.y*v+v;if(k||z.x>0&&z.x<f&&z.y>0&&z.y<q){c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,i),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,z.x-8,z.y-8,16,16,0),c.uniform1i(A.renderType,0),c.uniform2f(A.scale,x.x,x.y),c.uniform3f(A.screenPosition,y.x,y.y,y.z),c.disable(c.BLEND),c.enable(c.DEPTH_TEST),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,j),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,z.x-8,z.y-8,16,16,0),c.uniform1i(A.renderType,1),c.disable(c.DEPTH_TEST),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,i),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),E.positionScreen.copy(y),E.customUpdateCallback?E.customUpdateCallback(E):E.updateLensFlares(),c.uniform1i(A.renderType,2),c.enable(c.BLEND),C=0;for(D=E.lensFlares.length;C<D;C++)F=E.lensFlares[C],F.opacity>.001&&F.scale>.001&&(y.x=F.x,y.y=F.y,y.z=F.z,w=F.size*F.scale/q,x.x=w*t,x.y=w,c.uniform3f(A.screenPosition,y.x,y.y,y.z),c.uniform2f(A.scale,x.x,x.y),c.uniform1f(A.rotation,F.rotation),c.uniform1f(A.opacity,F.opacity),c.uniform3f(A.color,F.color.r,F.color.g,F.color.b),d.setBlending(F.blending,F.blendEquation,F.blendSrc,F.blendDst),d.setTexture(F.texture,1),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0))}}c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST),c.depthMask(!0)}}},a.ShadowMapPlugin=function(){var b,c,d,e,f=new a.Frustum,g=new a.Matrix4,h=new a.Vector3,i=new a.Vector3;this.init=function(f){b=f.context,c=f;var f=a.ShaderLib.depthRGBA,g=a.UniformsUtils.clone(f.uniforms);d=new a.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g}),e=new a.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g,morphTargets:!0}),d._shadowPass=!0,e._shadowPass=!0},this.render=function(a,b){c.shadowMapEnabled&&c.shadowMapAutoUpdate&&this.update(a,b)},this.update=function(j,k){var l,m,n,o,p,q,r,s,t,u=[];o=0,b.clearColor(1,1,1,1),b.disable(b.BLEND),b.enable(b.CULL_FACE),c.shadowMapCullFrontFaces?b.cullFace(b.FRONT):b.cullFace(b.BACK),c.setDepthTest(!0),l=0;for(m=j.__lights.length;l<m;l++){n=j.__lights[l];if(n.castShadow)if(n instanceof a.DirectionalLight&&n.shadowCascade)for(p=0;p<n.shadowCascadeCount;p++){var v;if(n.shadowCascadeArray[p])v=n.shadowCascadeArray[p];else{t=n,r=p,v=new a.DirectionalLight,v.isVirtual=!0,v.onlyShadow=!0,v.castShadow=!0,v.shadowCameraNear=t.shadowCameraNear,v.shadowCameraFar=t.shadowCameraFar,v.shadowCameraLeft=t.shadowCameraLeft,v.shadowCameraRight=t.shadowCameraRight,v.shadowCameraBottom=t.shadowCameraBottom,v.shadowCameraTop=t.shadowCameraTop,v.shadowCameraVisible=t.shadowCameraVisible,v.shadowDarkness=t.shadowDarkness,v.shadowBias=t.shadowCascadeBias[r],v.shadowMapWidth=t.shadowCascadeWidth[r],v.shadowMapHeight=t.shadowCascadeHeight[r],v.pointsWorld=[],v.pointsFrustum=[],s=v.pointsWorld,q=v.pointsFrustum;for(var w=0;w<8;w++)s[w]=new a.Vector3,q[w]=new a.Vector3;s=t.shadowCascadeNearZ[r],t=t.shadowCascadeFarZ[r],q[0].set(-1,-1,s),q[1].set(1,-1,s),q[2].set(-1,1,s),q[3].set(1,1,s),q[4].set(-1,-1,t),q[5].set(1,-1,t),q[6].set(-1,1,t),q[7].set(1,1,t),v.originalCamera=k,q=new a.Gyroscope,q.position=n.shadowCascadeOffset,q.add(v),q.add(v.target),k.add(q),n.shadowCascadeArray[p]=v,console.log("Created virtualLight",v)}r=n,s=p,t=r.shadowCascadeArray[s],t.position.copy(r.position),t.target.position.copy(r.target.position),t.lookAt(t.target),t.shadowCameraVisible=r.shadowCameraVisible,t.shadowDarkness=r.shadowDarkness,t.shadowBias=r.shadowCascadeBias[s],q=r.shadowCascadeNearZ[s],r=r.shadowCascadeFarZ[s],t=t.pointsFrustum,t[0].z=q,t[1].z=q,t[2].z=q,t[3].z=q,t[4].z=r,t[5].z=r,t[6].z=r,t[7].z=r,u[o]=v,o++}else u[o]=n,o++}l=0;for(m=u.length;l<m;l++){n=u[l],n.shadowMap||(n.shadowMap=new a.WebGLRenderTarget(n.shadowMapWidth,n.shadowMapHeight,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),n.shadowMapSize=new a.Vector2(n.shadowMapWidth,n.shadowMapHeight),n.shadowMatrix=new a.Matrix4);if(!n.shadowCamera){if(n instanceof a.SpotLight)n.shadowCamera=new a.PerspectiveCamera(n.shadowCameraFov,n.shadowMapWidth/n.shadowMapHeight,n.shadowCameraNear,n.shadowCameraFar);else{if(!(n instanceof a.DirectionalLight)){console.error("Unsupported light type for shadow");continue}n.shadowCamera=new a.OrthographicCamera(n.shadowCameraLeft,n.shadowCameraRight,n.shadowCameraTop,n.shadowCameraBottom,n.shadowCameraNear,n.shadowCameraFar)}j.add(n.shadowCamera),c.autoUpdateScene&&j.updateMatrixWorld()}n.shadowCameraVisible&&!n.cameraHelper&&(n.cameraHelper=new a.CameraHelper(n.shadowCamera),n.shadowCamera.add(n.cameraHelper));if(n.isVirtual&&v.originalCamera==k){p=k,o=n.shadowCamera,q=n.pointsFrustum,t=n.pointsWorld,h.set(Infinity,Infinity,Infinity),i.set(-Infinity,-Infinity,-Infinity);for(r=0;r<8;r++)s=t[r],s.copy(q[r]),a.ShadowMapPlugin.__projector.unprojectVector(s,p),o.matrixWorldInverse.multiplyVector3(s),s.x<h.x&&(h.x=s.x),s.x>i.x&&(i.x=s.x),s.y<h.y&&(h.y=s.y),s.y>i.y&&(i.y=s.y),s.z<h.z&&(h.z=s.z),s.z>i.z&&(i.z=s.z);o.left=h.x,o.right=i.x,o.top=i.y,o.bottom=h.y,o.updateProjectionMatrix()}o=n.shadowMap,q=n.shadowMatrix,p=n.shadowCamera,p.position.copy(n.matrixWorld.getPosition()),p.lookAt(n.target.matrixWorld.getPosition()),p.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),n.cameraHelper&&(n.cameraHelper.lines.visible=n.shadowCameraVisible),n.shadowCameraVisible&&n.cameraHelper.update(),q.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),q.multiplySelf(p.projectionMatrix),q.multiplySelf(p.matrixWorldInverse),p._viewMatrixArray||(p._viewMatrixArray=new Float32Array(16)),p._projectionMatrixArray||(p._projectionMatrixArray=new Float32Array(16)),p.matrixWorldInverse.flattenToArray(p._viewMatrixArray),p.projectionMatrix.flattenToArray(p._projectionMatrixArray),g.multiply(p.projectionMatrix,p.matrixWorldInverse),f.setFromMatrix(g),c.setRenderTarget(o),c.clear(),t=j.__webglObjects,n=0;for(o=t.length;n<o;n++)r=t[n],q=r.object,r.render=!1,q.visible&&q.castShadow&&(!(q instanceof a.Mesh)||!q.frustumCulled||f.contains(q))&&(q._modelViewMatrix.multiply(p.matrixWorldInverse,q.matrixWorld),r.render=!0);n=0;for(o=t.length;n<o;n++)r=t[n],r.render&&(q=r.object,r=r.buffer,s=q.customDepthMaterial?q.customDepthMaterial:q.geometry.morphTargets.length?e:d,r instanceof a.BufferGeometry?c.renderBufferDirect(p,j.__lights,null,s,r,q):c.renderBuffer(p,j.__lights,null,s,r,q));t=j.__webglObjectsImmediate,n=0;for(o=t.length;n<o;n++)r=t[n],q=r.object,q.visible&&q.castShadow&&(q._modelViewMatrix.multiply(p.matrixWorldInverse,q.matrixWorld),c.renderImmediateObject(p,j.__lights,null,d,q))}l=c.getClearColor(),m=c.getClearAlpha(),b.clearColor(l.r,l.g,l.b,m),b.enable(b.BLEND),c.shadowMapCullFrontFaces&&b.cullFace(b.BACK)}},a.ShadowMapPlugin.__projector=new a.Projector,a.SpritePlugin=function(){function b(a,b){return b.z-a.z}var c,d,e,f,g,h,i,j,k,l;this.init=function(b){c=b.context,d=b,e=new Float32Array(16),f=new Uint16Array(6),b=0,e[b++]=-1,e[b++]=-1,e[b++]=0,e[b++]=1,e[b++]=1,e[b++]=-1,e[b++]=1,e[b++]=1,e[b++]=1,e[b++]=1,e[b++]=1,e[b++]=0,e[b++]=-1,e[b++]=1,e[b++]=0,b=e[b++]=0,f[b++]=0,f[b++]=1,f[b++]=2,f[b++]=0,f[b++]=2,f[b++]=3,g=c.createBuffer(),h=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,g),c.bufferData(c.ARRAY_BUFFER,e,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h),c.bufferData(c.ELEMENT_ARRAY_BUFFER,f,c.STATIC_DRAW);var b=a.ShaderSprite.sprite,m=c.createProgram(),n=c.createShader(c.FRAGMENT_SHADER),o=c.createShader(c.VERTEX_SHADER);c.shaderSource(n,b.fragmentShader),c.shaderSource(o,b.vertexShader),c.compileShader(n),c.compileShader(o),c.attachShader(m,n),c.attachShader(m,o),c.linkProgram(m),i=m,j={},k={},j.position=c.getAttribLocation(i,"position"),j.uv=c.getAttribLocation(i,"uv"),k.uvOffset=c.getUniformLocation(i,"uvOffset"),k.uvScale=c.getUniformLocation(i,"uvScale"),k.rotation=c.getUniformLocation(i,"rotation"),k.scale=c.getUniformLocation(i,"scale"),k.alignment=c.getUniformLocation(i,"alignment"),k.color=c.getUniformLocation(i,"color"),k.map=c.getUniformLocation(i,"map"),k.opacity=c.getUniformLocation(i,"opacity"),k.useScreenCoordinates=c.getUniformLocation(i,"useScreenCoordinates"),k.affectedByDistance=c.getUniformLocation(i,"affectedByDistance"),k.screenPosition=c.getUniformLocation(i,"screenPosition"),k.modelViewMatrix=c.getUniformLocation(i,"modelViewMatrix"),k.projectionMatrix=c.getUniformLocation(i,"projectionMatrix"),l=!1},this.render=function(a,e,f,m){var a=a.__webglSprites,n=a.length;if(n){var o=j,p=k,q=m/f,f=f*.5,r=m*.5,s=!0;c.useProgram(i),l||(c.enableVertexAttribArray(o.position),c.enableVertexAttribArray(o.uv),l=!0),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.depthMask(!0),c.bindBuffer(c.ARRAY_BUFFER,g),c.vertexAttribPointer(o.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(o.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h),c.uniformMatrix4fv(p.projectionMatrix,!1,e._projectionMatrixArray),c.activeTexture(c.TEXTURE0),c.uniform1i(p.map,0);for(var t,u=[],o=0;o<n;o++)t=a[o],t.visible&&t.opacity!==0&&(t.useScreenCoordinates?t.z=-t.position.z:(t._modelViewMatrix.multiply(e.matrixWorldInverse,t.matrixWorld),t.z=-t._modelViewMatrix.elements[14]));a.sort(b);for(o=0;o<n;o++)t=a[o],t.visible&&t.opacity!==0&&t.map&&t.map.image&&t.map.image.width&&(t.useScreenCoordinates?(c.uniform1i(p.useScreenCoordinates,1),c.uniform3f(p.screenPosition,(t.position.x-f)/f,(r-t.position.y)/r,Math.max(0,Math.min(1,t.position.z)))):(c.uniform1i(p.useScreenCoordinates,0),c.uniform1i(p.affectedByDistance,t.affectedByDistance?1:0),c.uniformMatrix4fv(p.modelViewMatrix,!1,t._modelViewMatrix.elements)),e=t.map.image.width/(t.scaleByViewport?m:1),u[0]=e*q*t.scale.x,u[1]=e*t.scale.y,c.uniform2f(p.uvScale,t.uvScale.x,t.uvScale.y),c.uniform2f(p.uvOffset,t.uvOffset.x,t.uvOffset.y),c.uniform2f(p.alignment,t.alignment.x,t.alignment.y),c.uniform1f(p.opacity,t.opacity),c.uniform3f(p.color,t.color.r,t.color.g,t.color.b),c.uniform1f(p.rotation,t.rotation),c.uniform2fv(p.scale,u),t.mergeWith3D&&!s?(c.enable(c.DEPTH_TEST),s=!0):!t.mergeWith3D&&s&&(c.disable(c.DEPTH_TEST),s=!1),d.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst),d.setTexture(t.map,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0));c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST),c.depthMask(!0)}}},a.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var b,c,d,e,f=new a.Frustum,g=new a.Matrix4;this.init=function(f){b=f.context,c=f;var f=a.ShaderLib.depthRGBA,g=a.UniformsUtils.clone(f.uniforms);d=new a.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g}),e=new a.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:g,morphTargets:!0}),d._shadowPass=!0,e._shadowPass=!0},this.render=function(a,b){this.enabled&&this.update(a,b)},this.update=function(h,i){var j,k,l,m,n,o;b.clearColor(1,1,1,1),b.disable(b.BLEND),c.setDepthTest(!0),c.autoUpdateScene&&h.updateMatrixWorld(),i._viewMatrixArray||(i._viewMatrixArray=new Float32Array(16)),i._projectionMatrixArray||(i._projectionMatrixArray=new Float32Array(16)),i.matrixWorldInverse.getInverse(i.matrixWorld),i.matrixWorldInverse.flattenToArray(i._viewMatrixArray),i.projectionMatrix.flattenToArray(i._projectionMatrixArray),g.multiply(i.projectionMatrix,i.matrixWorldInverse),f.setFromMatrix(g),c.setRenderTarget(this.renderTarget),c.clear(),o=h.__webglObjects,j=0;for(k=o.length;j<k;j++)l=o[j],n=l.object,l.render=!1,n.visible&&(!(n instanceof a.Mesh)||!n.frustumCulled||f.contains(n))&&(n._modelViewMatrix.multiply(i.matrixWorldInverse,n.matrixWorld),l.render=!0);j=0;for(k=o.length;j<k;j++)l=o[j],l.render&&(n=l.object,l=l.buffer,c.setObjectFaces(n),m=n.customDepthMaterial?n.customDepthMaterial:n.geometry.morphTargets.length?e:d,l instanceof a.BufferGeometry?c.renderBufferDirect(i,h.__lights,null,m,l,n):c.renderBuffer(i,h.__lights,null,m,l,n));o=h.__webglObjectsImmediate,j=0;for(k=o.length;j<k;j++)l=o[j],n=l.object,n.visible&&n.castShadow&&(n._modelViewMatrix.multiply(i.matrixWorldInverse,n.matrixWorld),c.renderImmediateObject(i,h.__lights,null,d,n));j=c.getClearColor(),k=c.getClearAlpha(),b.clearColor(j.r,j.g,j.b,k),b.enable(b.BLEND)}},a.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},a.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}},b=a}.call(a),b})})(this)